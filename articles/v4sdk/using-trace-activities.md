---
title: Добавление действий трассировки в бот — Служба Azure Bot
description: Сведения о действиях трассировки в Bot Framework и о том, как их использовать.
keywords: трассировка, действие, бот, пакет SDK для Bot Framework
author: JonathanFingold
ms.author: kamrani
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.date: 11/18/2019
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 5cfb4e8f2d16c868bcbc7d3d11c7cb0b2455f7cb
ms.sourcegitcommit: 36d6f06ffafad891f6efe4ff7ba921de8a306a94
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2020
ms.locfileid: "76895822"
---
# <a name="add-trace-activities-to-your-bot"></a>Добавление действий трассировки в бот

[!INCLUDE[applies-to](../includes/applies-to.md)]

<!-- What is it and why use it -->

_Действием трассировки_ называется действие, которое бот может отправить в Bot Framework Emulator.
Вы можете использовать действия трассировки для интерактивной отладки бота, так как они позволяют просматривать сведения о боте при локальном выполнении.

<!-- Details -->

Действия трассировки отправляются только в приложение Emulator, но не другим клиентам и не в каналы.
Приложение отображает их в журнале, но не на главной панели разговора.

- Действия трассировки из контекста шага отправляются через _обработчики действий отправки_, которые зарегистрированы в контексте этого шага.
- Действия трассировки из контекста шага привязываются к входящему действию путем применения ссылки на беседу, если таковая имеется.
  Для упреждающего сообщения _идентификатор адреса для ответа_ будет содержать новый уникальный идентификатор.
- Независимо от метода отправки действие трассировки никогда не устанавливает флаг _responded_ (получен ответ).

## <a name="to-use-a-trace-activity"></a>Использование действия трассировки

Чтобы увидеть действие трассировки в приложении Emulator, создайте сценарий, в котором бот отправляет такое действие трассировки. Например, можно создать исключение и отправить действие трассировки из обработчика ошибок на шаге адаптера.

Чтобы отправить из бота действие трассировки, сделайте следующее.

1. Создайте новое действие.
   - Присвойте его свойству _type_ (тип) значение "trace" (трассировка). Это обязательный шаг.
   - При желании задайте для трассировки подходящие значения свойств _name_ (имя), _label_ (метка), _value_ (значение) и _value type_ (тип значения).
1. Чтобы отправить действие трассировки, используйте _действие отправки_ из объекта _контекста шага_.
   - Этот метод добавляет значения для незаполненных обязательных свойств действия, используя сведения о входящем действии.
     Сюда относятся свойства _channel ID_ (идентификатор канала), _service URL_ (URL-адрес службы), _from_ (от кого) и _recipient_ (получатель).

Чтобы просмотреть действие трассировки в приложении Emulator, выполните следующие действия.

1. Запустите бота на локальном компьютере.
1. Выполните тестирование в Emulator.
   - Напишите что-нибудь боту, чтобы сработали те шаги в сценарии, которые создают действие трассировки.
   - Когда бот создаст действие трассировки, оно отобразится в журнале Emulator.

Ниже приведен пример операции трассировки, которую вы увидите при запуске бота Core без настройки базы знаний QnA Maker, от которой зависит этот бот.

![Снимок экрана Emulator](./media/using-trace-activities.png)

## <a name="add-a-trace-activity-to-the-adapters-on-error-handler"></a>Добавление действия трассировки в обработчик ошибок адаптера

_Обработчик ошибок шага_ адаптера перехватывает все неперехваченные в другом месте исключения, которые создаются ботом во время выполнения.
Это подходящее место для размещения действия трассировки, так как вы можете отправить понятное сообщение пользователю и отладочную информацию о возникшем исключении в Emulator.

В этом случае используется код из примера **Core Bot**. Ознакомьтесь с полным примером для [**C#** ](https://aka.ms/cs-core-sample), [**JavaScript**](https://aka.ms/js-core-sample) и [**Python**](https://aka.ms/py-core-sample).

# <a name="ctabcsharp"></a>[C#](#tab/csharp)

Обработчик адаптера **OnTurnError** создает действие трассировки, которое собирает сведения об исключении и отправляет их в эмулятор.

**AdapterWithErrorHandler.cs**

[!code-csharp[OnTurnError](~/../BotBuilder-Samples/samples/csharp_dotnetcore/13.core-bot/AdapterWithErrorHandler.cs?range=16-51&highlight=33-34)]

# <a name="javascripttabjavascript"></a>[JavaScript](#tab/javascript)

Обработчик адаптера **onTurnError** создает действие трассировки, которое собирает сведения об исключении и отправляет их в Emulator.

**index.js**

[!code-javascript[onTurnError](~/../BotBuilder-Samples/samples/javascript_nodejs/13.core-bot/index.js?range=35-57&highlight=8-14)]

# <a name="pythontabpython"></a>[Python](#tab/python)

Обработчик адаптера **on_error** создает действие трассировки, которое собирает сведения об исключении и отправляет их в Emulator.

**adapter_with_error_handler.py**

[!code-python[on_error](~/../BotBuilder-Samples/samples/python/13.core-bot/adapter_with_error_handler.py?range=26-50&highlight=24-25)]

---

## <a name="additional-resources"></a>Дополнительные ресурсы

- В статье [Отладка бота с помощью проверяющего ПО промежуточного слоя](../bot-service-debug-inspection-middleware.md) описывается, как добавить ПО промежуточного слоя для создания действий трассировки.
- Для отладки развернутого робота можно применить Application Insights. Дополнительные сведения см. в статье о [добавлении телеметрии в бот](bot-builder-telemetry.md).
- Дополнительные сведения о типах действий см. в статье о [схеме действий Bot Framework](https://aka.ms/botSpecs-activitySchema).
