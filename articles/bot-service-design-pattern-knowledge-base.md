---
title: Проектирование ботов базы знаний | Документация Майкрософт
description: Сведения о различных способах создания бота базы знаний, который находит и возвращает информацию в ответ на входные данные или запрос пользователя.
author: matvelloso
ms.author: mateusv
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 12/13/2017
ms.openlocfilehash: dd8869c26a87718177462db2508e41aa82810e21
ms.sourcegitcommit: f0b22c6286e44578c11c9f15d22b542c199f0024
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2018
ms.locfileid: "47404080"
---
# <a name="design-knowledge-bots"></a>Проектирование ботов базы знаний

Бот базы знаний может быть разработан для предоставления информации практически на любую тему. Например, один бот базы знаний может отвечать на вопросы о таких событиях, как "What bot events are there at this conference?", "When is the next Reggae show?" или "Who is Tame Impala?" Другой может ответить на вопросы, связанные с ИТ, такие как "How do I update my operating system?" или "Where do I go to reset my password?" Еще один может ответить на вопросы о таких контактах, как "Who is John Doe?" или "What is Jane Doe's email address?" 

Независимо от варианта использования, для которого создан бот базы знаний, его основная цель всегда одна и та же: найти и предоставить информацию, которую пользователь запросил, используя массив данных, таких как реляционные данные в базе данных SQL, данные JSON в нереляционном хранилище или PDF-файлы в хранилище документов. 

## <a name="search"></a>поиска

Функция поиска может быть ценным инструментом бота. 

Во-первых, "нечеткий поиск" позволяет боту предоставлять информацию, которая может иметь отношение к вопросу пользователя, не требуя, чтобы пользователь вводил точные входные данные. Например, если пользователь запрашивает у бота музыкальной базы знаний информацию об "impala" (вместо "Tame Impala"), бот может посылать информацию, которая, скорее всего, будет иметь отношение к этим входным данным.

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/fuzzySearch2.png)

Оценки поиска показывают уровень надежности результатов конкретного поиска, позволяя боту соответственно упорядочить результаты или даже настроить их связь на основе уровня надежности. Например, если уровень надежности высокий, бот может ответить "Here is the event that best matches your search".

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/searchScore2.png)

Если уровень надежности низкий, бот может ответить "Hmm... were you looking for any of these events?"

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/searchScore1.png)

### <a name="using-search-to-guide-a-conversation"></a>Использование поиска для ведения общения

Если необходимо включить базовую функциональность поисковой системы, бот может не понадобиться. Что же такого предлагает интерфейс общения, чего пользователи не могут получить из обычной поисковой системы в веб-браузере? 

Боты базы знаний, как правило, наиболее эффективны, если они предназначены для ведения общения. Общение состоит из обмена информацией между ботом и пользователем, который предоставляет боту возможность задавать уточняющие вопросы, предлагать варианты и проверять результаты таким образом, каким не способен выполнить базовый поиск. Например, следующий бот направляет пользователя в общении, ограничивая и фильтруя набор данных, пока не найдет информацию, которую ищет пользователь.

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/guidedConvo1.png)

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/guidedConvo2.png)

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/guidedConvo3.png)

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/guidedConvo4.png)

Обработав входные данные пользователя на каждом шаге и представив соответствующие параметры, бот направляет пользователям информацию, которую они ищут. Когда бот предоставит эту информацию, он может даже дать рекомендации относительно более эффективных способов поиска подобной информации в будущем. 

![Структура диалога](~/media/bot-service-design-pattern-knowledge-base/Training.png)

### <a name="azure-search"></a>Поиск Azure

Используя <a href="https://azure.microsoft.com/en-us/services/search/" target="_blank">Поиск Azure</a>, можно создать эффективный индекс поиска, с помощью которого бот может легко искать, ограничивать и фильтровать информацию. Рассмотрим индекс поиска, созданный с помощью портала Azure.

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/search3.PNG)

Если необходимо иметь доступ ко всем свойствам хранилища данных, установите каждое свойство как "retrievable". Если необходимо найти музыкантов по имени, установите свойство **Имя** как "searchable". Наконец, если необходимо иметь возможность ограничиваемого фильтра над эпохами музыкантов, установите свойство **Эпохи** как "facetable" и "filterable". 

Ограничение определяет значения, существующие в хранилище данных для данного свойства, а также величину каждого значения. Например, этот снимок экрана показывает, что в хранилище данных существует 5 различных эпох.

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/facet.png)

Фильтрация, в свою очередь, выбирает только указанные экземпляры определенного свойства. Например, можно отфильтровать результаты выше, чтобы содержались только те элементы, где **Эпоха** равна "Romantic". 

> [!NOTE]
> Полный пример бота базы знаний, который создается с использованием Azure Document DB, Поиска Azure и Microsoft Bot Framework, см. в <a href="https://github.com/ryanvolum/AzureSearchBot" target="_blank">примере бота</a> в репозитории GitHub.
> 
> Для простоты в приведенном выше примере показан индекс поиска, который создается с помощью портала Azure. 
> Индексы также могут создаваться программным путем.

## <a name="qna-maker"></a>QnA Maker

Некоторые боты базы знаний могут назначаться, чтобы просто отвечать на часто задаваемые вопросы (FAQs). 
<a href="https://www.microsoft.com/cognitive-services/en-us/qnamaker" target="_blank">QnA Maker</a> является мощным средством, предназначенным специально для этого варианта использования. Служба QnA Maker обладает встроенной способностью проверять вопросы и ответы на существующем сайте часто задаваемых вопросов, а также позволяет вручную настраивать собственный список вопросов и ответов. Служба QnA Maker имеет возможность обработки естественного языка, что позволяет ей даже отвечать на вопросы, сформулированные несколько иначе, чем ожидалось. Однако она не имеет возможностей распознавания семантического языка. Например, она не может определить, что щенок — это тип собаки. 

Используя веб-интерфейс службы QnA Maker, можно настроить базу знаний с тремя парами вопросов и ответов. 

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/KnowledgeBaseConfig.png)

Затем можно проверить ее, задав ряд вопросов. 

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/exampleQnAConvo.png)

Бот правильно отвечает на вопросы, которые непосредственно сопоставляются с теми, которые были настроены в базе знаний. Однако он неправильно отвечает на вопрос "can I bring my tea?", потому что этот вопрос наиболее похож по структуре на вопрос "can I bring my vodka?". Причина, по которой служба QnA Maker дает неверный ответ, заключается в том, что она не распознает смысл слова. Она не знает, что "tea" — это тип безалкогольного напитка. Поэтому она отвечает: "Alcohol is not allowed".

> [!TIP]
> Создайте пары QnA, а затем проверьте и переустановите бот, нажав кнопку "Проверить" в общении, чтобы выбрать альтернативный ответ для каждого неверного ответа. 

## <a name="luis"></a>LUIS

Некоторые боты базы знаний требуют возможности обработки естественного языка (NLP), чтобы анализировать сообщения пользователя для определения его намерений. 
[API распознавания речи (LUIS)](https://www.luis.ai) обеспечивает быстрое и эффективное средство добавления возможностей NLP к ботам. Служба LUIS позволяет использовать существующие, предварительно построенные модели от Bing и Cortana всякий раз, когда они соответствуют потребностям, а также создавать собственные специализированные модели. 

При работе с огромными наборами данных необязательно обучать модель NLP при каждом изменении сущности. Например, при работе с музыкальным ботом пользователь может сообщить "Play Reggae", "Play Bob Marley" или "Play One Love". Хотя бот мог сопоставлять каждое из этих сообщений с намерением "playMusic", не обучаясь каждому исполнителю, жанру и названию песни, модель NLP не сможет определить, является ли сущность жанром, исполнителем или песней. Используя модель NLP для идентификации универсальной сущности типа "music", бот может искать свое хранилище данных для этой сущности и исходить оттуда. 

## <a name="combining-search-qna-maker-andor-luis"></a>Объединение Поиска, QnA Maker и/или LUIS

Поиск, QnA Maker и LUIS — это все мощные средства, но они также могут быть объединены для создания ботов базы знаний, которые обладают более чем одной из этих возможностей.

### <a name="luis-and-search"></a>LUIS и Поиск

В примере бота музыкального фестиваля, [описанного ранее](#search), бот ведет общение, показывая кнопки, которые представляют список. Однако этот бот может также включать понимание естественного языка, используя LUIS для определения намерений и сущностей в таких вопросах, как "what kind of music does Romit Girdhar play?". Бот может выполнять поиск в индексе Поиска Azure, используя имя музыканта. 
 
Было бы невозможно обучить модель любому возможному имени музыканта, так как существует много возможных значений, но можно предоставить достаточно типичных примеров для LUIS, чтобы правильно идентифицировать попавшуюся сущность.  Например, учтите, что модель обучается на примерах музыкантов. 

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/answerGenre.png)
![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/answerGenreOneWord.png)

При тестировании этой модели с новыми высказываниями типа "what kind of music do the beatles play?", LUIS успешно определяет намерение "answerGenre" и идентифицирует сущность "beatles". Однако, если задать более длинный вопрос, например "what kind of music does the devil makes three play?", LUIS идентифицирует "the devil" как сущность.

![Структура диалогового окна](~/media/bot-service-design-pattern-knowledge-base/devilMakesThreeScore.png)

Обучая модель примерам сущностей, которые представляют собой базовый набор данных, можно повысить точность распознавания языка бота. 

> [!TIP]
> В общем, лучше, чтобы модель ошибалась, идентифицируя лишние слова в распознавании сущности, например "John Smith please" из высказывания "Call John Smith please", вместо того, чтобы идентифицировать слишком мало слов, например "John" из высказывания "Call John Smith please". Индекс поиска будет игнорировать неподходящее слова, такие как "please" во фразе"John Smith please". 

### <a name="luis-and-qna-maker"></a>LUIS и QnA Maker

Некоторые боты базы знаний могут использовать QnA Maker для ответа на основные вопросы в сочетании с LUIS, чтобы определять намерения, извлекать сущности и вызывать более сложные диалоги. К примеру, возьмем простой бот службы технической поддержки ИТ. Этот бот может использовать QnA Maker для ответа на основные вопросы о Windows или Outlook, но также может потребоваться облегчить такие сценарии, как сброс пароля, которые требуют распознавания намерений и обратной связи между пользователем и ботом. Существует несколько способов, с помощью которых бот может реализовать гибрид LUIS и QnA Maker.

1. Вызовите одновременно службы QnA Maker и LUIS и ответьте пользователю, используя информацию из первой, которая возвращает оценку определенного порога. 
2. Сначала вызовите LUIS, и если никакое намерение не соответствует определенному пороговому значению, например запускается намерение None, после чего вызывается QnA Maker. В качестве альтернативы создайте намерение LUIS для QnA Maker, предоставляя модель LUIS с примерами вопросов QnA, сопоставляемые с QnAIntent. 
3. Сначала вызовите QnA Maker и, если ответ не соответствует определенному пороговому значению, вызовите LUIS. 

Пакет SDK для Bot Builder предоставляет встроенную поддержку LUIS и QnA Maker. Это позволяет активировать диалоги или автоматически отвечать на вопросы с помощью LUIS и/или QnA Maker без необходимости реализации пользовательских вызовов для любого из этих средств. Дополнительные сведения см. в разделе [bot service templates](bot-service-concept-templates.md) (Шаблоны службы Azure Bot).

> [!TIP]
> При реализации комбинации LUIS, QnA Maker и/или Поиск Azure введите тестовые входные данные в каждое из средств, чтобы определить пороговое значение для каждой из моделей. Каждая из служб (LUIS, QnA Maker и Поиск Azure) генерирует значение, используя разные критерии оценки, поэтому оценки, полученные в этих средствах, не сопоставляются напрямую. Кроме того, LUIS и QnA Maker нормализуют оценки. Определенную оценку можно считать "хорошей" в одной модели LUIS, но "не очень" в другой модели. 

## <a name="sample-code"></a>Пример кода

- Пример, в котором показано, как создать базовый бот базы знаний с помощью пакета SDK Bot Builder для .NET, см. в <a href="https://aka.ms/qna-with-appinsights" target="_blank">примере бота базы знаний</a> в репозитории GitHub. 
<!-- TODO: Do not have a current bot sample to work with this
- For a sample that shows how to create more complex knowledge bots using the Bot Builder SDK for .NET, see the <a href="https://github.com/Microsoft/BotBuilder-Samples/tree/master/CSharp/demo-Search" target="_blank">Search-powered Bots sample</a> in GitHub.
-->

[qnamakerTemplate]: https://docs.botframework.com/en-us/azure-bot-service/templates/qnamaker/#navtitle
