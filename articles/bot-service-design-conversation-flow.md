---
title: Проектирование потока диалога и управление им | Документация Майкрософт
description: Сведения о создании потока беседы в боте и управлении им для обеспечения высокого уровня взаимодействия.
keywords: design, control, conversation flow, handle interruptions, overview
author: v-ducvo
ms.author: v-ducvo
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 4/8/2018
ms.openlocfilehash: 09568fca31649880df0f5b4fbc47f50288e907cb
ms.sourcegitcommit: f576981342fb3361216675815714e24281e20ddf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2018
ms.locfileid: "39301184"
---
::: moniker range="azure-bot-service-3.0"

# <a name="design-and-control-conversation-flow"></a>Проектирование потока беседы и управление им

В обычном приложении пользовательский интерфейс представляет собой серию экранов. 
Одно приложение или веб-сайт могут использовать один или несколько экранов по мере необходимости для обмена информацией с пользователем. 
В большинстве приложений сначала открывается основной экран, который предоставляет средства навигации, помогающие перейти к другим экранам для выполнения различных функций, таких как запуск нового заказа, просмотр продуктов или получение помощи.

Как у приложений и веб-сайтов, у ботов есть пользовательский интерфейс, но он состоит из **диалоговых окон**, а не экранов. 
Диалоговые окна позволяют разработчику ботов логически разделять различные области функций бота и направлять поток беседы. Например, вы можете создать один диалог, содержащий логику, которая помогает пользователю просматривать продукты, и отдельный диалог, содержащий логику, которая помогает пользователю создать новый заказ. 

Диалоговые окна могут содержать графические интерфейсы. Они могут содержать кнопки, текст и другие элементы или быть полностью речевыми. Кроме того, диалоговые окна содержат действия для выполнения таких задач, как вызов других диалоговых окон или обработка входных данных пользователя.

## <a name="using-dialogs-to-manage-conversation-flow"></a>Использование диалогов для управления потоком беседы

[!INCLUDE [Dialog flow example](~/includes/snippet-dotnet-manage-conversation-flow-intro.md)]

Подробное руководство по управлению потоком беседы с помощью пакетов SDK для Bot Builder см. в следующих статьях:

- [Управление потоком беседы с помощью диалогов (.NET)](~/dotnet/bot-builder-dotnet-manage-conversation-flow.md)
- [Управление потоком беседы с помощью диалогов (.Node.js)](~/nodejs/bot-builder-nodejs-manage-conversation-flow.md)

## <a name="dialog-stack"></a>Стек диалоговых окон

Когда одно диалоговое окно вызывает другое, Bot Builder добавляет новое диалоговое окно в начало стека окон. 
В диалоговом окне, находящемся в начале стека, можно управлять беседой. 
Каждое новое сообщение, отправленное пользователем, будет обрабатываться в этом диалоговом окне до тех пор, пока оно не будет закрыто или перенаправлено в другое окно. 
Если закрыть диалоговое окно, оно удалится из стека, и предыдущее диалоговое окно в стеке будет управлять беседой. 

> [!IMPORTANT]
> Понимание концепции того, как стек диалоговых окон создается и деконструируется в Bot Builder (так как диалоговые окна ссылаются друг на друга, закрываются и т. д.), имеет решающее значение в эффективной разработке потока беседы бота. 

## <a name="dialogs-stacks-and-humans"></a>Диалоговые окна, стеки и люди

Было бы заманчиво предположить, что пользователи будут перемещаться по диалоговым окнам, создавая стек окон, и в какой-то момент возвратятся назад, где находились изначально, убирая диалоговые окна из стека один за одним упорядоченным образом. 
Например, пользователь начнет работу в корневом диалоговом окне, вызовет диалоговое окно нового заказа, а затем — окно поиска продукта. 
После этого пользователь выберет продукт и подтвердит выбор, покинет диалоговое окно поиска продукта, выполнит заказ, покинет диалоговое окно нового заказа и вернется в корневое окно. 

Было бы хорошо, если бы пользователи всегда выполняли переход по линейному логическому пути, но это происходит редко. 
Люди не могут вести беседу в "стеках". Они часто меняют свое мнение. 
Рассмотрим следующий пример. 

![бот](~/media/bot-service-design-conversation-flow/stack-issue.png)

Хотя бот может логически строить стек диалоговых окон, пользователь может решить сделать что-то совершенно другое или задать вопрос, который может быть не связан с текущей темой. 
В примере пользователь спрашивает, а не предоставляет ответ "Да" или "Нет", который ожидает диалоговое окно. 
Как должно реагировать диалоговое окно?

- Пользователю сначала нужно ответить на вопрос. 
- Не обращать внимание на все, что сделал пользователь ранее, сбросить весь стек диалоговых окон и начать с самого начала, пытаясь ответить на вопрос пользователя. 
- Попытаться ответить на вопрос пользователя, а затем вернуться к вопросу с ответом "Да" или"Нет" и продолжить работу с того момента. 

Нет единственного *правильного* ответа на этот вопрос, лучшее решение будет зависеть от особенностей сценария и ожидания пользователя на ответ от бота. 

## <a name="next-steps"></a>Дополнительная информация

Управление пользовательской навигацией в диалоговых окнах и создание потока беседы таким образом, чтобы пользователи могли достичь своих целей (даже нелинейно), является основной задачей разработки бота. 
В статье [Разработка навигации бота](~/bot-service-design-navigation.md) рассматриваются некоторые распространенные ошибки плохо разработанной навигации, а также описываются стратегии предотвращения этих ловушек. 

::: moniker-end

::: moniker range="azure-bot-service-4.0"
# <a name="design-and-control-conversation-flow"></a>Проектирование потока беседы и управление им

В обычном приложении пользовательский интерфейс состоит из серии экранов, и одно приложение или веб-сайт могут использовать один или несколько экранов по мере необходимости для обмена информацией с пользователем. 
В большинстве приложений сначала открывается основной экран, который предоставляет средства навигации, помогающие перейти к другим экранам для выполнения различных функций, таких как запуск нового заказа, просмотр продуктов или получение помощи.

Как у приложений и веб-сайтов, у ботов есть пользовательский интерфейс, но он состоит из **сообщений**, а не экранов. Сообщения могут содержать кнопки, текст и другие элементы или быть полностью речевыми. 

Хотя обычное приложение или веб-сайт могут запрашивать сразу несколько фрагментов информации на экране, бот будет собирать одинаковый объем информации с помощью нескольких сообщений. Таким образом, процесс сбора информации от пользователя является активным взаимодействием, при котором пользователь ведет активную беседу с ботом. 

Хорошо спроектированный бот будет содержать поток бесед, который кажется естественным. Бот должен уметь легко справляться с основной беседой и обрабатывать прерывания или плавно переключать темы разговоров. 

## <a name="procedural-conversation-flow"></a>Процедурный поток беседы

Беседа с ботом, как правило, сосредоточена на задаче, которую бот пытается выполнить. Это и называется процедурным потоком. Именно здесь бот задает пользователю ряд вопросов, чтобы собрать всю необходимую информацию перед обработкой задачи.

В процедурном потоке беседы вы определяете порядок вопросов, и бот будет задавать вопросы в указанном вами порядке. Вы можете организовать вопросы в *логические модули*, чтобы централизовать код, сосредоточившись на управлении беседой. Например, вы можете создать один модуль, содержащий логику, которая помогает пользователю просматривать продукты, и отдельный модуль, содержащий логику, которая помогает пользователю создать новый заказ. 

Вы можете структурировать эти модули любым способом, начиная от произвольной формы и заканчивая последовательной. Пакет SDK для Bot Builder предоставляет несколько библиотек, которые позволяют создавать любые потоки бесед, которые нужны боту. Например, библиотека `prompts` позволяет запрашивать входные данные пользователей, библиотека `waterfall` позволяет определить последовательность пары вопрос–ответ, библиотека `dialog control` позволяет модулизовать логику потока беседы и т. д. Все эти библиотеки связаны между собой с помощью объекта `dialogs`. Давайте подробнее рассмотрим реализацию модулей в качестве `dialogs` для разработки потоков бесед и управления ими, а также, как этот поток похож на стандартную блок-схему приложения.

![бот](~/media/designing-bots/core/dialogs-screens.png)

В обычном приложении все начинается с **основного экрана**.
**Основной экран** вызывает **экран нового заказа**.
**Экран нового заказа** используется в качестве элемента управления до его закрытия или вызова других экранов, например **экрана поиска продукта**. 
Если **экран нового заказа** закрывается, пользователь возвращается на **основной экран**.

В боте все начинается с **корневого диалогового окна**. 
**Корневое диалоговое окно** вызывает **диалоговое окно нового заказа**. 
При этом **диалоговое окно нового заказа** берет на себя управление диалогом и отображается до его закрытия или вызова других диалоговых окон, таких как **диалоговое окно поиска продукта**. 
Если **диалоговое окно нового заказа** закрывается, управление беседой берет на себя **корневое диалоговое окно**.

Дополнительные сведения о типах бесед см. в [этой статье](v4sdk/bot-builder-conversations.md).

## <a name="handle-interruptions"></a>Обработка прерываний

Было бы заманчиво предположить, что пользователи будут выполнять процедурные задачи по очереди упорядоченным образом. 
Например, в процедурном потоке беседы с помощью `dialogs` пользователь начнет работу в корневом диалоговом окне, вызовет диалоговое окно нового заказа, а затем — окно поиска продукта. После этого пользователь выберет продукт и подтвердит выбор, покинет диалоговое окно поиска продукта, выполнит заказ, покинет диалоговое окно нового заказа и вернется в корневое окно. 

Было бы хорошо, если бы пользователи всегда выполняли переход по линейному логическому пути, но это происходит редко. 
Люди не ведут беседу в последовательных `dialogs`. Они часто меняют свое мнение. 
Рассмотрим следующий пример. 

![бот](~/media/bot-service-design-conversation-flow/stack-issue.png)

Пока бот будет выполнять процедуру, пользователь может решить сделать что-то совершенно другое или задать вопрос, который может быть не связан с текущей темой. 
В примере выше пользователь спрашивает, а не предоставляет ответ "Да" или "Нет", который ожидает бот. 
Как должен отвечать бот?

- Пользователю сначала нужно ответить на вопрос. 
- Не обращать внимание на все, что сделал пользователь ранее, сбросить весь стек диалоговых окон и начать с самого начала, пытаясь ответить на вопрос пользователя. 
- Попытаться ответить на вопрос пользователя, а затем вернуться к вопросу с ответом "Да" или"Нет" и продолжить работу с того момента. 

Нет единственного *правильного* ответа на этот вопрос, лучшее решение будет зависеть от особенностей сценария и ожидания пользователя на ответ от бота. Дополнительные сведения см. в статье [Обработка прерываний пользователя](v4sdk/bot-builder-howto-handle-user-interrupt.md).

## <a name="next-steps"></a>Дополнительная информация

Управление пользовательской навигацией в диалоговых окнах и создание потока беседы таким образом, чтобы пользователи могли достичь своих целей (даже нелинейно), является основной задачей разработки бота. 
В статье [Разработка навигации бота](~/bot-service-design-navigation.md) рассматриваются некоторые распространенные ошибки плохо разработанной навигации, а также описываются стратегии предотвращения этих ловушек. 

::: moniker-end
