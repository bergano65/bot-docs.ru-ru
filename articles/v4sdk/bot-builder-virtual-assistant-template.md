---
title: Обзор шаблона виртуального помощника | Документация Майкрософт
description: Дополнительные сведения о шаблоне виртуального помощника
author: darrenj
ms.author: darrenj
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.date: 05/06/2019
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 36a4b01dfc19cfab747de281c65d7166cb05f406
ms.sourcegitcommit: 39d548b2d2fb050d72cf7b6c8fe389b47d0c9099
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65168968"
---
# <a name="virtual-assistant---template-outline"></a>Виртуальный помощник — описание шаблона

> [!NOTE]
> Приведенные здесь сведения относятся к пакету SDK версии 4. 

Шаблон виртуального помощника объединяет лучшие методики, определенные нами при создании решений для ведения диалога, и автоматизирует интеграцию компонентов, которые мы считаем очень полезными для разработчиков, работающих с платформой Bot Framework. В этом разделе содержатся общие сведения о ключевых решениях, которые помогут понять, почему шаблон работает именно так, а не иначе.

Функция      | ОПИСАНИЕ |
------------ | -------------
Введение | Приветственное сообщение с [адаптивной карточкой]() в начале беседы.
Индикаторы ввода  | Автоматизированные визуальные индикаторы ввода при ведении беседы и повторная отправка сообщений для длительных операций.
Базовая модель LUIS  | Поддерживает распространенные намерения, например **Отмена**, **Справка**, **Эскалация** и т. д.
Базовые диалоги | Потоки диалогов для записи базовой информации о пользователе, а также логики прерывания для намерений отмены и справки.
Базовые ответы  | Текстовые и голосовые ответы для базовых намерений и диалогов.
Часто задаваемые вопросы | Интеграция с [QnA Maker](https://www.qnamaker.ai) для предоставления ответов на общие вопросы из базы знаний. 
Беседа | Модель беседы с профессионалом для предоставления стандартных ответов на распространенные вопросы ([подробнее](https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/how-to/chit-chat-knowledge-base)).
Диспетчер | Интегрированная модель [Dispatch](https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-tutorial-dispatch?view=azure-bot-service-4.0&tabs=csaddref%2Ccsbotconfig), которая позволяет определить, нужно ли обработать конкретный речевой фрагмент с помощью LUIS или QnA Maker.
Поддержка языков | Доступно на английском, французском, итальянском, немецком, испанском и китайском языках.
Расшифровка | Расшифровки всех бесед, хранящихся в службе хранилища Azure.
Телеметрия  | Интеграция с [Application Insights](https://azure.microsoft.com/en-gb/services/application-insights/) для сбора телеметрии всех бесед.
Analytics | Пример панели мониторинга Power BI для начала работы с аналитическими сведениями о ведении бесед.
Автоматизированное развертывание | Простое развертывание всех упомянутых выше служб с помощью шаблонов Azure ARM.

## <a name="introduction-card"></a>Карточка с вводными сведениями

Использование многих решений для ведения диалога сопряжено с одной проблемой: пользователь не знает, с чего начать, и задает общие вопросы, с ответом на которые бот может справиться не лучшим образом. А ведь первое впечатление играет важную роль! Карточка с вводными сведениями содержит информацию о возможностях бота и предлагает пользователю на выбор несколько начальных вопросов, которые помогут ему приступить к работе с ботом. Это также отличная возможность подчеркнуть отличие вашего бота от других.

Предоставляется стандартная карточка простого знакомства, которую вы можете настроить под конкретные потребности. При операциях, которые выполняются после диалога подключения (он запускается кнопкой "Приступить к работе" на карточке знакомства), отображается ответная карточка пользователя.

![Пример карточки знакомства](./media/enterprise-template/vabotintrocard.png)

## <a name="basic-language-understanding-luis-intents"></a>Базовые намерения Интеллектуальной службы распознавания речи (LUIS)

Каждый бот должен понимать естественный язык на базовом уровне. Например, приветствие — это базовая задача, с которой любой бот должен легко справляться. В общем случае разработчики должны создавать подобные базовые намерения и предоставлять данные для начального обучения, которые позволят приступить к работе с ботом. Шаблон виртуального помощника изначально поддерживает базовые возможности и содержит примеры файлов распознавания речи (LU-файлы). Это означает, что вам не нужно создавать эти файлы всякий раз, когда вы начинаете новый проект.

В файлах распознавания речи представлены следующие намерения на английском, китайском, французском, итальянском, немецком и испанском языках.

Намерение       | Примеры речевых фрагментов |
-------------|-------------|
Отмена       |*Отмена*, *Неважно*|
Эскалация     |*Можно поговорить с человеком?*|
FinishTask   |*Готово*, *Все выполнено*|
GoBack       |*Назад*|
Справка         |*Поможешь мне?*|
Repeat       |*Можно повторить?*|
SelectAny    |*Любой вариант*|
SelectItem   |*Первый вариант*|
SelectNone   |*Ни один из вариантов*|
ShowNext     |*Показать больше*|
ShowPrevious |*Показать предыдущие варианты*|
StartOver    |*restart*|
Остановить         |*stop*|

Формат [LU](https://github.com/Microsoft/botbuilder-tools/blob/master/packages/Ludown/docs/lu-file-format.md)-файлов аналогичен формату MarkDown. Такие файлы легко изменять, и их поддерживает система управления версиями Средство [LuDown](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/Ludown) преобразовывает LU-файлы в модели LUIS, которые затем можно опубликовать в подписке LUIS либо с помощью портала, либо с помощью командной строки [LUIS](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/LUIS).

## <a name="telemetry"></a>Телеметрия

Сбор аналитических сведений о вовлеченности пользователя в работу с ботом оказалось очень важным делом. Такие сведения помогают понять уровень вовлеченности пользователей, какие функции ботов они используют (намерения), на какие вопросы бот не может ответить. Все это позволяет выявить пробелы в знаниях бота, которые можно устранить, например, с помощью новых статей QnA Maker.

Интеграция с Application Insights позволяет в стандартной конфигурации получать ценные аналитические сведения эксплуатационного и технического характера, а также собирать данные о событиях в работе бота (отправленные и полученные сообщения, операции с LUIS и QnA Maker).

Данные телеметрии на уровне бота по своей природе связаны с данными телеметрии о его технических и эксплуатационных параметрах, что позволяет проверять, как бот отвечает на вопрос определенного пользователя и наоборот.

Компонент ПО промежуточного слоя в сочетании с классом-оболочкой QnA Maker и классами пакета SDK LuisRecognizer предоставляют удобный способ для сбора согласованного набора событий. Эти согласованные события затем могут использоваться средствами Application Insights, а также такими инструментами, как Power BI.

Пример панели мониторинга PowerBI включен в репозиторий решений Bot Framework на сайте GitHub и готов к работе с любым шаблоном виртуального помощника без дополнительной настройки. См. дополнительные сведения в разделе о [данных аналитики](https://github.com/Microsoft/AI/blob/master/docs/readme.md#analytics).

![Пример данных аналитики](./media/enterprise-template/powerbi-conversationanalytics-luisintents.png)

## <a name="dispatcher"></a>Диспетчер

Основной конструктивный шаблон, эффективно примененный при создании первой волны решений для ведения диалога, основан на возможностях службы "Распознавание речи" (LUIS) и QnA Maker. Служба LUIS обучалась по задачам, которые бот может выполнять для конечного пользователя, а QnA Maker — по более общим знаниям.

Все входящие фразы (вопросы) перенаправлялись в LUIS для анализа. Если намерение определенной фразы было не распознано, она помечалась как фраза без намерения. В этом случае для поиска ответа на вопрос пользователя применялась служба QnA Maker.

Такая схема работала хорошо, но существовали два основных сценария, в которых могли возникать проблемы.

- Если фразы в модели LUIS и QnA Maker иногда частично совпадали, это могло приводить к странному поведению, при котором служба LUIS пыталась обработать вопрос, который должен быть передан в QnA Maker.
- При использовании двух и более моделей LUIS боту было необходимо вызывать каждую из них и выполнять своего рода сравнительную оценку намерений, чтобы определить, куда отправить определенную фразу. Так как общей базовой оценки не существует, сравнение между моделями работало плохо, из-за чего взаимодействие пользователя и бота было неэффективным.

[Dispatcher](https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-tutorial-dispatch?view=azure-bot-service-4.0&tabs=csaddref%2Ccsbotconfig) обеспечивает изящное решение этой проблемы. Это средство извлекает фразы из каждой настроенной модели LUIS и вопросы из QnA Maker и создает централизованную модель диспетчеризации для LUIS.

Это позволяет боту быстро определять, какой компонент или модель LUIS должны обрабатывать определенную фразу. Более того, данные службы QnA Maker принимаются во внимание на начальном этапе обработки намерений, а не только для обработки фраз, для которых не удалось определить намерение, как было раньше.

Кроме того, средство диспетчеризации позволяет выявлять разногласия и совпадения между моделями LUIS и базами знаний QnA Maker еще до развертывания.

Средство Dispatch лежит в основе каждого проекта, созданного с помощью шаблона. Модель Dispatch используется в классе `MainDialog` и позволяет определить, что является целевым объектом: модель LUIS или QnA. Если целевым объектом является модель LUIS, вызывается вторичная модель LUIS, возвращающая намерение и сущности в обычном порядке. Средство Dispatch также используется для обнаружения прерываний.

![Пример работы со средством Dispatch](./media/enterprise-template/dispatchexample.png)

## <a name="qna-maker"></a>QnA Maker

[QnA Maker](https://www.qnamaker.ai/) позволяет пользователям, которые не являются разработчиками, курировать общие знания в формате пар "вопрос — ответ". Эти знания можно импортировать из таких источников данных, как списки часто задаваемых вопросов и руководства по продуктам. Их также можно импортировать в интерактивном режиме на портале QnA Maker.

Два примера моделей QnA Maker предоставляются в формате файла [LU](https://github.com/Microsoft/botbuilder-tools/blob/master/packages/Ludown/docs/lu-file-format.md) в папке QnA для CognitiveModels. Одна из этих моделей отвечает за вопросы и ответы, а другая — за беседы в чате. Скрипт развертывания использует [LuDown](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/Ludown), чтобы создать JSON-файл QnA Maker, который затем используется в командной строке [QnA Maker](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/QnAMaker) для публикации элементов в базе знаний QnA Maker.

![Пример QnA ChitChat](./media/enterprise-template/qnachitchatexample.png)

## <a name="content-moderator"></a>Content Moderator

Дополнительный компонент Content Moderator позволяет обнаруживать ненормативную лексику и помогает обнаруживать персональные данных в содержимом. Боты с этой функцией могут реагировать на ненормативную лексику или разглашение пользователем персональных данных. Например, бот может принести извинения и переключить пользователя на оператора-человека или не сохранять данные телеметрии, если обнаружены персональные данные.

Присутствует компонент ПО промежуточного слоя, который проверяет тексты и изображения с помощью ```TextModeratorResult``` в объекте TurnState.

# <a name="next-steps"></a>Дальнейшие действия
См. статью о том, как [создать и развернуть виртуального помощника](https://github.com/Microsoft/AI/tree/master/docs#tutorials). 

# <a name="additional-resources"></a>Дополнительные ресурсы
Полный исходный код виртуального помощника можно найти на портале [GitHub](https://github.com/Microsoft/AI/).

