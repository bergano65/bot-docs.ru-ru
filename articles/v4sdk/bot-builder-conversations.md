---
title: Общения в пакете SDK для Bot Builder | Документация Майкрософт
description: Описание общения в пакете SDK для Bot Builder.
keywords: conversation flow, recognize intent, single turn, multiple turn, bot conversation
author: jonathanfingold
ms.author: jonathanfingold
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 09/01/2018
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 55145b4728d325bd258cc2cd95f3a265aaa50b0a
ms.sourcegitcommit: b8bd66fa955217cc00b6650f5d591b2b73c3254b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2018
ms.locfileid: "49326461"
---
# <a name="conversation-flow"></a>Последовательность общения
[!INCLUDE [pre-release-label](../includes/pre-release-label.md)]

Проектирование последовательности общения бота включает решение, как бот отвечает, когда пользователь что-то ему говорит. Бот сначала распознает тему задачи или общения на основе сообщения от пользователя. Чтобы определить задачу или тему (известную как *намерение*), связанную с сообщением пользователя, бот может искать слова или шаблоны в тексте сообщения пользователя или воспользоваться такими службами, как [Интеллектуальная служба распознавания речи](bot-builder-concept-luis.md) и [QnA Maker](https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/overview/overview).

Как только бот распознает намерение пользователя, в зависимости от сценария он может выполнить запрос пользователя с помощью одного ответа, завершить общение за одно включение или потребовать серию включений. Для множественных включений последовательности общения пакет SDK Bot Builder предоставляет [управление состоянием](./bot-builder-howto-v4-state.md) для отслеживания общения, [приглашения](bot-builder-prompts.md) для запроса информации и [диалоги](bot-builder-dialog-manage-conversation-flow.md) для формирования последовательности общения.

В сложном боте с несколькими подсистемами может использоваться несколько сервисов для распознавания намерения, по одному для каждого подкомпонента бота. Если объединить подсистемы общения в один бот, [средство Dispatch](bot-builder-tutorial-dispatch.md) будет получать результаты нескольких служб в одном расположении.

<!-- 
A conversation identifies a series of activities sent between a bot and a user on a specific channel and represents an interaction between one or more bots and either a _direct_ conversation with a specific user or a _group_ conversation with multiple users.
A bot communicates with a user on a channel by receiving activities from, and sending activities to the user.

- Each user has an ID that is unique per channel.
- Each conversation has an ID that is unique per channel.
- The channel sets the conversation ID when it starts the conversation.
- The bot cannot start a conversation; however, once it has a conversation ID, it can resume that conversation.
- Not all channels support group conversations.
-->

## <a name="single-turn-conversation"></a>Общение с одним включением

Общение с одним включением — это самый простой вид последовательности общения. В этом виде потока бот заканчивает свою задачу за один ход, состоящий из одного сообщения от пользователя и одного ответа от бота.

<!-- The following isn't always true, it's a generalization -->

Простейший вид бота с одной репликой не нуждается в отслеживании состояния общения. Каждый раз при получении сообщения, ответ выполняется на основе контекста текущего входящего сообщения без знания прошлых включений общения.

![Бот погоды с одним включением](./media/concept-conversation/weather-single-turn.png)

Например, у бота погоды может быть одна реплика. Он попросту дает пользователю отчет о погоде без уточняющих вопросов о городе или дате. Вся логика для отображения погоды основана на недавно полученном сообщении. На каждом этапе общения бот получает [контекст реплик](bot-builder-concept-activity-processing.md#turn-context), который он может использовать, чтобы определить, что делать дальше и каким будет процесс общения.

## <a name="multiple-turns"></a>Общение с множеством включений

Большинство типов общения невозможно выполнить за одно включение, поэтому бот может иметь несколько включений последовательности общения. Некоторые сценарии, требующие нескольких включений общения, вмещают следующее.

* Бот, который запрашивает у пользователя дополнительную информацию, необходимую для выполнения задачи. Бот должен отслеживать, имеет ли он все параметры для выполнения задачи.
* Бот, который проводит пользователя через шаги процесса, например размещение заказа. Бот должен отслеживать, где пользователь находится в последовательности шагов.

Например, у бота погоды может быть несколько реплик, если он отвечает на вопрос "Какая погода?", запрашивая город.

![разговор о погоде со множеством включений](./media/concept-conversation/weather-multi-turn.png)

Когда пользователь отвечает на вопрос бота о городе и называет: "Сиэтл", бот должен иметь некоторый контекст, чтобы понять, что текущее сообщение является ответом на предыдущий вопрос и частью запроса о погоде. Боты со множеством включений отслеживают состояние для надлежащего реагирования на новые сообщения.

Дополнительные сведения см. в статье [Управление состоянием диалога и пользователя](bot-builder-howto-v4-state.md).

> [!NOTE]
> Общение со множеством включений с клиентами REST API должны отслеживать их состояние, например в хранилище базы данных или таблицы.

## <a name="conversation-topics"></a>Темы общения

Можно разработать бот для обработки более чем одного типа задачи. Например, у нас есть бот, который предоставляет разные последовательности реплик: для приветствия пользователя, размещения заказа, отмены заказа и получения помощи. Один из способов управления этим переключением между общением для разных задач или тем общения — это распознать намерение (то, что пользователь хочет сделать) из текущего сообщения.

### <a name="recognize-intent"></a>Распознавание намерения

Пакет SDK для Bot Builder предоставляет _программы-распознаватели_, которые могут обрабатывать сообщения для определения намерения, чтобы бот мог инициировать соответствующую последовательность реплик. Вызовите асинхронный метод _распознавания_, чтобы распознаватель мог определять намерения пользователя на основе содержимого их сообщений. Затем можно применить метод _получения основных оценочных намерений_ к результату, чтобы получать наиболее вероятные прогнозы распознавателя.

Распознаватель может использовать регулярные выражения, распознавание языка или другую разрабатываемую вами логику. Примеры распознавателей:

* Распознаватель, использующий QnA Maker для определения вопроса пользователя, ответ на который есть в базе знаний.
* Распознаватель, использующий Интеллектуальную службу распознавания речи (LUIS), чтобы обучить службу на примерах обращений пользователей за помощью, и сопоставить их с намерением `Help`.
* Настраиваемый распознаватель, использующий регулярные выражения для поиска команд.
* Настраиваемый распознаватель, использующий службу для преобразования входных данных.

### <a name="consider-how-to-interrupt-conversation-flow-or-change-topics"></a>Прерывание последовательности общения или изменение темы

Один из способов следить, где вы находитесь в общении, — использование [состояния общения](bot-builder-howto-v4-state.md) для сохранения сведений о текущей активной теме или о том, какие шаги в последовательности были завершены.

Когда бот становится более сложным, можно просмотреть распределение последовательности потоков общения. Например, бот вызывает новую последовательность заказа, а затем вызовет последовательность поиска продукта. Затем пользователь выберет продукт и подтвердит завершение поиска продукта и завершит заказ.

Но диалог редко строится так просто и логично. Пользователи не взаимодействуют в "стеках", они часто их меняют. Рассмотрим следующий пример.

![Пользователь говорит что-то непредвиденное.](./media/concept-conversation/interruption.png)

Хотя бот может логически строить стек последовательностей, пользователь может решить сделать что-то совершенно другое или задать вопрос, который может быть не связан с текущей темой. В примере пользователь спрашивает, а не предоставляет ответ "yes" или "no", который ожидает последовательность. Как должна реагировать последовательность?

* Пользователю сначала нужно ответить на вопрос.
* Не обращайте внимания на все, что сделал пользователь ранее, сбросьте весь стек последовательности и начните с самого начала, пытаясь ответить на вопрос пользователя.
* Попытайтесь ответить на вопрос пользователя, а затем вернуться к вопросу с ответом "Да" или"Нет" и продолжить работу с того момента.

Нет единого правильного ответа на этот вопрос, лучшее решение будет зависеть от особенностей сценария и ожидания пользователя на ответ от бота. Дополнительные сведения об управлении процессом общения см. в статьях об [использовании диалогов](bot-builder-dialog-manage-conversation-flow.md) и [обработке прерываний](bot-builder-howto-handle-user-interrupt.md).

## <a name="conversation-lifetime"></a>Время существования общения

<!-- Note: these activities are dependent on whether the channel actually sends them. Also, we should add links --> Бот получает активность _обновления общения_ всякий раз, когда его добавляют в общение, добавляются или удаляются из общения другие участники или меняются метаданные общения.
Бот может реагировать на действия обновления общения, приветствуя пользователя или представляя самого себя.

Бот получает действие _конец общения_, чтобы указать, что пользователь закончил общение. Бот может отправить действие _конца общения_, чтобы указать на то, что общение окончено.
По завершении общения информацию о нем можно удалить.

<!--  Types of conversations -->

Бот может поддерживать диалоги с множеством реплик, когда он дает пользователю подсказки в отношении большого количества фрагментов информации. Бот может фокусироваться на конкретной задаче или поддерживать несколько типов задач.
В пакет SDK Bot Builder встроено несколько функций поддержки Интеллектуальной службы распознавания речи (LUIS) и QnA Maker, что позволяет добавлять в бот функцию "вопрос-ответ" на естественном языке.

## <a name="conversations-channels-and-users"></a>Общения, каналы и пользователи

Общения могут быть либо _прямыми_ — с конкретным пользователем или _групповыми_ — с несколькими пользователями.
Бот взаимодействует с пользователем по каналу, получая и отправляя действия пользователю.

* Каждый пользователь имеет идентификатор, который является уникальным для канала.
* У каждого общения есть идентификатор, который является уникальным для канала.
* Канал задает идентификатор общения, когда начинает общение.
* Бот не может начать общение. Тем не менее если он имеет идентификатор общения, то можно возобновить это общение.
* Не все каналы поддерживают групповые беседы.

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Управление простым процессом общения с помощью диалогов](bot-builder-dialog-manage-conversation-flow.md)

<!-- In addition, your bot can send activities back to the user, either _proactively_, in response to internal logic, or _reactively_, in response to an activity from the user or channel.-->
<!--TODO: Link to messaging how tos.-->
