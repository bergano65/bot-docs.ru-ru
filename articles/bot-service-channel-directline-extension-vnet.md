---
title: Использование расширения Службы приложений Direct Line в виртуальной сети
titleSuffix: Bot Service
description: Использование расширения Службы приложений Direct Line в виртуальной сети
services: bot-service
manager: kamrani
ms.service: bot-service
ms.topic: conceptual
ms.author: kamrani
ms.date: 07/25/2019
ms.openlocfilehash: a37ae6f3a9a9cd43c28d353745f0da9065a7886b
ms.sourcegitcommit: a1eaa44f182a7210197bd793250907df00e9edab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2019
ms.locfileid: "68757756"
---
## <a name="use-direct-line-app-service-extension-within-a-vnet"></a>Использование расширения Службы приложений Direct Line в виртуальной сети

В этой статье описывается, как применить расширение службы приложений Direct Line в виртуальной сети Azure (VNET).

### <a name="create-an-app-service-environment-and-other-azure-resources"></a>Создание Среды службы приложений Azure и других ресурсов Azure

1. Расширение Службы приложений Direct Line доступно во всех **Службах приложений Azure**, включая размещенные в **Среде службы приложений Azure**. Среда службы приложений Azure обеспечивает изоляцию и идеально подходит для работы в виртуальной сети.
    - Инструкции по созданию внешней Среды службы приложений вы можете найти в [этой статье](https://docs.microsoft.com/en-us/azure/app-service/environment/create-external-ase).
    - Инструкции по созданию внутренней Среды службы приложений вы можете найти в [этой статье](https://docs.microsoft.com/en-us/azure/app-service/environment/create-ilb-ase).
1. После создания Среды службы приложений следует добавить в нее план Службы приложений, в котором вы сможете развернуть ботов (что приведет к запуску расширения Службы приложений Direct Line). Для этого:
    - Перейдите на сайт https://portal.azure.com/.
    - Создайте новый ресурс "План службы приложений".
    - В поле "Регион" выберите свою Среду службы приложений.
    - Завершите создание плана службы приложений.

### <a name="configure-the-vnet-network-security-groups-nsg"></a>Настройте группы безопасности сети (NSG) для виртуальной сети.

1. Для расширения службы приложений Direct Line требуется исходящее подключение, чтобы оно могло создавать HTTP-запросы. Его можно настроить в виде правила исходящего трафика в группе безопасности сети для виртуальной сети, которая связана с подсетью Среды службы приложений. Требуется правило следующего вида:

|Источник|Любой|
|---|---|
|Исходный порт|*|
|Место назначения|IP-адреса|
|IP-адреса назначения|52.155.168.246, 13.83.242.172|
|Диапазоны портов назначения|443|
|Протокол|Любой|
|Действие|РАЗРЕШИТЬ|


![Архитектура расширения Direct Line](./media/channels/direct-line-extension-vnet.png)

>[!NOTE]
> Предоставленные IP-адреса явно предназначены для предварительной версии. Позднее в этом году мы будем переходить на использование тега службы в службе Azure Bot, что потребует изменить эту конфигурацию.

### <a name="configure-your-bots-app-service"></a>Настройка Службы приложений для бота

Для этой предварительной версии вам потребуется изменить способ взаимодействия расширения Службы приложений Direct Line с Azure. Это можно сделать, добавив в приложение новый **параметр приложения Службы приложений** с помощью портала или файла `applicationsettings.json`:

- Свойство: DirectLineExtensionABSEndpoint
- Значение: https://dlase.botframework.com/v3/extension

>[!NOTE]
> Это потребуется только для предварительной версии расширения Службы приложений Direct Line.
