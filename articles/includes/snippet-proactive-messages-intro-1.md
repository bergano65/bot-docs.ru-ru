---
ms.openlocfilehash: c6abff25dcccce4c18ad0083ef24b69495222c9f
ms.sourcegitcommit: fa6e775dcf95a4253ad854796f5906f33af05a42
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/16/2019
ms.locfileid: "70297362"
---
Как правило, каждое сообщение, которое бот отправляет пользователю, напрямую связано с данными, введенными пользователем ранее.
Иногда боту может потребоваться отправить пользователю сообщение, которое не имеет прямого отношения к текущей теме диалога или последнему сообщению пользователя. Такие сообщения называются **упреждающими**.

Упреждающие сообщения можно использовать в различных сценариях.
Если бот устанавливает таймер или напоминание, ему потребуется оповестить пользователя в соответствующий момент времени.
Если бот получает уведомление от внешней системы, ему может потребоваться незамедлительно передать эту информацию пользователю.
Например, если пользователь ранее попросил бот отслеживать стоимость продукта, то бот может оповестить пользователя в случае, если стоимость продукта опустилась на 20 %. Если боту требуется какое-то время, чтобы сформировать ответ на вопрос пользователя, он может проинформировать пользователя о задержке и продолжить диалог. Когда бот сформирует ответ на вопрос, он передаст его пользователю.

При реализации упреждающих сообщений бота обратите внимание на следующее:

- *Не следует* отправлять несколько упреждающих сообщений за короткое время. Некоторые каналы ограничивают частоту, с которой бот может отправлять сообщения пользователю, и отключают бот, если он нарушает эти ограничения.
- *Не следует* отправлять упреждающие сообщения пользователям, которые ранее не взаимодействовали с ботом или хотели связаться с ботом по другим каналам связи, например, по электронной почте или через SMS.

Упреждающие сообщения могут вызывать неожиданное поведение. Рассмотрим следующий сценарий.

![Взаимодействие пользователей](~/media/designing-bots/capabilities/proactive1.png)

В этом примере пользователь попросил бот отслеживать цены на гостиницы в Лас-Вегасе.
Бот запустил задачу фонового мониторинга, которая непрерывно работает в течение последних несколько дней.
В диалоге пользователь резервирует поездку в Лондон, и в этот момент фоновая задача отправляет уведомление о появлении скидки на гостиницу в Лас-Вегасе. Бот вставляет эту информацию в диалог, что приводит к путанице пользователя.

Как бот должен был обработать эту ситуацию?

- Ожидание завершения текущего резервирования и последующая отправка уведомления. Этот подход минимально влияет на работу системы, но задержка при передаче информации может привести к тому, что пользователь упустит недорогие отели в Лас-Вегасе.
- Отмена текущего резервирования и немедленная отправка уведомления. Этот подход обеспечивает своевременную передачу информации, но может не понравиться пользователю, которому придется начинать бронирование заново.
- Прерывание текущего резервирования с четким изменением темы диалога на гостиницу в Лас-Вегасе, ожидание ответа пользователя и последующий возврат в выполняемое бронирование с того момента, в который оно было прервано. Этот подход может показаться наилучшим, но он приводит к увеличению сложности как для разработчика бота, так и для пользователя.

Для таких ситуаций бот чаще всего будет использовать сочетание **специализированных упреждающих сообщений** и других методов.
