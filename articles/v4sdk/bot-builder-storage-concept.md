---
title: Состояние и хранение | Документация Майкрософт
description: Описывает диспетчер состояния, состояние общения и состояние пользователя в пакете SDK для Bot Builder.
keywords: Служба LUIS, состояние общения, состояние пользователя, хранилище, диспетчер состояния
author: DeniseMak
ms.author: v-demak
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 02/15/2018
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: e25ecec3aec1cdebe3b9eae4bff0d3c434cb610b
ms.sourcegitcommit: 1abc32353c20acd103e0383121db21b705e5eec3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2018
ms.locfileid: "42756643"
---
# <a name="state-and-storage"></a>Состояние и хранение
[!INCLUDE [pre-release-label](../includes/pre-release-label.md)]

Важным аспектом качественной разработки бота является отслеживание контекста общения, то есть бот должен запоминать, например, ответы на предыдущие вопросы.
В зависимости от того, для чего используется ваш бот, вам может понадобиться отслеживать информацию о состоянии или хранении данных дольше, чем время существования общения.
*Состояние* бота — это информация, которую программа запоминает, чтобы адекватно отвечать на входящие сообщения. Пакет SDK для Bot Builder предоставляет классы для хранения и извлечения данных о состоянии как объект, связанный с пользователем или общением.

* **Свойства общения** позволяют боту отслеживать текущее общение с пользователем. Если ваш бот должен выполнить последовательные шаги или переключиться между темами общения, вы можете использовать свойства общения для управления шагами в последовательности или для отслеживания текущей темы. Так как свойства диалога отражают состояние текущего процесса общения, они обычно очищаются в конце диалога, когда бот получает действие _конец общения_.
* **Свойства пользователя** можно использовать для многих целей, например для определения места остановки предыдущего общения пользователя или просто для приветствия вернувшегося пользователя по имени. Если сохранить параметры пользователя, то с помощью этих данных можно настроить общение в следующий раз. Например, можно оповестить пользователя о новостной статье на интересующую его тему или оповестить его о том, что освободилось время для встречи. Эти параметры следует очистить, если бот получает действие _удалить данные пользователя_.

Можно использовать [Хранилище](bot-builder-howto-v4-storage.md) для чтения и записи в постоянное хранилище. Это позволяет боту выполнять такие действия, как обновление общих ресурсов, запись ответов на приглашение или голосов, чтение архивных данных о погоде. Точно так же, как приложение использует хранилище для достижения своих целей, бот может выполнять вышеперечисленные действия во время общения с пользователем.

<!-- 
*Conversation state* pertains to the current conversation that the user is having with your bot. When the conversation ends, your bot deletes this data.

You can also store *user state* that persists after a conversation ends. For example, if you store a user's preferences, you can use that information to customize the conversation the next time you chat. For example, you might alert the user to a news article about a topic that interests her, or alert a user when an appointment becomes available. 
-->

<!-- You should generally avoid saving state using a global variable or function closures.
Doing so will create issues when you want to scale out your bot. Instead, use the conversation state and user state middleware that the BotBuilder SDK provides --> 


## <a name="types-of-underlying-storage"></a>Типы базового хранилища

Пакет SDK предоставляет ПО промежуточного слоя для диспетчера состояния бота, чтобы сохранить общение и состояние пользователя. Доступ к состоянию может осуществляться с помощью контекста бота. Диспетчер состояний может использовать хранилище таблиц Azure, хранилище файлов или хранилище памяти в качестве базового хранилища данных. Можно также создать собственные компоненты хранилища для бота.

Боты, созданные с помощью хранилища таблиц Azure, могут создаваться без учета состояния и масштабируемыми между несколькими вычислительными узлами.

> [!NOTE] 
> Хранилище файлов и памяти не выполняет масштабирование между узлами.

## <a name="writing-directly-to-storage"></a>Запись данных напрямую в хранилище

Пакет SDK для Bot Builder также может использоваться для чтения и записи данных напрямую в хранилище, не используя ПО промежуточного слоя или контекст ботов. Это может быть необходимо для данных бота, которые поступают из источника за пределами потока общения бота.

Например, предположим, что пользователь запрашивает у бота прогноз погоды. Тогда бот извлекает прогноз для указанной даты, считывая его из внешней базы данных. Содержимое базы данных о погоде не зависит от сведений о пользователе или от контекста общения, поэтому вы можете только читать его напрямую из хранилища, вместо использования диспетчера состояния.  Для дополнительных сведений см. статью [Сохранение данных напрямую в хранилище](bot-builder-howto-v4-storage.md).

## <a name="next-steps"></a>Дополнительная информация

В следующем разделе мы подробно расскажем о том, как обрабатываются действия и как мы на них отвечаем.

> [!div class="nextstepaction"]
> [Обработка действий](bot-builder-concept-activity-processing.md)

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Сохранение состояния с помощью общения и свойств пользователя](bot-builder-howto-v4-state.md)
- [Save data directly to storage](bot-builder-howto-v4-storage.md) (Сохранение данных напрямую в хранилище)
