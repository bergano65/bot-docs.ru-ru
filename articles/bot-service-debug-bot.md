---
title: Отладка ботов, построенных с помощью службы Azure Bot | Документация Майкрософт
description: Отладка ботов, построенных с помощью службы Azure Bot.
author: v-ducvo
ms.author: v-ducvo
keywords: пакет SDK для Bot Builder, непрерывное развертывание, Служба приложений, эмулятор.
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 07/13/2018
ms.openlocfilehash: 73cf6cedecd9acaef828bd41f4fccdaad2ae5731
ms.sourcegitcommit: 3bf3dbb1a440b3d83e58499c6a2ac116fe04b2f6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/23/2018
ms.locfileid: "46707170"
---
# <a name="debug-a-bot-service-bot"></a>Отладка бота службы Azure Bot

В этой статье описывается отладка ботов с помощью интегрированной среды разработки (IDE), такой как Visual Studio или Visual Studio Code, и Bot Framework Emulator. Эти методы можно использовать для отладки любого бота локально. В этой статье используется **EchoBot**, созданный с помощью статьи [Создание бота с помощью службы Azure Bot](bot-service-quickstart.md).

## <a name="debug-a-javascript-bot"></a>Отладка бота JavaScript

Выполните действия, описанные в этом разделе, для отладки бота, созданного на JavaScript.

### <a name="prerequisites"></a>Предварительные требования

Перед отладкой бота JavaScript, необходимо выполнить следующие задачи.

- Скачайте исходный код для бота (из Azure), как описано в статье [Скачивание и повторное развертывание исходного кода бота](bot-service-build-download-source-code.md).
- Скачайте и установите [Bot Framework Emulator](https://github.com/Microsoft/BotFramework-Emulator/releases).
- Скачайте и установите редактор кодов <a href="https://code.visualstudio.com" target="_blank">Visual Studio Code</a>.

### <a name="debug-a-javascript-bot-using-command-line-and-emulator"></a>Отладка ботов JavaScript с помощью командной строки и эмулятора

Для запуска бота JavaScript при помощи командной строки и тестирования ботов эмулятором, выполните следующие действия.
1. В командной строке измените каталог на каталог проекта ботов.
2. Запустите бота с помощью команды **node app.js**.
3. Запустите эмулятор и подключитесь к конечной точке бота (например, **http://localhost:3978/api/messages**). Если бот запускается впервые, щелкните **Файл > Новая программа-робот** и следуйте инструкциям на экране. В противном случае, чтобы открыть существующий бот, щелкните **Файл > Открыть программу-робота**. Поскольку этот бот работает локально на компьютере, вы можете оставить строки **ИД приложения MSA** и **Пароль приложения MSA** пустыми. Дополнительные сведения см. в статье [Отладка ботов с помощью Bot Framework Emulator](bot-service-debug-emulator.md).
4. Из эмулятора отправьте боту сообщение (например, "Hi"). 
5. Для отладки бота используйте панели **Инспектор** и **Журнал** в правой части окна эмулятора. Например, по щелчку по любому из пузырьков сообщений (например, пузырек сообщения "Hi", показанный на снимке экрана ниже) на панели **Инспектор** раскроются подробности этого сообщения. Эту панель можно использовать для просмотра запросов и ответов при обмене сообщениями между эмулятором и ботом. Кроме того, можно щелкнуть любую ссылку на панели **Журнал** для просмотра сведений на панели **Инспектор**.

   ![Панель "Инспектор" в Bot Framework Emulator](~/media/bot-service-debug-bot/emulator_inspector.png)

### <a name="debug-a-javascript-bot-using-breakpoints-in-visual-studio-code"></a>Отладка бота JavaScript с использованием точек останова в Visual Studio Code

Используя интегрированную среду разработки Visual Studio Code, можно установить точки останова и запустить бот в режиме отладки для пошагового выполнения кода. Чтобы установить точки останова в VS Code, выполните следующие действия.

1. Запустите VS Code и откройте папку проекта бота.
2. В строке меню щелкните **Отладка**, а затем — **Начать отладку**. Если будет предложено выбрать механизм среды выполнения для запуска кода, выберите **Node.js**. На этом этапе бот функционирует локально. 

   > [!NOTE]
   > Если возникает ошибка "Значение не может быть null", убедитесь, что параметры **Хранилища таблиц** допустимы.
   > **EchoBot** по умолчанию использует **Хранилище таблиц**. Чтобы использовать Хранилище таблиц для ботов, требуются *имя* и *ключ* таблицы. При отсутствии готового экземпляра Хранилища таблиц его можно создать или, в целях тестирования, можно закомментировать код, который использует **TableBotDataStore**, и раскомментировать строку кода, которая использует **InMemoryDataStore**. **InMemoryDataStore** предназначен только для тестирования и создания прототипов.

3. Задайте необходимые точки останова. В VS Code можно установить точки останова, наведя указатель мыши над столбцом слева от номеров строк. Появится красная точка. Если щелкнуть на нее, установятся точки останова. Если щелкнуть на нее снова, точки останова будут удалены.

   ![Задание точек останова в VS Code](~/media/bot-service-debug-bot/breakpoint-set.png)

4. Запустите Bot Framework Emulator и подключитесь к боту, как описано выше. 
5. Из эмулятора отправьте боту сообщение (например, "Hi"). Выполнение останавливается на строке, в которой установлена точка останова.

   ![Отладка в VS Code](~/media/bot-service-debug-bot/breakpoint-caught.png)


## <a name="debug-a-c-bot"></a>Отладка бота C#

Следуйте инструкциям в этом разделе, чтобы отладить бота, созданного на C#.


### <a name="prerequisites"></a>Предварительные требования

Перед отладкой бота C# для веб-приложения необходимо выполнить следующие задачи.

- Скачайте исходный код для бота (из Azure), как описано в статье [Скачивание и повторное развертывание исходного кода бота](bot-service-build-download-source-code.md).
- Скачайте и установите [Bot Framework Emulator](https://github.com/Microsoft/BotFramework-Emulator/releases).
- Загрузите и установите <a href="https://www.visualstudio.com/downloads/" target="_blank">Visual Studio 2017</a> (Community Edition или более поздней версии).

### <a name="debug-a-c-bot-using-breakpoints-in-visual-studio"></a>Отладка бота C# с использованием точек останова в Visual Studio

Используя IDE, например Visual Studio (VS), можно установить точки останова и запустить бот в режиме отладки для пошагового выполнения код. Чтобы установить точки останова в VS, выполните следующие действия.

1. Перейдите к папке ботов и откройте файл **SLN**. Откроется решение в Visual Studio.
2. В строке меню щелкните **Построить**, затем **Построить решение**.
3. В окне **обозревателя решений** разверните папку **Диалоговые окна** и щелкните **EchoDialog.cs**. Этот файл определяет логику основного бота.
4. В строке меню щелкните **Отладка**, а затем — **Начать отладку**. На этом этапе бот функционирует локально. 

   > [!NOTE]
   > Если возникает ошибка "Значение не может быть null", убедитесь, что параметры **Хранилища таблиц** допустимы.
   > **EchoBot** по умолчанию использует **Хранилище таблиц**. Чтобы использовать Хранилище таблиц для ботов, требуются *имя* и *ключ* таблицы. При отсутствии готового экземпляра Хранилища таблиц его можно создать или, в целях тестирования, можно закомментировать код, который использует **TableBotDataStore**, и раскомментировать строку кода, которая использует **InMemoryDataStore**. **InMemoryDataStore** предназначен только для тестирования и создания прототипов.

5. Задайте необходимые точки останова. В VS можно установить точки останова, наведя указатель мыши на столбец слева от номеров строк. Появится красная точка. Если щелкнуть на нее, установятся точки останова. Если щелкнуть на нее снова, точки останова будут удалены.

   ![Задание точки останова в VS](~/media/bot-service-debug-bot/breakpoint-set-vs.png)

6. Запустите Bot Framework Emulator и подключитесь к боту, как описано выше. 
7. Из эмулятора отправьте боту сообщение (например, "Hi"). Выполнение останавливается на строке, в которой установлена точка останова.

   ![Отладка в VS](~/media/bot-service-debug-bot/breakpoint-caught-vs.png)

::: moniker range="azure-bot-service-3.0" 

## <a id="debug-csharp-serverless"></a> Отладка ботов Плана потребления функций C\#

План потребления бессерверной среды C\# в службе ботов имеет больше общего с Node.js, чем обычное приложение C\#, поскольку для него требуется хост-приложение среды выполнения, так же, как и для подсистемы Node. В Azure среда выполнения является частью среды размещения в облаке, но нужно реплицировать эту среду локально на рабочий стол. 

### <a name="prerequisites"></a>Предварительные требования

Перед отладкой плана потребления ботов C# необходимо выполнить следующие задачи.

- Загрузите исходный код для вашего бота (из Azure), как описано в разделе [Настройка непрерывного развертывания для бота в плане службы приложений](bot-service-continuous-deployment.md).
- Скачайте и установите [Bot Framework Emulator](https://github.com/Microsoft/BotFramework-Emulator/releases).
- Установите <a href="https://www.npmjs.com/package/azure-functions-cli" target="_blank">CLI Функций Azure</a>.
- Установите <a href="https://github.com/dotnet/cli" target="_blank">DotNet CLI</a>.
  
Чтобы иметь возможность отлаживать код с помощью точек останова в Visual Studio 2017, необходимо также выполнить следующие задачи.
  
- Загрузите и установите <a href="https://www.visualstudio.com/downloads/" target="_blank">Visual Studio 2017</a> (Community Edition или более поздней версии).
- Скачайте и установите <a href="https://visualstudiogallery.msdn.microsoft.com/e6bf6a3d-7411-4494-8a1e-28c1a8c4ce99" target="_blank">расширение Command Task Runner для Visual Studio</a>.

> [!NOTE]
> Visual Studio Code в настоящее время не поддерживается.

### <a name="debug-a-consumption-plan-c-functions-bot-using-the-emulator"></a>Отладка плана потребления ботов функций C# с помощью эмулятора

Самый простой способ отладки вашего бота локально — запустить бот, а затем подключиться к нему, используя Bot Framework Emulator. 
Сначала откройте командную строку и перейдите к папке, где в репозитории находится файл **project.json**. Далее выполните команду `dotnet restore`, чтобы восстановить различные пакеты, которые упоминаются в боте.

> [!NOTE]
> Visual Studio 2017 изменяет то, каким образом Visual Studio обрабатывает зависимости. Visual Studio 2015 использует **project.json** для обработки зависимостей, а Visual Studio 2017 использует модель формата **CSPROJ** при загрузке в Visual Studio. Если вы используете Visual Studio 2017, <a href="https://aka.ms/bf-debug-project">загрузите этот файл **CSPROJ**</a> в папку **/messages** в репозитории, прежде чем запускать команду `dotnet restore`.

![Окно командной строки](~/media/bot-service-debug-bot/csharp-azureservice-debug-envconfig.png)

Затем выполните `debughost.cmd`, чтобы загрузить и запустить бота. 

![В командной строке запустите debughost.cmd](~/media/bot-service-debug-bot/csharp-azureservice-debug-debughost.png)

На этом этапе бот функционирует локально. В окне консоли скопируйте конечную точку, от которой debughost ожидает передачи данных (в примере это `http://localhost:3978`). Затем запустите Bot Framework Emulator и вставьте конечную точку в адресную строку эмулятора. В этом примере к конечной точке необходимо также добавить `/api/messages`. Поскольку безопасность для локальной отладки не нужна, можно оставить поля **ИД приложения Microsoft** и **Пароль приложения Microsoft** пустыми. Щелкните **Connect**, чтобы установить подключение к боту с помощью указанной конечной точки.

![Настройка эмулятора](~/media/bot-service-debug-bot/mac-azureservice-emulator-config.png)

После подключения эмулятора к боту отправьте боту сообщение, введя текст в поле, расположенном в нижней части окна эмулятора (т. е., в нижнем левом углу, где появляется надпись **Введите сообщение...**). С помощью панелей **Журнал** и **Инспектор** в правой части окна эмулятора можно просмотреть запросы и ответы при обмене сообщениями между эмулятором и ботом.

![Тестирование с помощью эмулятора](~/media/bot-service-debug-bot/mac-azureservice-debug-emulator.png)

Кроме того, можно просмотреть подробные сведения журнала в окне консоли.

![Окно консоли](~/media/bot-service-debug-bot/csharp-azureservice-debug-debughostlogging.png)

::: moniker-end

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Отладка ботов с помощью Bot Framework Emulator](bot-service-debug-emulator.md).
