---
title: Подробный обзор шаблона Enterprise Bot | Документация Майкрософт
description: Узнайте о проектных решениях, реализованных в шаблоне Enterprise Bot.
author: darrenj
ms.author: darrenj
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.date: 09/18/2018
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 5f5559ae16bc346d34e5cddfa741853044ec685f
ms.sourcegitcommit: b78fe3d8dd604c4f7233740658a229e85b8535dd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/24/2018
ms.locfileid: "49997351"
---
# <a name="enterprise-template---detailed-overview"></a>Подробный обзор шаблона Enterprise Bot

> [!NOTE]
> Приведенные здесь сведения относятся к пакету SDK версии 4. 

Шаблон Enterprise Bot объединяет лучшие методики, определенные нами при создании решений для ведения диалога, и автоматизирует интеграцию компонентов, которые мы считаем очень полезными для разработчиков Службы Azure Bot. В этом разделе содержатся общие сведения о ключевых решениях, которые помогут понять, почему шаблон работает именно так, а не иначе.

## <a name="introduction-card"></a>Карточка с вводными сведениями

Использование многих решений для ведения диалога сопряжено с одной проблемой: пользователь не знает, с чего начать, и задает общие вопросы, с ответом на которые бот может справиться не лучшим образом. А ведь первое впечатление играет важную роль! Карточка с вводными сведениями содержит информацию о возможностях бота и предлагает пользователю на выбор несколько начальных вопросов, которые помогут ему приступить к работе с ботом. Это также отличная возможность подчеркнуть отличие вашего бота от других.

Простая карточка с вводными сведениями предоставляется в стандартном виде, который по желанию можно изменить.

## <a name="basic-language-understanding-luis-intents"></a>Базовые намерения Интеллектуальной службы распознавания речи (LUIS)

Каждый бот должен понимать естественный язык на базовом уровне. Например, приветствие — это базовая задача, с которой любой бот должен легко справляться. В общем случае разработчики должны создавать подобные базовые намерения и предоставлять данные для начального обучения, которые позволят приступить к работе с ботом. Шаблон Enterprise Bot изначально поддерживает базовые возможности и содержит примеры файлов распознавания речи (LU-файлы). Таким образом вам не нужно создавать эти файлы всякий раз, когда вы начинаете новый проект.

В файлах распознавания речи представлены следующие намерения на английском, французском, итальянском, немецком и испанском языках:

> Greeting (Приветствие), Help (Справка), Cancel (Отмена), Restart (Перезапуск), Escalate (Сообщение о проблеме), ConfirmYes (Подтверждение согласия), ConfirmNo (Подтверждение отказа), ConfirmMore (Подтверждение необходимости дополнительных сведений), Next (Продолжение), Goodbye (Прощание)

Формат [LU](https://github.com/Microsoft/botbuilder-tools/blob/master/packages/Ludown/docs/lu-file-format.md)-файлов аналогичен формату MarkDown. Такие файлы легко изменять, и их поддерживает система управления версиями Средство [LuDown](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/Ludown) преобразовывает LU-файлы в модели LUIS, которые затем можно опубликовать в подписке LUIS либо с помощью портала, либо с помощью командной строки [LUIS](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/LUIS).

## <a name="content-moderator"></a>Content Moderator

Content Moderator позволяет обнаруживать ненормативную лексику и помогает выявлять наличие персональных данных в содержимом. Боты с этой функцией могут реагировать на ненормативную лексику или разглашение пользователем персональных данных. Например, бот может принести извинения и переключить пользователя на оператора-человека или не сохранять данные телеметрии, если обнаружены персональные данные.

Присутствует компонент ПО промежуточного слоя, который проверяет тексты и изображения с помощью ```TextModeratorResult``` в объекте TurnState.

## <a name="telemetry"></a>Телеметрия

Сбор аналитических сведений о вовлеченности пользователя в работу с ботом оказалось очень важным делом. Такие сведения помогают понять уровень вовлеченности пользователей, какие функции ботов они используют (намерения), на какие вопросы бот не может ответить. Все это позволяет выявить пробелы в знаниях бота, которые можно устранить, например, с помощью новых статей QnA Maker.

Интеграция Application Insights позволяет сразу получать ценные аналитические сведения эксплуатационного и технического характера, а также собирать данные о событиях в работе бота (отправленные и полученные сообщения и операции с LUIS и QnA Maker).

Данные телеметрии на уровне бота по своей природе связаны с данными телеметрии о его технических и эксплуатационных параметрах, что позволяет проверять, как бот отвечает на вопрос определенного пользователя и наоборот.

Компонент ПО промежуточного слоя в сочетании с классом-оболочкой QnA Maker и классами пакета SDK LuisRecognizer предоставляют удобный способ для сбора согласованного набора событий. Эти согласованные события затем могут использоваться средствами Application Insights, а также такими средствами, как Power BI.

Пример панели мониторинга Power BI входит в состав каждого проекта, создаваемого с помощью шаблона Enterprise Bot. См. дополнительные сведения в разделе о [PowerBI](bot-builder-enterprise-template-powerbi.md).

## <a name="dispatcher"></a>Диспетчер

Основной конструктивный шаблон, используемый для создания первых эффективных решений для ведения диалога, основывался на возможностях Интеллектуальной службы распознавания речи (LUIS) и QnAMaker. Служба LUIS обучалась на задачах, которые бот мог выполнять для конечного пользователя, а QnA Maker — с помощью более общих знаний.

Все входящие фразы (вопросы) перенаправлялись в LUIS для анализа. Если намерение определенной фразы было не распознано, она помечалась как фраза без намерения. В этом случае для поиска ответа на вопрос пользователя применялась служба QnA Maker.

Такая схема работала хорошо, но существовали два основных сценария, в которых могли возникать проблемы.

- Если фразы в модели LUIS и QnA Maker иногда немного совпадали, это могло привести к странному поведению, при котором служба LUIS пыталась обработать вопрос, тогда как этот вопрос должен был передаваться в QnA Maker.
- При использовании двух и более моделей LUIS боту было необходимо вызывать каждую из них и выполнять своего рода сравнительную оценку намерений, чтобы определить, куда отправить определенную фразу. Так как общей базовой оценки не существует, сравнение между моделями работало плохо, из-за чего взаимодействие пользователя и бота было неэффективным.

[Средство Dispatch](https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-tutorial-dispatch?view=azure-bot-service-4.0&tabs=csaddref%2Ccsbotconfig) предлагает изящное решение этой проблемы. Оно извлекает фразы из каждой настроенной модели LUIS и вопросы из QnA Maker и создает центральную диспетчерскую модель LUIS.

Это позволяет боту быстро определять, какой компонент или какая модель LUIS должны обрабатывать определенную фразу. Более того, данные службы QnA Maker принимаются во внимание на начальном этапе обработки намерений, а не как раньше, когда эта служба использовалась только для обработки фраз, для которых не удалось определить намерение.

Кроме того, средство Dispatch позволяет определять путаницу и совпадения в разных моделях LUIS и базах знаний QnA Maker еще до развертывания.

Средство Dispatch лежит в основе каждого проекта, созданного с помощью шаблона Enterprise Bot. Модель Dispatch используется в классе `MainDialog` и позволяет определить, что является целевым объектом: модель LUIS или QnA. Если целевым объектом является модель LUIS, вызывается вторичная модель LUIS, возвращающая намерение и сущности в обычном порядке.

## <a name="qnamaker"></a>QnA Maker

[QnA Maker](https://www.qnamaker.ai/) предоставляет возможность пользователям, которые не являются разработчиками, курировать общие знания в формате пар "вопрос — ответ". Эти знания можно импортировать из таких источников данных, как списки часто задаваемых вопросов и руководства по продуктам. Их также можно импортировать в интерактивном режиме на портале QnA Maker.

Пример набора записей QnA приведен в [LU](https://github.com/Microsoft/botbuilder-tools/blob/master/packages/Ludown/docs/lu-file-format.md)-файле в папке QnA CogSvcModels. Скрипт развертывания использует [LuDown](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/Ludown), чтобы создать JSON-файл QnA Maker, который затем используется в командной строке [QnA Maker](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/QnAMaker) для публикации элементов в базе знаний QnA Maker.
