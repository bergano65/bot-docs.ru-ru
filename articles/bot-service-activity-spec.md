---
title: Спецификация Bot Framework | Документация Майкрософт
description: Спецификация Bot Framework
author: RobStand
ms.author: kamrani
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 03/07/2018
ms.openlocfilehash: 0406d489f7d1e27131b4b01411e86850ca4a17b8
ms.sourcegitcommit: f576981342fb3361216675815714e24281e20ddf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2018
ms.locfileid: "39300710"
---
# <a name="bot-framework----activity"></a>Bot Framework — действия

## <a name="abstract"></a>Аннотация

Схема действий Bot Framework — это представление диалоговых действий людей и автоматизированного программного обеспечения на уровне приложений. Схема содержит подготовку для передачи текстовых, мультимедийных действий и действий без содержимого, таких как взаимодействия в социальной сети и индикаторы ввода.

Эта схема используется в протоколе Bot Framework и реализуется системами чата Майкрософт и совместимыми ботами и клиентами из многих источников.

## <a name="table-of-contents"></a>Оглавление

1. [Введение](#introduction)
2. [Базовая структура действия](#basic-activity-structure)
3. [Действие сообщений](#message-activity)
4. [Действие обновления отношений контактов](#contact-relation-update-activity)
5. [Действие обновления диалога](#conversation-update-activity)
6. [Действие окончания диалога](#end-of-conversation-activity)
7. [Действие события](#event-activity)
8. [Действие вызова](#invoke-activity)
9. [Действие обновления установки](#installation-update-activity)
10. [Действие удаления сообщения](#message-delete-activity)
11. [Действие обновления сообщения](#message-update-activity)
12. [Действие реагирования на сообщение](#message-reaction-activity)
13. [Действие ввода](#typing-activity)
14. [Сложные типы](#complex-types)
15. [Справочные материалы](#references)
16. [Приложение I. Изменения](#appendix-i---changes)
17. [Приложение II. Типы сущностей, отличные от IRI](#appendix-ii---non-iri-entity-types)
18. [Приложение III. Протоколы, использующие действия вызова](#appendix-iii---protocols-using-the-invoke-activity)

## <a name="introduction"></a>Введение

### <a name="overview"></a>Обзор

Схема действий Bot Framework представляет собой диалоговое поведение людей и автоматического программного обеспечения в чат-приложениях, электронной почте и других программах взаимодействия с помощью текста. Каждый объект действия включает в себя поле типа и представляет собой одно действие, чаще всего это отправка текстового содержимого, но также включение мультимедийных вложений и поведения без содержимого, такого как кнопка отметки "Нравится" или индикатор ввода.

Этот документ содержит значения для каждого типа действий и описывает необходимые и необязательные поля, которые могут быть включены. Он также определяет роли клиента и сервера и содержит указания о том, какими полями управляет каждый участник, а какие можно проигнорировать.

В этой спецификации есть три роли: клиенты, которые отправляют и получают действия от имени пользователей, боты, которые отправляют и получают действия (как правило, автоматизированы), и канал, который хранит и перенаправляет действия между клиентами и ботами.

Хотя эта спецификация требует, чтобы действия передавались между ролями, точный характер этой передачи здесь не описывается.

Для компактности визуальные интерактивные карточки не определены в этой спецификации. Вместо этого см. спецификацию [Adaptive Cards](https://adaptivecards.io) (Адаптивные карточки) [[11](#references)]. Эта карта и другие неопределенные типы карточек могут быть включены в качестве вложений в действия Bot Framework.

### <a name="requirements"></a>Требования

Ключевые слова "НЕОБХОДИМО" ("ДОЛЖНО"), "НЕДОПУСТИМО", "ТРЕБУЕТСЯ", "НУЖНО", "НЕ ПОЗВОЛЯЕТСЯ", "СЛЕДУЕТ" ("ДОЛЖНО"), "НЕ СЛЕДУЕТ", "РЕКОМЕНДУЕТСЯ", "ВОЗМОЖНО" и "НЕОБЯЗАТЕЛЬНО" в данном документе интерпретируются согласно описанию в документе [RFC 2119](https://tools.ietf.org/html/rfc2119) [[1](#references)].

Реализация несовместима, если она не удовлетворяет одному или нескольким требованиям уровня "НЕОБХОДИМО" или "ТРЕБУЕТСЯ" для протоколов, которые она реализует. Реализация, которая удовлетворяет всем требованиям уровня "НЕОБХОДИМО" или "ТРЕБУЕТСЯ" и всем требованиям уровня "НУЖНО" для ее протоколов, называется "безоговорочно совместимой". Реализация, которая удовлетворяет всем требованиям уровня "НЕОБХОДИМО", но не всем требованиям уровня "ТРЕБУЕТСЯ" для ее протоколов, считается "условно совместимой".

### <a name="numbered-requirements"></a>Нумерованные требования

Строки, начинающиеся с маркеров формы `RXXXX`, являются конкретными требованиями, которые должны быть указаны с помощью номера в обсуждении вне этого документа. Они имеют такой же приоритет, что и нормативные утверждения, сделанные вне строк `RXXXX`.

`R1000`: редакторы этой спецификации МОГУТ добавить новые требования `RXXXX`. Они ДОЛЖНЫ найти числовые значения `RXXXX`, которые сохраняют последовательность документов.

`R1001`: редакторы НЕ ДОЛЖНЫ повторно нумеровать имеющиеся требования `RXXXX`.

`R1002`: редакторы МОГУТ удалить или пересмотреть требования `RXXXX`. В случае пересмотра редактор ДОЛЖЕН сохранить имеющееся значение `RXXXX`, если раздел требования остается в значительной степени неизменным.

`R1003`: редакторам НЕ СЛЕДУЕТ повторно использовать устаревшие значения `RXXXX`. Список удаленных значений МОЖЕТ быть сохранен в конце этого документа.

### <a name="terminology"></a>Терминология

activity
> Действие, выраженное ботом, каналом или клиентом, которое соответствует схеме действий.

channel
> Программное обеспечение, которое отправляет и принимает действия и преобразует их в поведение чата или приложения. Каналы являются авторитетным хранилищем данных о действиях.

бот
> Программное обеспечение, которое отправляет и получает действия и создает автоматизированные, полуавтоматизированные ответы или ответы, полностью созданные вручную. У ботов есть конечные точки, зарегистрированные в каналах.

клиент
> Программное обеспечение, которое отправляет и получает действия, обычно от имени пользователей. Клиенты не имеют конечных точек.

отправитель
> Программное обеспечение, передающее действие.

получатель
> Программное обеспечение, принимающее действие.

endpoint
> Программно адресуемое расположение, где бот или канал может получать действия.

address
> Идентификатор или адрес, с помощью которого можно связаться с пользователем или ботом.

поле
> Именованное значение внутри действия или вложенного объекта.

### <a name="overall-organization"></a>Общая организация

Объектом действия является неструктурированный список пар "имя — значение", некоторые из которых являются примитивными объектами, а другие — сложными (вложенными). Объект действия обычно выражается в формате JSON, но также может быть проецирован в структуры данных в памяти в .Net или JavaScript.

Поле действия `type` контролирует значение действия и поля, содержащиеся в нем. В зависимости от роли, которую играет участник (клиент, бот или канал), каждое поле является обязательным, необязательным или игнорируется. Например, поле `id` управляется каналом и в некоторых случаях является обязательным, но игнорируется, если оно отправлено ботом.

Поля, которые описывают идентификаторы действий и любых участников, такие как поля `type` и `from`, являются общими для всех видов действий. Во многих языках программирования удобно организовывать эти поля по базовому типу, из которого производятся другие, более конкретные виды действий.

При сохранении или передаче действий некоторые поля могут быть дублированы в транспортном механизме. Например, если действие передается через HTTP POST на URL-адрес, который содержит идентификатор общения, получатель может определить его значение, не требуя, чтобы он присутствовал в тексте действия. В этом документе описываются только абстрактные требования к этим полям. Управляющий протокол определяет, должны ли быть значения явно объявленными, неявными или предполагаемыми (если допустимо).

Когда бот или клиент отправляет действие в канал, обычно это запрос на запись действия. Когда канал отправляет действие боту или клиенту, обычно это уведомление о том, что действие уже записано.

## <a name="basic-activity-structure"></a>Базовая структура действия

В этом разделе определяются требования к базовой структуре объекта действия.

Объекты действий содержат неструктурированный список пар "имя — значение", называемые полями. Поля могут быть примитивными типами. JSON используется как общий формат обмена, и хотя не все действия должны быть последовательно преобразованы в JSON, они должны быть сериализованы для него. Это позволяет реализациям полагаться на простой набор соглашений для обработки известных и неизвестных полей действий.

`R2001`: действия ДОЛЖНЫ быть сериализованы в формате JSON, включая соблюдение, например, ограничения на уникальность полей.

`R2002`: получатели МОГУТ допускать имена полей в неправильном регистре, хотя это не требуется. Получатели МОГУТ отклонять действия, которые не включают поля в соответствующем регистре.

`R2003`: получатели МОГУТ отклонять действия, содержащие значения полей, типы которых не соответствуют типам значений, описанным в этой спецификации.

`R2004`: если не указано иное, отправителям НЕ СЛЕДУЕТ включать пустые строковые значения для строковых полей.

`R2005`: если не указано иное, отправители МОГУТ включать дополнительные поля в действие или любые вложенные составные объекты. Получатели ДОЛЖНЫ принимать поля, которые они не могут распознать.

`R2006`: получателям СЛЕДУЕТ принимать события типов, которые они не могут определить.

### <a name="type"></a>type

Поле `type` управляет значением каждого действия и по соглашению имеет короткие строки (например, `message`). Отправители могут определять собственные типы на уровне приложений, хотя им предлагается выбирать значения, которые вряд ли будут конфликтовать с будущими четко определенными значениями. Если отправители используют URI в качестве значений типа, им НЕ СЛЕДУЕТ реализовать сравнения схемы URI для установления эквивалентности.

`R2010`: действия ДОЛЖНЫ содержать поле `type` со значением строкового типа.

`R2011`: два значения `type` эквивалентны, только если они ординально идентичны.

`R2012`: отправитель МОЖЕТ создавать значения действий `type`, не указанные в этом документе.

`R2013`: каналу СЛЕДУЕТ отклонять действия типа, которые он не может распознать.

`R2014`: боту или клиенту СЛЕДУЕТ игнорировать действия типа, которые он не может распознать.

### <a name="channel-id"></a>Идентификатор канала

Поле `channelId` устанавливает канал и полномочное хранилище для этого действия. Значение поля `channelId` имеет строковый тип.

`R2020`: действия ДОЛЖНЫ содержать поле `channelId` со значением строкового типа.

`R2021`: два значения `channelId` эквивалентны, только если они ординально идентичны.

`R2022`: канал МОЖЕТ игнорировать или отклонять любое действие, которое он получает без ожидаемого значения `channelId`.

### <a name="id"></a>ИД

Поле `id` устанавливает идентификатор для действия после его записи в канал. Активное действие, которое еще не было записано, не имеет идентификаторов. Не всем действиям присваиваются идентификаторы (например, [действие ввода](#typing-activity) может никогда не получить `id`.) Значение поля `id` имеет строковый тип.

`R2030`: каналы ДОЛЖНЫ содержать поле `id`, если оно доступно для этого действия.

`R2031`: клиентам и ботам НЕ СЛЕДУЕТ включать поле `id` в действия, которые они создают.

Для простоты реализации следует предположить, что другие участники не знают всех идентификаторов действий и что они будут использовать только порядковое сравнение для установления эквивалентности.

Например, канал может использовать идентификаторы GUID в шестнадцатеричной кодировке для каждого идентификатора действия. Хотя идентификаторы GUID с кодировкой в верхнем регистре логически эквивалентны GUID с кодировкой в нижнем регистре, отправители НЕ ДОЛЖНЫ использовать эти альтернативные кодировки, когда это возможно. Нормализованная версия каждого идентификатора устанавливается полномочным хранилищем — каналом.

`R2032`: при создании значений `id` отправители ДОЛЖНЫ выбирать значения, эквивалентность которых может быть установлена ​​путем порядкового сравнения. Однако отправители и получатели МОГУТ допускать логическую эквивалентность двух значений, которые не являются эквивалентными по порядку, если они точно знают об обстоятельствах.

Поле `id` предназначено для устранения дублирования, но это запрещено в большинстве приложений.

`R2033`: получатели МОГУТ дедуплицировать действия по идентификатору, однако отправителям НЕ СЛЕДУЕТ полагаться на получателей, выполняющих эту дедупликацию.

### <a name="timestamp"></a>Timestamp

Поле `timestamp` записывает точное время в формате UTC, когда произошло действие. Из-за распределенного характера вычислительных систем важным моментом является то, когда канал (полномочное хранилище) регистрирует действие. Время, когда клиент или бот инициировал действие, может передаваться отдельно в поле `localTimestamp`. Значение поля `timestamp` — это дата и время в формате [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) [[2](#references)], закодированные в строке.

`R2040`: каналы ДОЛЖНЫ содержать поле `timestamp`, если оно доступно для этого действия.

`R2041`: клиентам и ботам НЕ СЛЕДУЕТ включать поле `timestamp` в действия, которые они создают.

`R2042`: клиентам и ботам НЕ СЛЕДУЕТ использовать `timestamp`, чтобы отклонять действия, так как они могут появляться не по порядку. Однако они МОГУТ использовать `timestamp` для упорядочивания действий в пользовательском интерфейсе или для последующей обработки.

`R2043`: отправителям СЛЕДУЕТ всегда использовать кодировку значений полей `timestamp` в формате UTC, а также всегда включать Z как явный знак UTC в пределах значения.

### <a name="local-timestamp"></a>Метка местного времени

Поле `localTimestamp` выражает смещение даты и времени и часового пояса, где было создано действие. Оно может отличаться от `timestamp` формата UTC, где было зарегистрировано действие. Значение поля `localTimestamp` — это дата и время в формате ISO 8601 [[3](#references)], закодированные в строке.

`R2050`: клиенты и боты МОГУТ включать поле `localTimestamp` в свои действия. Им ТРЕБУЕТСЯ явно указывать смещение часового пояса в закодированном значении.

`R2051`: каналам ТРЕБУЕТСЯ сохранять `localTimestamp` при пересылке от отправителя к получателю (получателям).

### <a name="from"></a>Из

Поле `from` описывает, какой клиент, бот или канал создал действие. Значение поля `from` является составным объектом типа [Учетная запись канала](#channel-account).

Поле `from.id` идентифицирует, кто создал действие. Чаще всего это другой пользователь или бот в системе. В некоторых случаях поле `from` идентифицирует сам канал.

`R2060`: каналы ДОЛЖНЫ включать поля `from` и `from.id` при создании действия.

`R2061`: ботам и клиентам ТРЕБУЕТСЯ включать поля `from` и `from.id` при создании действия. Канал МОЖЕТ отклонить действие из-за отсутствия полей `from` и `from.id`.

Поле `from.name` является необязательным и представляет отображаемое имя для учетной записи в канале. Каналам СЛЕДУЕТ включать это значение, чтобы клиенты и боты могли заполнять свои интерфейсы и серверные системы. Ботам и клиентам НЕ СЛЕДУЕТ отправлять это значение каналам с центральной записью этого хранилища, но они МОГУТ отправить это значение каналам, которые заполняют значение для каждого действия (например, по электронной почте).

`R2062`: каналам СЛЕДУЕТ включать поле `from.name`, если поле `from` присутствует и доступно `from.name`.

`R2063`: ботам и клиентам НЕ СЛЕДУЕТ включать поле `from.name`, если оно не является семантически ценным в канале.

### <a name="recipient"></a>Recipient

Поле `recipient` описывает, какой клиент или бот получает это действие. Это поле имеет смысл только тогда, когда действие передается точно одному получателю, что не имеет смысла в случае нескольких получателей (как это происходит при отправке действия в канал). Задача поля — позволить получателю идентифицировать себя. Это полезно, когда клиент или бот имеет несколько идентификаторов в канале. Значение поля `recipient` является составным объектом типа [Учетная запись канала](#channel-account).

`R2070`: каналы ДОЛЖНЫ включать поля `recipient` и `recipient.id` при передаче действия одному получателю.

`R2071`: ботам и клиентам НЕ СЛЕДУЕТ включать поле `recipient` при создании действия.

Поле `recipient.name` является необязательным и представляет отображаемое имя для учетной записи в канале. Каналам СЛЕДУЕТ включать это значение, чтобы клиенты и боты могли заполнять свои интерфейсы и серверные системы.

`R2072`: каналам СЛЕДУЕТ включать поле `recipient.name`, если поле `recipient` присутствует и доступно `recipient.name`.

### <a name="conversation"></a>Беседа

Поле `conversation` описывает общение, в рамках которого существует это действие. Значение поля `conversation` является составным объектом типа [учетная запись общения](#conversation-account).

`R2080`: канатам, ботам и клиентам ТРЕБУЕТСЯ включать поля `conversation` и `conversation.id` при создании действия.

Поле `conversation.name` является необязательным и представляет отображаемое имя для общения, если оно существует и доступно.

`R2081`: каналам СЛЕДУЕТ включать поля `conversation.name` и `conversation.isGroup`, если они доступны.

`R2082`: ботам и клиентам НЕ СЛЕДУЕТ включать поле `conversation.name`, если оно не является семантически ценным в канале.

`R2083`: клиентам и ботам НЕ СЛЕДУЕТ включать поле `conversation.isGroup` в действия, которые они создают.

### <a name="reply-to-id"></a>Ответ на идентификатор

Поле `replyToId` идентифицирует предыдущее действие, для которого текущее действие является ответом. Это поле позволяет создать цепочку сообщений и комментариев между участниками общения. `replyToId` действует только в рамках текущего общения. (Ссылки на другие диалоги см. в разделе [Относится к](#relates-to)). Значение поля `replyToId` имеет строковый тип.

`R2090`: отправителям СЛЕДУЕТ включать `replyToId` в действие, когда это ответ на другое действие.

`R2091`: канал МОЖЕТ отклонить действие, если его поле `replyToId` не ссылается на действительное действие в разговоре.

`R2092`: боты и клиенты МОГУТ опустить `replyToId`, если они знают, что канал не использует поле, даже если отправляемое действие является ответом на другое действие.

### <a name="entities"></a>Сущности

Поле `entities` содержит неструктурированный список объектов метаданных, относящихся к этому действию. В отличие от вложений (см. поле [Вложения](#attachments)) объекты не обязательно отображаются как пользовательские элементы содержимого и должны игнорироваться, если они не распознаны. Отправители могут включать объекты, которые, по их мнению, могут быть полезны получателю, даже если они не уверены, что получатель может их принять. Значение каждого элемента списка `entities` является сложным объектом типа [Сущность](#entity).

`R2100`: отправителям СЛЕДУЕТ опустить поле `entities`, если в нем нет элементов.

`R2101`: отправители МОГУТ отправлять несколько объектов одного типа, если они имеют различное значение.

`R2102`: отправители НЕ ДОЛЖНЫ включать два или более объекта с одинаковыми типами и содержимым.

`R2103`: отправителям и получателям НЕ СЛЕДУЕТ полагаться на конкретный порядок субъектов, включенных в действие.

### <a name="channel-data"></a>Данные канала

Данные расширяемости в схеме действий организованы, главным образом, в поле `channelData`. Это упрощает выполнение рутинных задач в пакетах SDK, которые реализуют протокол. Формат объекта `channelData` определяется каналом, отправляющим или получающим действие.

`R2200`: каналам НЕ СЛЕДУЕТ определять форматы `channelData`, являющиеся примитивами JSON (например, строки и целые числа). Вместо этого им СЛЕДУЕТ определить `channelData` как сложный тип или оставить его неопределенным.

`R2201`: если формат `channelData` не определен для текущего канала, получателям НЕ СЛЕДУЕТ игнорировать содержимое `channelData`.

### <a name="service-url"></a>URL-адрес службы

Действия часто отправляются асинхронно, с отдельными транспортными соединениями для отправки и получения трафика. Поле `serviceUrl` используется каналами для обозначения URL-адреса, на который могут быть отправлены ответы текущему действию. Значение поля `serviceUrl` имеет строковый тип.

`R2300`: каналы ДОЛЖНЫ включать поле `serviceUrl` во все действия, которые они отправляют ботам.

`R2301`: каналам НЕ СЛЕДУЕТ включать поле `serviceUrl` для клиентов, которые демонстрируют, что они уже знают конечную точку канала.

`R2302`: клиентам и ботам НЕ СЛЕДУЕТ заполнять поле `serviceUrl` в действиях, которые они создают.

`R2302`: каналы ДОЛЖНЫ игнорировать значение `serviceUrl` в действиях, отправленных ботами и клиентами.

`R2304`: каналам СЛЕДУЕТ использовать стабильные значения для поля `serviceUrl`, так как боты могут сохранять их в течение длительного времени.

## <a name="message-activity"></a>Действие сообщений

Действия сообщений представляют собой содержимое, предназначенное для отображения в интерфейсе диалога. Действия сообщений могут содержать текст, речь, интерактивные карточки и вложения в двоичном или неизвестном формате. Обычно каналы требуют не более одного из них для действия сообщения с правильным форматом.

Действия сообщений идентифицируются по значению `type` поля `message`.

### <a name="text"></a>текст

Поле `text` содержит текстовое содержимое в формате Markdown, XML или в виде обычного текста. Формат управляется с помощью поля [`textFormat`](#text-format) как простой текст, если оно не определено или неоднозначно. Значение поля `text` имеет строковый тип.

`R3000`: поле `text` МОЖЕТ содержать пустую строку для указания отправки текста без содержимого.

`R3001`: каналам СЛЕДУЕТ обрабатывать текст в формате `markdown` таким образом, который корректно постепенно отключит функции для этого канала.

### <a name="text-format"></a>Текстовый формат

Поле `textFormat` обозначает, следует ли интерпретировать формат поля [`text`](#text) как [Markdown](https://daringfireball.net/projects/markdown/) [[4](#references)], обычный текст или XML. Значение поля `textFormat` имеет строковый тип с определенными значениями `markdown`, `plain` и `xml`. По умолчанию используется значение `plain`. Это поле не предназначено для расширения с произвольными значениями.

Поле `textFormat` управляет дополнительными полями в приложениях и т. д. Эта взаимосвязь описывается в этих полях, в другой части этого документа.

`R3010`: если отправитель включает поле `textFormat`, ему СЛЕДУЕТ отправлять только определенные значения.

`R3011`: отправителям СЛЕДУЕТ опустить поле `textFormat`, если его значение `plain`.

`R3012`: получателям СЛЕДУЕТ интерпретировать неопределенные значения как `plain`.

`R3013`: ботам и клиентам НЕ СЛЕДУЕТ отправлять значение `xml`, если только они не знают, что канал поддерживает его, и характеристики поддерживаемого диалекта XML.

`R3014`: каналам НЕ СЛЕДУЕТ отправлять содержимое `markdown` или `xml` ботам.

`R3015`: каналам СЛЕДУЕТ принимать значения `textformat` как минимум `plain` и `markdown`.

`R3016`: каналы МОГУТ отклонять `textformat` значения `xml`.

### <a name="locale"></a>Языковой стандарт

Поле `locale` сообщает о коде языка поля [`text`](#text). Значение поля `locale` — это код [ISO 639](https://www.iso.org/iso-639-language-codes.html) [[5](#references)] в строке.

`R3020`: получателям СЛЕДУЕТ относиться к отсутствующим и неизвестным значениям поля `locale` как к неизвестным.

`R3021`: получателям НЕ СЛЕДУЕТ отклонять действия с неизвестным языковом стандартом.

### <a name="speak"></a>Speak

Поле `speak` указывает, как должно озвучиваться действие через систему преобразования текста в речь. Поле используется только для настройки речевого преобразования, когда значение по умолчанию считается некорректным. Оно заменяет синтез речи для любого содержимого в рамках действия, включая текст, вложения и сводки. Значение поля `speak` — это [SSML](https://www.w3.org/TR/speech-synthesis/) [[6](#references)], закодированный в строке. Расшифрованный текст разрешен и автоматически обновляется до открытого SSML.

`R3030`: поле `speak` МОЖЕТ содержать пустую строку, чтобы указать, что не требуется создавать речь.

`R3031`: получателям, неспособным создавать речь, СЛЕДУЕТ игнорировать поле `speak`.

`R3032`: если не найден ни один корневой SSML-элемент, получатели ДОЛЖНЫ рассматривать включенный текст как внутреннее содержимое тега SSML `<speak>`, предваряемого допустимым [прологом XML](https://www.w3.org/TR/xml/#sec-prolog-dtd) [[7](#references)] и в противном случае должен быть обновлен, чтобы быть действительным документом SSML.

`R3033`: получатели НЕ ДОЛЖНЫ использовать разрешение XML DTD или схемы для включения удаленных ресурсов из-за пределов переданного фрагмента XML.

`R3034`: каналам НЕ СЛЕДУЕТ отправлять содержимое `speak` ботам.

### <a name="input-hint"></a>Подсказка для ввода

Поле `inputHint` указывает, ожидает ли генератор действия ответ. Это поле используется преимущественно в каналах с модальными пользовательскими интерфейсами и обычно не используется в каналах с непрерывными веб-каналами чата. Значение поля `inputHint` имеет строковый тип с определенными значениями `accepting`, `expecting` и `ignoring`. По умолчанию используется значение `accepting`.

`R3040`: если отправитель включает поле `inputHint`, ему СЛЕДУЕТ отправлять только определенные значения.

`R3041`: при отправке действия в канал, где используется `inputHint`, ботам СЛЕДУЕТ включать поле, даже если значение равно `accepting`.

`R3042`: получателям СЛЕДУЕТ интерпретировать неопределенные значения как `accepting`.

### <a name="attachments"></a>Вложения

Поле `attachments` содержит неструктурированный список объектов, которые будут отображаться как часть этого действия. Значение каждого элемента списка `attachments` является сложным объектом типа [Вложение](#attachment).

`R3050`: отправителям СЛЕДУЕТ опустить поле `attachments`, если в нем нет элементов.

`R3051`: отправители МОГУТ отправлять несколько объектов одного типа.

`R3052`: получатели МОГУТ обрабатывать вложения неизвестных типов в качестве загружаемых документов.

`R3053`: получателям СЛЕДУЕТ сохранять порядок вложений при обработке содержимого, за исключением случаев, когда ограничения рендеринга вызывают изменения, например группировку документов после изображений.

### <a name="attachment-layout"></a>Макет вложений

Поле `attachmentLayout` инструктирует средства визуализации пользовательского интерфейса, как представлять содержимое, включенное в поле [`attachments`](#attachments). Значение поля `attachmentLayout` имеет строковый тип с определенными значениями `list` и `carousel`. По умолчанию используется значение `list`.

`R3060`: если отправитель включает поле `attachmentLayout`, ему СЛЕДУЕТ отправлять только определенные значения.

`R3061`: получателям СЛЕДУЕТ интерпретировать неопределенные значения как `list`.

### <a name="summary"></a>Сводка

Поле `summary` содержит текст, используемый для замены [`attachments`](#attachments) в каналах, которые их не поддерживают. Значение поля `summary` имеет строковый тип.

`R3070`: получателям СЛЕДУЕТ рассмотреть поле `summary`, чтобы логически следовать за полем `text`.

`R3071`: каналам НЕ СЛЕДУЕТ отправлять содержимое `summary` ботам.

`R3072`: каналам, способным обрабатывать все вложения в рамках действия, СЛЕДУЕТ игнорировать поле `summary`.

### <a name="suggested-actions"></a>Рекомендуемые действия

Поле `suggestedActions` содержит полезные данные интерактивных действий, которые могут отображаться пользователю. Поддержка `suggestedActions` и их проявление сильно зависит от канала. Значение поля `suggestedActions` является составным объектом типа [Предложенные действия](#suggested-actions-2).

### <a name="value"></a>Значение

Поле `value` содержит программные полезные данные, которые относятся к отправляемому действию. Его значение и формат определены в других разделах этого документа, которые описывают его использование.

`R3080`: отправителям НЕ СЛЕДУЕТ включать поля `value` примитивных типов (например, строка или целое число). Полям `value` СЛЕДУЕТ быть сложного типа или их СЛЕДУЕТ опускать.

### <a name="expiration"></a>Окончание срока действия

Поле `expiration` содержит время, в течение которого действие должно считаться истекшим и не должно быть представлено получателю. Значение поля `expiration` — это дата и время в формате [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) [[2](#references)], закодированные в строке.

`R3090`: отправителям СЛЕДУЕТ всегда использовать кодировку значений полей `expiration` в формате UTC, а также всегда включать Z как явный знак UTC в пределах значения.

### <a name="importance"></a>приоритет

Поле `importance` содержит перечисляемый набор значений, чтобы передать получателю данные об относительной важности действия.  Получатель должен отображать эти важные подсказки для пользователя. Значение поля `importance` имеет строковый тип с определенными значениями `low`, `normal` и `high`. По умолчанию используется значение `normal`.

`R3100`: если отправитель включает поле `importance`, ему СЛЕДУЕТ отправлять только определенные значения.

`R3101`: получателям СЛЕДУЕТ интерпретировать неопределенные значения как `normal`.

### <a name="deliverymode"></a>DeliveryMode

Поле `deliveryMode` содержит один из перечисленных наборов значений, чтобы предоставить получателю альтернативные пути доставки действия.  Значение поля `DeliveryMode` имеет строковый тип с определенными значениями `normal` и `notification`. По умолчанию используется значение `normal`.

`R3110`: если отправитель включает поле `deliveryMode`, ему СЛЕДУЕТ отправлять только определенные значения.

`R3111`: получателям СЛЕДУЕТ интерпретировать неопределенные значения как `normal`.

## <a name="contact-relation-update-activity"></a>Действие обновления отношений контактов

Действия обновления отношений контактов сигнализируют об изменении отношения между получателем и пользователем в канале. Действия обновления отношений контактов обычно не содержат пользовательского содержимого. Обновление отношений, описанное действием обновления отношений контактов, которое существует между пользователем в поле `from` (часто, но не всегда, пользователем, инициирующим обновление), и пользователем или ботом в поле `recipient`.

Действия обновления отношений контактов идентифицируются по значению `type` поля `contactRelationUpdate`.

### <a name="action"></a>Действие

Поле `action` описывает значение действия обновления отношений контактов. Значение поля `action` имеет строковый тип. Определены только значения `add` и `remove`, которые обозначают отношения между пользователями или ботами в полях `from` и `recipient`.

## <a name="conversation-update-activity"></a>Действие обновления диалога

Действия обновления диалога описывают изменение или наличие участников диалога, описание или иное. В действиях обновления диалога обычно нет пользовательского содержимого. Обновляемый диалог описывается в поле `conversation`.

Действия обновления диалога идентифицируются по значению `type` поля `conversationUpdate`.

`R4100`: отправители МОГУТ не включать ни одного из полей `membersAdded`, `membersRemoved`, `topicName` и `historyDisclosed` в действии обновления диалога или включать их.

`R4101`: каждый `channelAccount` (идентифицированный полем `id`) СЛЕДУЕТ отображать не более одного раза в полях `membersAdded` и `membersRemoved`. Идентификатор НЕ РЕКОМЕНДУЕТСЯ отображать в обоих полях. Идентификатор НЕ РЕКОМЕНДУЕТСЯ дублировать в любом поле.

`R4102`: в каналах НЕ РЕКОМЕНДУЕТСЯ использовать действия обновления диалога, чтобы указать изменения полей учетной записи канала (например, `name`), если учетная запись канала не была добавлена ​​или удалена из диалога.

`R4103`: каналам НЕ РЕКОМЕНДУЕТСЯ отправлять поля `topicName` или `historyDisclosed`, если действие не сигнализирует об изменении значения любого поля.

### <a name="members-added"></a>Добавление участников

Поле `membersAdded` содержит список участников канала (ботов или пользователей), добавленных в диалог. Значение поля `membersAdded` представляет собой массив типа [`channelAccount`](#channel-account).

### <a name="members-removed"></a>Удаление участников

Поле `membersRemoved` содержит список участников канала (ботов или пользователей), удаленных из диалога. Значение поля `membersRemoved` представляет собой массив типа [`channelAccount`](#channel-account).

### <a name="topic-name"></a>Имя раздела

Поле `topicName` содержит тему текста или описание диалога. Значение поля `topicName` имеет строковый тип.

### <a name="history-disclosed"></a>Раскрытие истории

Поле `historyDisclosed` является устаревшим.

`R4110`: отправителям НЕ РЕКОМЕНДУЕТСЯ включать поле `historyDisclosed`.

## <a name="end-of-conversation-activity"></a>Действие окончания диалога

Конец диалога сигнализирует о завершении диалога с точки зрения получателя. Возможно, это связано с тем, что диалог был полностью завершен или потому, что получатель был удален из него способом, который неотличим от его окончания. Оконченный диалог описывается в поле `conversation`.

Действия завершения диалога идентифицируются по значению `type` поля `endOfConversation`.

Оба поля `code` и `text` являются необязательными.

### <a name="code"></a>Код

Поле `code` содержит программное значение, описывающее, почему и как завершился диалог. Значение поля `code` имеет строковый тип, а его значение определяется каналом, отправляющим действие.

### <a name="text"></a>текст

Поле `text` содержит необязательное текстовое содержимое, которое будет передано пользователю. Значение поля `text` имеет строковый тип, а его формат — это обычный текст.

## <a name="event-activity"></a>Действие события

Действия событий передают программную информацию из клиента или канала боту. Значение действия события определяется полем `name`, которое имеет смысл в пределах объема канала. Действия событий предназначены для переноса как интерактивной информации (например, нажатия кнопки), так и неинтерактивной (например, уведомление о том, что клиент автоматически обновляет встроенную модель речи).

Действия событий — это асинхронный аналог [действия вызова](#invoke-activity). В отличие от вызова, событие предназначено для расширений клиентских приложений.

Действия событий идентифицируются значением `type` поля `event` и конкретными значениями поля `name`.

`R5000`: каналы МОГУТ допускать сообщения о назначении приложений между клиентами и ботами, если клиенты разрешают настройку приложения.

### <a name="name"></a>ИМЯ

Поле `name` управляет значением события и схемой поля `value`. Значение поля `name` имеет строковый тип.

`R5001`: действия событий ДОЛЖНЫ содержать поле `name`.

`R5002`: получатели ДОЛЖНЫ игнорировать события с полями `name`, которые они не понимают.

### <a name="value"></a>Значение

Поле `value` содержит параметры, специфичные для этого события, как определено именем события. Значение поля `value` имеет сложный тип.

`R5100`: поле `value` МОЖЕТ отсутствовать или быть пустым, если определено именем события.

`R5101`: расширения для действия события НЕ ДОЛЖНЫ требовать от получателей использовать любую информацию, отличную от полей действия `type` и `name`, чтобы понять схему поля `value`.

### <a name="relates-to"></a>Относится к

Поле `relatesTo` ссылается на другой диалог и необязательно на конкретное действие внутри этого действия. Значение поля `relatesTo` является составным объектом ссылочного типа "Диалог".

`R5200`: `relatesTo` НЕ СЛЕДУЕТ ссылаться на действие в диалоге, указанном в поле `conversation`.

## <a name="invoke-activity"></a>Действие вызова

Действия вызова передают программную информацию от клиента или канала к боту и имеют соответствующие полезные данные для использования в канале. Значение действия вызова определяется полем `name`, которое имеет смысл в пределах объема канала. 

Действия вызова — это асинхронный аналог [действий событий](#event-activity). Действия событий имеют возможность расширения. Действия вызова отличаются только тем, что они возвращают полезные данные ответа в канал, потому что канал должен решить, где и как обрабатывать эти полезные данные ответа. Вызов полезен только в случаях, когда явная поддержка каждого имени вызова добавлена ​​в канал. Таким образом, вызов не предназначен для создания универсального механизма расширяемости приложений.

Действия вызова идентифицируются значением `type` поля `invoke` и конкретными значениями поля `name`.

Список определенных действий вызова включен в [Приложение III](#appendix-iii---protocols-using-the-invoke-activity).

`R5301`: каналам НЕ СЛЕДУЕТ разрешать определенные приложением сообщения вызова между клиентами и ботами.

### <a name="name"></a>ИМЯ

Поле `name` управляет значением вызова и схемой поля `value`. Значение поля `name` имеет строковый тип.

`R5401`: действия вызова ДОЛЖНЫ содержать поле `name`.

`R5402`: получатели ДОЛЖНЫ игнорировать события с полями `name`, которые они не понимают.

### <a name="value"></a>Значение

Поле `value` содержит параметры, специфичные для этого события, как определено именем события. Значение поля `value` имеет сложный тип.

`R5500`: поле `value` МОЖЕТ отсутствовать или быть пустым, если определено именем события.

`R5501`: расширения для действия события НЕ ДОЛЖНЫ требовать от получателей использовать любую информацию, отличную от полей действия `type` и `name`, чтобы понять схему поля `value`.

### <a name="relates-to"></a>Относится к

Поле `relatesTo` ссылается на другой диалог и необязательно на конкретное действие внутри этого действия. Значение поля `relatesTo` является составным объектом ссылочного типа [Диалог](#conversation-reference).

`R5600`: `relatesTo` НЕ СЛЕДУЕТ ссылаться на действие в диалоге, указанном в поле `conversation`.

## <a name="installation-update-activity"></a>Действие обновления установки

Действия обновления установки представляют собой установку или удаление бота внутри организационного подразделения (например, арендатора клиента или команды) канала. Действия обновления установки обычно не представляют собой добавление или удаление канала.

Действия обновления установки идентифицируются по значению `type` поля `installationUpdate`.

`R5700`: каналы МОГУТ отправлять действия установки, когда бот добавляется или удаляется из клиента, команды или других подразделений в канале.

`R5701`: каналам НЕ СЛЕДУЕТ отправлять действия установки, когда туда установлен или удален бот.

### <a name="action"></a>Действие

Поле `action` описывает значение действия обновления установки. Значение поля `action` имеет строковый тип. Указаны только значения `add` и `remove`.

## <a name="message-delete-activity"></a>Действие удаления сообщения

Действие удаления сообщения представляет собой удаление имеющегося действия сообщения в диалоге. Удаленное действие указывается полями `id` и `conversation` в рамках действия.

Действия удаления сообщения идентифицируются по значению `type` поля `messageDelete`.

`R5800`: каналы МОГУТ потребовать отправлять действия удаления сообщений для всех удалений в диалоге, подмножеств удалений (например, только удаление определенных пользователей) или никаких действий.

`R5801`: каналам НЕ СЛЕДУЕТ отправлять действия удаления сообщений для диалогов или действий, которые бот не наблюдает.

`R5802`: если бот запускает удаление, каналам НЕ СЛЕДУЕТ отправлять сообщение об удалении действия этому боту.

`R5803`: каналам НЕ СЛЕДУЕТ отправлять действия удаления сообщения, соответствующие действиям, тип которых отличный от `message`.

## <a name="message-update-activity"></a>Действие обновления сообщения

Действия обновления сообщения представляют собой обновление имеющегося действия сообщения в диалоге. Обновленное действие указывается в полях `id` и `conversation` в рамках действия, а действие обновления сообщения содержит все поля в измененном действии сообщения.

Действия обновления сообщения идентифицируются по значению `type` поля `messageUpdate`.

`R5900`: каналы МОГУТ потребовать действия обновления сообщения для всех обновлений в диалоге, подмножества обновлений (например, только обновление определенных пользователей) или никаких действий.

`R5901`: если бот запускает обновление, каналам НЕ СЛЕДУЕТ отправлять сообщение об обновлении действия этому боту.

`R5902`: каналам НЕ СЛЕДУЕТ отправлять действия обновления сообщения, соответствующие действиям, тип которых отличный от `message`.

## <a name="message-reaction-activity"></a>Действие реагирования на сообщение

Действия реагирования на сообщения представляют собой реагирование на имеющееся действие сообщения в диалоге. Изначальное действие указывается полями `id` и `conversation` в рамках действия. Поле `from` представляет собой источник реагирования (то есть пользователя, который отреагировал на сообщение).

Действия реагирования сообщения идентифицируются по значению `type` поля `messageReaction`.

### <a name="reactions-added"></a>Добавленные реагирования

Поле `reactionsAdded` содержит список реагирований, добавленных в это действие. Значение поля `reactionsAdded` представляет собой массив типа [`messageReaction`](#message-reaction).

### <a name="reactions-removed"></a>Удаленные реагирования

Поле `reactionsRemoved` содержит список реагирований, удаленных из этого действия. Значение поля `reactionsRemoved` представляет собой массив типа [`messageReaction`](#message-reaction).

## <a name="typing-activity"></a>Действие ввода

Действия ввода представляют собой активный ввод пользователя или бота. Это действие часто отправляется при нажатии пользователем клавиш, хотя оно также используется ботами, чтобы указать, что они "думают", а также использоваться для обозначения, например, получение аудио от пользователей.

Действия ввода должны сохраняться в пользовательских интерфейсах в течение трех секунд.

Действия вода идентифицируются по значению `type` поля `typing`.

`R6000`: если возможно, клиенты ДОЛЖНЫ отображать индикаторы ввода в течение трех секунд после получения действия ввода.

`R6001`: если иное не известно каналу, отправителям НЕ СЛЕДУЕТ отправлять действия ввода чаще, чем один раз за три секунды. (Отправители могут отправлять действия ввода каждые две секунды во избежание пропусков.)

`R6002`: если канал назначает [`id`](#id) действию ввода, он МОЖЕТ позволить ботам и клиентам удалять это действие до истечения его срока действия.

`R6003`: если возможно, каналы ДОЛЖНЫ отправлять действия ввода ботам.

## <a name="complex-types"></a>Сложные типы

В этом разделе описаны сложные типы, используемые в схеме действий, описанной выше.

### <a name="attachment"></a>Вложение

Вложения — это содержимое, включенное в карточки [действий сообщений](#message-activity) (двоичные документы и другое интерактивное содержимое). Они предназначены для отображения в сочетании с текстовым содержимым. Содержимое может быть отправлено через URI данных URL-адреса в поле `contentUrl` или встроено в поле `content`.

`R7100`: отправителям НЕ СЛЕДУЕТ включать оба поля `content` и `contentUrl` в одно вложение.

#### <a name="content-type"></a>Тип содержимого

Поле `contentType` описывает тип [носителя MIME ](https://www.iana.org/assignments/media-types/media-types.xhtml) [[8](#references)] содержимого вложения. Значение поля `contentType` имеет строковый тип.

#### <a name="content"></a>Содержимое

Если присутствует содержимое, поле `content` содержит структурированное вложение объекта JSON. Значение поля `content` имеет сложный тип, указанный в поле `contentType`.

`R7110`: отправителям НЕ СЛЕДУЕТ включать примитивы JSON в поле `content` вложения.

#### <a name="content-url"></a>URL-адрес содержимого

Когда URL-адрес присутствует, поле `contentUrl` содержит URL-адрес содержимого в приложении. Коды URI данных, определенные в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)], обычно поддерживаются каналами. Значение поля `contentUrl` имеет строковый тип.

`R7120`: получателям СЛЕДУЕТ принимать URL-адреса HTTPS.

`R7121`: получатели МОГУТ принимать URL-адреса HTTPS.

`R7122`: каналам СЛЕДУЕТ принимать коды URI данных.

`R7123`: каналам НЕ СЛЕДУЕТ посылать коды URI данных клиентам или ботам.

#### <a name="name"></a>ИМЯ

Поле `name` содержит необязательное имя или имя файла для вложения. Значение поля `name` имеет строковый тип.

#### <a name="thumbnail-url"></a>URL-адрес эскиза

Некоторые клиенты имеют возможность отображать пользовательские эскизы для неинтерактивных вложений или в качестве заполнителей для интерактивных вложений. Поле `thumbnailUrl` идентифицирует источник этого эскиза. Коды URI данных, определенные в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)], обычно допускаются.

`R7140`: получателям СЛЕДУЕТ принимать URL-адреса HTTPS.

`R7141`: получатели МОГУТ принимать URL-адреса HTTPS.

`R7142`: каналам СЛЕДУЕТ принимать коды URI данных.

`R7143`: каналам НЕ СЛЕДУЕТ отправлять поля `thumbnailUrl` ботам.

### <a name="card-action"></a>Действие карточки

Действие карточки представляет собой доступную для щелчка или интерактивную кнопку для использования в карточках или как [предлагаемые действия](#suggested-actions). Они используются для запроса информации от пользователей. Несмотря на свое имя, действия карточки не ограничиваются исключительно использованием карточек.

Действия карточки имеют смысл только при отправке в каналы.

Каналы решают, как каждое действие проявляется в их взаимодействии с пользователем. В большинстве случаев карточки доступны для щелчка. В других случаях они могут быть выбраны путем ввода речи. В тех случаях, когда канал не предлагает интерактивную активацию (например, при взаимодействии через SMS), канал может не поддерживать активацию вообще. Решение о том, как выполнять действия, контролируется нормативными требованиями в другой части этого документа (например, в формате карточки или в определении [предлагаемых действий](#suggested-actions)).

#### <a name="type"></a>type

Поле `type` описывает значение кнопки и поведения, когда кнопка активирована. Значения поля `type` по соглашению имеет короткие строки (например, "`openUrl`"). Дополнительные сведения о требованиях, характерных для каждого типа действия, см. в следующих разделах.

* Действие типа `messageBack` представляет собой текстовый ответ для отправки через чат-систему.
* Действие типа `imBack` представляет собой текстовый ответ, который добавляется в канал чата.
* Действие типа `postBack` представляет собой текстовый ответ, который не добавляется в канал чата.
* Действие типа `openUrl` представляет собой гиперссылку, обрабатываемую клиентом.
* Действие типа `downloadFile` представляет собой гиперссылку для скачивания.
* Действие типа `showImage` представляет изображение, которое может отображаться.
* Действие типа `signin` представляет собой гиперссылку, обрабатываемую системой входа клиента.
* Действие типа `playAudio` представляет собой аудиоданные, которые могут быть воспроизведены.
* Действие типа `playVideo` представляет собой видеоданные, которые могут быть воспроизведены.
* Действие типа `call` представляет собой номер телефона, который может быть вызван.
* Действие типа `payment` представляет собой запрос на предоставление платежа.

#### <a name="title"></a>Название

Поле `title` включает текст, который будет отображаться на поверхности кнопки. Значение поля `title` имеет строковый тип и не содержит разметки.

Это поле относится к действиям всех типов.

`R7210`: каналам НЕ СЛЕДУЕТ обрабатывать разметку в поле `title` (например, Markdown).

#### <a name="image"></a>Образ —

Поле `image` содержит URL-адрес, ссылающийся на изображение, которое должно отображаться на поверхности кнопки. Коды URI данных, определенные в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)], обычно поддерживаются каналами. Значение поля `image` имеет строковый тип.

Это поле относится к действиям всех типов.

`R7220`: каналам СЛЕДУЕТ принимать URL-адреса HTTPS.

`R7221`: каналы МОГУТ принимать URL-адреса HTTPS.

`R7222`: каналам СЛЕДУЕТ принимать коды URI данных.

#### <a name="text"></a>текст

Поле `text` содержит текстовое содержимое, которое должно быть отправлено боту и включено в канал чата при нажатии кнопки. Содержимое поля `text` может отображаться или не отображаться в зависимости от типа кнопки. Поле `text` может содержать разметку, управляемую полем [`textFormat`](#text-format) в корне действия. Значение поля `text` имеет строковый тип.

Это поле используется только для действий выбранных типов. Подробная информация о каждом типе действий приведена ниже в этом документе.

`R7230`: поле `text` МОЖЕТ содержать пустую строку для указания отправки текста без содержимого.

`R7231`: каналам СЛЕДУЕТ обрабатывать содержимое поля `text` в соответствии с полем [`textFormat`](#text-format) в корне действия.

#### <a name="display-text"></a>Отображаемый текст

Поле `displayText` содержит текстовое содержимое, которое должно быть включено в канал чата при нажатии кнопки. Содержимое поля `displayText` СЛЕДУЕТ всегда отображать, когда это технически возможно внутри канала. Поле `displayText` может содержать разметку, управляемую полем [`textFormat`](#text-format) в корне действия. Значение поля `displayText` имеет строковый тип.

Это поле используется только для действий выбранных типов. Подробная информация о каждом типе действий приведена ниже в этом документе.

`R7240`: поле `displayText` МОЖЕТ содержать пустую строку для указания отправки текста без содержимого.

`R7241`: каналам СЛЕДУЕТ обрабатывать содержимое поля `displayText` в соответствии с полем [`textFormat`](#text-format) в корне действия.

#### <a name="value"></a>Значение

Поле `value` содержит программное содержимое для отправки боту при нажатии кнопки. Содержимое поля `value` имеет какой-либо примитивный или сложный тип, хотя определенные виды действий ограничивают это поле.

Это поле используется только для действий выбранных типов. Подробная информация о каждом типе действий приведена ниже в этом документе.

#### <a name="message-back"></a>Ответное сообщение

Действие `messageBack` представляет собой текстовый ответ для отправки через чат-систему. Ответное сообщение использует следующие поля:
* `type` ("`messageBack`")
* `title`
* `image`
* `text`
* `displayText`
* `value` (любого типа)

`R7350`: отправителям НЕ СЛЕДУЕТ включать поля `value` примитивных типов (например, строка или целое число). Полям `value` СЛЕДУЕТ быть сложного типа или их СЛЕДУЕТ опускать.

`R7351`: каналы МОГУТ отклонять или отбрасывать поля `value` несложного типа.

`R7352`: при активации каналы ДОЛЖНЫ отправлять действия типа `message` всем соответствующим получателям.

`R7353`: если канал поддерживает сохранение и передачу текста, содержимое поля `text` действия ДОЛЖНО сохраняться и передаваться в поле `text` сгенерированного сообщения.

`R7352`: если канал поддерживает сохранение и передачу дополнительных программных значений, содержимое поля `value` ДОЛЖНО сохраняться и передаваться в поле `value` генерируемого действия сообщения.

`R7353`: если канал поддерживает сохранение другого значения в канале чата, чем отправляемое ботам, он ДОЛЖЕН включать поле `displayText` в историю чата.

`R7354`: если канал не поддерживает `R7353`, но поддерживает запись текста в канале чата, он ДОЛЖЕН включить поле `text` в историю чата.

#### <a name="im-back"></a>Ответное мгновенное сообщение

Действие `imBack` представляет собой текстовый ответ, который добавляется в канал чата. Ответное сообщение использует следующие поля:
* `type` ("`imBack`")
* `title`
* `image`
* `value` (строкового типа)

`R7360`: при активации каналы ДОЛЖНЫ отправлять действия типа `message` всем соответствующим получателям.

`R7361`: если канал поддерживает сохранение и передачу текста, содержимое поля `title` ДОЛЖНО сохраняться и передаваться в поле `text` сгенерированного сообщения.

`R7362`: если поле `title` в действии отсутствует, а поле `value` имеет строковый тип, канал МОЖЕТ передать содержимое поля `value` в поле `text` генерируемого сообщения.

`R7363`: если канал поддерживает запись текста в канале чата, он ДОЛЖЕН включать содержимое поля `title` в истории чата.

#### <a name="post-back"></a>Обратная отправка

Действие `postBack` представляет собой текстовый ответ, который не добавляется в канал чата. Обратная отправка использует следующие поля:
* `type` ("`postBack`")
* `title`
* `image`
* `value` (строкового типа)

`R7370`: при активации каналы ДОЛЖНЫ отправлять действия типа `message` всем соответствующим получателям.

`R7371`: каналам НЕ СЛЕДУЕТ включать текст в историю чата, когда активировано действие обратной отправки.

`R7372`: каналы ДОЛЖНЫ отклонять или отбрасывать поля `value` нестрокового типа.

`R7373`: если канал поддерживает сохранение и передачу текста, содержимое поля `value` ДОЛЖНО сохраняться и передаваться в поле `text` сгенерированного сообщения.

`R7374`: если канал не может поддерживать передачу боту, не включая историю в канале чата, он ДОЛЖЕН использовать поле `title` в качестве отображаемого текста.

#### <a name="open-url-actions"></a>Действия открытия URL-адреса

Действие `openUrl` представляет собой гиперссылку, обрабатываемую клиентом. Открытие URL-адреса использует следующие поля:
* `type` ("`openUrl`")
* `title`
* `image`
* `value` (строкового типа)

`R7380`: отправители ДОЛЖНЫ включать URL-адрес в поле `value` действия `openUrl`.

`R7381`: получатели МОГУТ отклонять действие `openUrl`, чье поле `value` отсутствует или не является строкой.

`R7382`: получателям СЛЕДУЕТ отклонять или отбрасывать действия `openUrl`, чье поле `value` содержит URI данных, как определено в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)].

`R7383`: получателям НЕ СЛЕДУЕТ отклонять действия `openUrl`, коды URI `value` которых в противном случае обладают неожиданной схемой или значением URI.

`R7384`: клиенты со знанием конкретных схем URI (например, HTTP) МОГУТ обрабатывать действия `openUrl` внутри встроенного средства визуализации (например, управление браузером).

`R7385`: если доступно, клиентам СЛЕДУЕТ делегировать обработку действий `openUrl`, не обработанных `R7354`, обработчику URI операционной системы или оболочки.

#### <a name="download-file-actions"></a>Действия скачивания файла

Действие `downloadFile` представляет собой гиперссылку для скачивания. Скачивание файла использует следующие поля:
* `type` ("`downloadFile`")
* `title`
* `image`
* `value` (строкового типа)

`R7390`: отправители ДОЛЖНЫ включать URL-адрес в поле `value` действия `downloadFile`.

`R7391`: получатели МОГУТ отклонять действие `downloadFile`, чье поле `value` отсутствует или не является строкой.

`R7392`: получателям СЛЕДУЕТ отклонять или отбрасывать действия `downloadFile`, чье поле `value` содержит URI данных, как определено в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)].

#### <a name="show-image-file-actions"></a>Действия отображения файла изображения

Действие `showImage` представляет изображение, которое может отображаться. Отображение изображения использует следующие поля:
* `type` ("`showImage`")
* `title`
* `image`
* `value` (строкового типа)

`R7400`: отправители ДОЛЖНЫ включать URL-адрес в поле `value` действия `showImage`.

`R7401`: получатели МОГУТ отклонять действие `showImage`, чье поле `value` отсутствует или не является строкой.

`R7402`: получатели МОГУТ отклонить целое поле `value` действия `showImage`, которое является URI данных, как определено в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)].

#### <a name="signin"></a>Signin

Действие `signin` представляет собой гиперссылку, обрабатываемую системой входа клиента. Вход использует следующие поля:
* `type` ("`signin`")
* `title`
* `image`
* `value` (строкового типа)

`R7410`: отправители ДОЛЖНЫ включать URL-адрес в поле `value` действия `signin`.

`R7411`: получатели МОГУТ отклонять действие `signin`, чье поле `value` отсутствует или не является строкой.

`R7412`: получатели ДОЛЖНЫ отклонять или отбрасывать действия `signin`, чье поле `value` содержит URI данных, как определено в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)].

#### <a name="play-audio"></a>Воспроизведение аудио

Действие `playAudio` представляет собой аудиоданные, которые могут быть воспроизведены. Воспроизведение аудио использует следующие поля:
* `type` ("`playAudio`")
* `title`
* `image`
* `value` (строкового типа)

`R7420`: при активации каналы МОГУТ посылать события мультимедиа.

`R7421`: каналы ДОЛЖНЫ отклонять или отбрасывать поля `value` нестрокового типа.

`R7422`: отправителям НЕ СЛЕДУТ отправлять коды URI данных, как определено в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)], без предварительного уведомления о том, что канал поддерживает их.

#### <a name="play-video"></a>Воспроизведение видео

Действие `playAudio` представляет собой видеоданные, которые могут быть воспроизведены. Воспроизведение видео использует следующие поля:
* `type` ("`playVideo`")
* `title`
* `image`
* `value` (строкового типа)

`R7430`: при активации каналы МОГУТ посылать события мультимедиа.

`R7431`: каналы ДОЛЖНЫ отклонять или отбрасывать поля `value` нестрокового типа.

`R7432`: отправителям НЕ СЛЕДУТ отправлять коды URI данных, как определено в [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)], без предварительного уведомления о том, что канал поддерживает их.

#### <a name="call"></a>Вызов

Действие `call` представляет собой номер телефона, который может быть вызван. Вызов использует следующие поля:
* `type` ("`call`")
* `title`
* `image`
* `value` (строкового типа)

`R7440`: отправители ДОЛЖНЫ включать URL-адрес схемы `tel` в поле `value` действия `signin`.

`R7441`: получатели ДОЛЖНЫ отклонять действие `signin`, чье поле `value` отсутствует или не является URI строки схемы `tel`.

#### <a name="payment"></a>Платеж

Действие `payment` представляет собой запрос на предоставление платежа. Платеж использует следующие поля:
* `type` ("`payment`")
* `title`
* `image`
* `value` (сложного типа [запрос платежа](#payment-request))

`R7450`: отправители ДОЛЖНЫ включать сложный объект типа [Запрос платежа](#payment-request) в поле `value` действия `payment`.

`R7451`: каналы ДОЛЖНЫ отклонять действие `payment`, чье поле `value` отсутствует или не является сложным объектом типа [Запрос платежа](#payment-request).

### <a name="channel-account"></a>Учетная запись канала

Учетные записи канала представляют собой идентификаторы в канале. Учетная запись канала содержит идентификатор, который можно использовать для идентификации и связи с учетной записью внутри этого канала. Иногда эти идентификаторы существуют в пределах одного пространства имен (например, идентификаторы Skype). Иногда они объединяются на нескольких серверах (например, адреса электронной почты). Помимо идентификатора, учетные записи каналов содержат отображаемые имена и идентификаторы объектов Azure Active Directory (AAD).

#### <a name="channel-account-id"></a>Идентификатор учетной записи канала

Поле `id` — это идентификатор и адрес в канале. Значение поля `id` имеет строковый тип. Примером `id` в канале, который использует адреса электронной почты, является "name@example.com".

`R7510`: каналам СЛЕДУЕТ использовать те же значения и условные обозначения для идентификаторов учетной записи, независимо от их положения в схеме (`from.id`, `recipient.id`, `membersAdded` и т. д.). Это позволяет ботам и клиентам использовать порядковое сравнение строк, чтобы знать, когда, например, они описаны в поле `membersAdded` действия `conversationUpdate`.

#### <a name="channel-account-name"></a>Имя учетной записи канала

Поле `name` является необязательным понятным именем внутри канала. Значение поля `name` имеет строковый тип. Пример `name` в канале — это "Джон Доу".

#### <a name="channel-account-aad-object-id"></a>Идентификатор объекта AAD учетной записи канала

Поле `aadObjectId` является необязательным идентификатором, соответствующим идентификатору объекта учетной записи в Azure Active Directory (AAD). Значение поля `aadObjectId` имеет строковый тип.

### <a name="conversation-account"></a>Учетная запись диалога

Учетные записи диалогов представляют собой идентификатор диалогов внутри канала. В каналах, поддерживающих только один диалог между двумя учетными записями (например, SMS), учетная запись диалога является постоянной и не имеет заданного начала или конца. В каналах, поддерживающих несколько параллельных диалогов (например, электронная почта), каждый диалог будет иметь уникальный идентификатор.

#### <a name="conversation-account-id"></a>Идентификатор учетной записи диалога

Поле `id` — это идентификатор в канале. Формат этого идентификатора определяется каналом и используется как непрозрачная строка в протоколе.

Каналам СЛЕДУЕТ выбирать значения `id`, которые являются стабильными для всех участников в диалоге. (Например, плохой пример поля `id` для диалога 1:1 — это использовать идентификатор другого участника как значение `id`. Это приведет к другому `id` ​​с точки зрения каждого участника. Лучше выбрать сортировку идентификаторов обоих участников и объединить их вместе для обеих сторон.)

#### <a name="conversation-account-name"></a>Имя учетной записи диалога

Поле `name` является необязательным, понятным именем диалога внутри канала. Значение поля `name` имеет строковый тип.

#### <a name="conversation-account-aad-object-id"></a>Идентификатор объекта AAD учетной записи диалога

Поле `aadObjectId` является необязательным идентификатором, соответствующим идентификатору объекта диалога в Azure Active Directory (AAD). Значение поля `aadObjectId` имеет строковый тип.

#### <a name="conversation-account-is-group"></a>Поле isGroup учетной записи диалога

Поле `isGroup`, указывающее, содержит ли общение более двух участников во время создания действия. Значение поля `isGroup` является логическим. Если опустить его, значение по умолчанию равно `false`. Это поле обычно управляет поведением при упоминании участников канала. Для него СЛЕДУЕТ установить значение `true` тогда и только тогда, когда больше двух участников могут отправлять и получать действия в ходе диалога.

### <a name="entity"></a>Сущность

Сущности содержат метаданные действия или диалога. Значение и форма каждого объекта определяются полем `type`, а дополнительные поля, относящиеся к конкретному типу, помещаются как одноранговые узлы в поле `type`.

`R7600`: получатели ДОЛЖНЫ игнорировать объекты, типы которых они не распознают.

`R7601`: получателям СЛЕДУЕТ игнорировать объекты, тип которых они распознают, но не могут обрабатывать из-за, например, синтаксических ошибок.

Сторонам, отображающим существующий тип сущности в формате сущности действия, рекомендуется разрешать конфликты с именем поля `type` и несовместимостью с требованием сериализации `R2001` как частью привязки между IRI и схемой сущности.

#### <a name="type"></a>type

Поле `type` обязательно и определяет значение и форму сущности. `type` предназначено для размещения [IRI](https://tools.ietf.org/html/rfc3987) [[3](#references)], несмотря на то, что существует ряд сущностей, отличных от IRI, которые определены в [Приложении I](#appendix-ii---non-iri-entity-types).

`R7610`: отправителям СЛЕДУЕТ использовать имена типов, отличных от IRI, только для типов, описанных в [Приложении II](#appendix-ii---non-iri-entity-types).

`R7611`: отправители могут отправлять типы IRI для типов, описанных в [Приложении II](#appendix-ii---non-iri-entity-types), если они знают, что получатель их распознает.

`R7612`: отправителям СЛЕДУЕТ использовать или установить IRI для типов сущностей, не определенных в [Приложении II](#appendix-ii---non-iri-entity-types).

### <a name="suggested-actions"></a>Рекомендуемые действия

Предлагаемые действия могут быть отправлены в содержимом сообщения для создания интерактивных элементов действий в пользовательском интерфейсе клиента.

`R7700`: клиентам, которые не поддерживают интерфейс, способный отображать предлагаемые действия, СЛЕДУЕТ игнорировать поле `suggestedActions`.

`R7701`: отправителям СЛЕДУЕТ опустить поле `suggestedActions`, если поле `actions` пустое.

#### <a name="to"></a>Кому

Поле `to` содержит идентификаторы учетной записи канала, которым должны отображаться предлагаемые действия. Это поле может использоваться для фильтрации действий для подмножества участников в диалоге.

`R7710`: если поле `to` отсутствует или пустое, клиенту СЛЕДУЕТ отображать предлагаемые действия всем участникам беседы.

`R7711`: если поле `to` содержит недопустимые идентификаторы, эти значения СЛЕДУЕТ игнорировать.

#### <a name="actions"></a>Действия

Поле `actions` содержит неструктурированный список отображаемых действий. Значение каждого элемента списка `actions` является сложным объектом типа `cardAction`.

### <a name="message-reaction"></a>Реагирование на сообщение

Реагирование на сообщение представляет собой социальное взаимодействие (отметка "Нравится", "+1" и т. д.). Реагирования на сообщения в настоящее время содержат только одно поле — `type`.

#### <a name="type"></a>type

Поле `type` описывает тип социального взаимодействия. Значение поля `type` является строкой, а ее значение определяется каналом, в котором происходит взаимодействие. Некоторые общие значения, такие как `like` и `+1`, хотя они единообразны по соглашению, а не по правилу.

## <a name="references"></a>Ссылки

1. [RFC 2119](https://tools.ietf.org/html/rfc2119)
2. [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)
3. [RFC 3987](https://tools.ietf.org/html/rfc3987)
4. [Markdown](https://daringfireball.net/projects/markdown/)
5. [ISO 639](https://www.iso.org/iso-639-language-codes.html)
6. [SSML](https://www.w3.org/TR/speech-synthesis/)
7. [XML](https://www.w3.org/TR/xml/)
8. [типы мультимедиа MIME](https://www.iana.org/assignments/media-types/media-types.xhtml)
9. [RFC 2397](https://tools.ietf.org/html/rfc2397)
10. [ISO 3166-1](https://www.iso.org/iso-3166-country-codes.html)
11. [Адаптивные карточки](https://adaptivecards.io)

# <a name="appendix-i---changes"></a>Приложение I. Изменения

## <a name="2018-02-07"></a>2018-02-07

* Первоначальный черновик

# <a name="appendix-ii---non-iri-entity-types"></a>Приложение II. Типы сущностей, отличные от IRI

[Сущности](#entity) действий сообщают дополнительные метаданные действия, такие как местоположение пользователей или версия приложения для обмена сообщениями, которое они используют. Виды действий предназначены для IRI, но в общем случае используется небольшой список имен, не относящихся к IRI. Это приложение является исчерпывающим списком поддерживаемых типов сущностей, не относящихся к IRI.

| type           | Эквивалент URI                          | ОПИСАНИЕ               |
| -------------- | --------------------------------------- | ------------------------- |
| GeoCoordinates | https://schema.org/GeoCoordinates       | Schema.org GeoCoordinates |
| Mention        | https://botframework.com/schema/mention | @-mention                 |
| Место          | https://schema.org/Place                | Место Schema.org          |
| Thing          | https://schema.org/Thing                | Объект Schema.org          |
| clientInfo     | Недоступно                                     | Сведения о клиенте Skype         |

### <a name="clientinfo"></a>clientInfo

Сущность clientInfo содержит расширенную информацию о клиентском программном обеспечении, используемом для отправки сообщения пользователя. Он содержит три свойства, все из которых являются необязательными.

`R9201`: ботам НЕ СЛЕДУЕТ отправлять объект `clientInfo`.

`R9202`: отправителям СЛЕДУЕТ включать объект `clientInfo` только при заполнении одного или нескольких полей.

#### <a name="locale-deprecated"></a>Языковой стандарт (устарело)

Поле `locale` содержит языковой стандарт пользователя. Это поле дублирует поле [`locale`](#locale) в корне действия. Значение поля `locale` — это код [ISO 639](https://www.iso.org/iso-639-language-codes.html) [[5](#references)] в строке.

Поле `locale` в `clientInfo` является устаревшим.

`R9211`: получателям НЕ СЛЕДУЕТ использовать поле `locale` внутри объекта `clientInfo`.

`R9212`: отправители МОГУТ заполнить поле `locale` в `clientInfo` по соображениям совместимости. Если совместимость со старыми получателями не требуется, отправителям НЕ СЛЕДУЕТ отправлять свойство `locale`.

#### <a name="country"></a>Страна

Поле `country` содержит обнаруженное пользователем местоположение. Это значение может отличаться от любых данных [`locale`](#locale) при обнаружении `country`, тогда как `locale` обычно является настройкой пользователя или приложения. Значение поля `country` — это 2-х или 3-х буквенный код страны в формате [ISO 3166-1](https://www.iso.org/iso-3166-country-codes.html) [[10](#references)].

`R9220`: каналам НЕ СЛЕДУЕТ разрешать клиентам указывать произвольные значения для поля `country`. Каналам СЛЕДУЕТ использовать такой механизм, как GPS, определение местоположения API или обнаружение IP-адресов, чтобы установить страну, генерирующую запрос.

#### <a name="platform"></a>платформа

Поле `platform` описывает клиентскую платформу обмена сообщениями, используемую для генерации действий. Значение поля `platform` — это строка, а список возможных значений и их значение определяется каналом, отправляющим их.

Обратите внимание, что на каналах с постоянным чат-каналом поле `platform` обычно полезно только при определении включаемого содержимого, а не его формата. Например, если пользователь на мобильном устройстве запрашивает помощь по поддержке продукта, бот может генерировать помощь, подходящую для мобильного устройства. Однако пользователь может снова открыть канал чата на своем ПК, чтобы он мог читать его на этом экране при внесении изменений в мобильное устройство. В этой ситуации поле `platform` предназначено для информирования содержимого, но содержимое должно быть доступно для просмотра на других устройствах.

`R9230`: ботам НЕ СЛЕДУЕТ использовать поле `platform` для управления форматированием данных, если у них нет конкретного понимания того, что отправляемое содержимое может когда-либо отображаться на запрашиваемом устройстве.

# <a name="appendix-iii---protocols-using-the-invoke-activity"></a>Приложение III. Протоколы, использующие действия вызова

[Действие вызова](#invoke-activity) предназначено для использования только в рамках протоколов, поддерживаемых каналами Bot Framework (т. е. не является универсальным механизмом расширения). Это приложение содержит список всех протоколов Bot Framework, использующих это действие.

## <a name="payments"></a>Платежи

В протоколе платежей Bot Framework используется вызов для расчета ставок по доставке и налогам, а также для информирования о точном подтверждении выполненных платежей.

Протокол платежей определяет три операции (указанные в поле `name` действия вызова):
* `payment/shippingAddressChange`
* `payment/shppingOptionsChange`
* `payment/paymentResponse`

Более подробные сведения можно найти на странице [Request payment](https://docs.microsoft.com/en-us/bot-framework/dotnet/bot-builder-dotnet-request-payment) (Запрос платежа).

## <a name="teams-compose-extension"></a>Расширение Teams compose

Канал Microsoft Teams использует вызов для [расширений compose](https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/messaging-extensions). Это использование вызова относится к Microsoft Teams.



