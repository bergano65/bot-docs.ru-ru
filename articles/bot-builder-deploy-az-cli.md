---
title: Развертывание бота | Документация Майкрософт
description: Развертывание бота в облаке Azure.
keywords: deploy bot, azure deploy bot, publish bot
author: ivorb
ms.author: v-ivorb
manager: kamrani
ms.topic: get-started-article
ms.service: bot-service
ms.subservice: abs
ms.date: 04/12/2019
ms.openlocfilehash: 4532fe55705524573de55017e633289255a20ab9
ms.sourcegitcommit: 721bb09f10524b0cb3961d7131966f57501734b8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59508221"
---
# <a name="deploy-your-bot"></a>Развертывание бота

[!INCLUDE [pre-release-label](./includes/pre-release-label.md)]

Завершив создание и локальную проверку бота, его можно развернуть в Azure, чтобы сделать доступным из любого расположения. Развертывание бота в Azure подразумевает оплату за используемые службы. Руководство по [управлению счетами и расходами](https://docs.microsoft.com/en-us/azure/billing/) поможет вам понять, как расшифровывать счета Azure, отслеживать использование и расходы, а также управлять учетными записями и подписками.

В этой статье описано, как развернуть в Azure боты, написанные на C# или JavaScript. Эту статью полезно изучить до выполнения описанных действий, чтобы ознакомиться со всеми процессами, связанными с развертыванием бота.

## <a name="prerequisites"></a>Предварительные требования
- Если у вас еще нет [ подписки Azure](http://portal.azure.com), создайте бесплатную учетную запись Azure, прежде чем начинать работу.
- Бот на [**C#**](./dotnet/bot-builder-dotnet-sdk-quickstart.md) или [**JavaScript**](./javascript/bot-builder-javascript-quickstart.md), разработанный на локальном компьютере.

## <a name="1-prepare-for-deployment"></a>1. Подготовка к развертыванию
Для процесса развертывания требуется целевой бот веб-приложения в Azure, в котором нужно развернуть локальный бот. Целевой бот веб-приложения и подготовленные для него ресурсы в Azure используются локальным ботом для развертывания. Эта необходимость вызвана тем, что у локального бота нет необходимых ресурсов Azure. При создании целевого бота веб-приложения для вас автоматически подготавливаются следующие ресурсы:
-   Бот веб-приложения будет использоваться для развертывания в нем локального бота.
-   План Службы приложений Azure предоставляет необходимые ресурсы для выполнения приложения Службы приложений.
-   Служба приложений для размещения веб-приложений.
-   Учетная запись хранения содержит все объекты данных службы хранилища Azure: большие двоичные объекты, файлы, очереди, таблицы и диски.

Во время создания целевого бота веб-приложения для вас будут созданы идентификатор приложения и пароль. В Azure идентификатор и пароль приложения используются для [проверки подлинности и авторизации в службе](https://docs.microsoft.com/azure/app-service/overview-authentication-authorization). Часть этой информации вы получите для использования в коде локального бота. 

> [!IMPORTANT]
> Язык программирования для шаблона бота, используемого на портале Azure, должен совпадать с языком программирования, на котором написан ваш бот.

Если вы уже создали в Azure нужный бот, новый бот веб-приложения можно не создавать.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Щелкните ссылку **Создание ресурса** в верхнем левом углу окна портала Azure, затем выберите **Искусственный интеллект и машинное обучение > Web App bot** (Бот веб-приложения).
1. Откроется новая колонка с информацией о боте веб-приложения. 
1. В колонке **Служба программ-роботов**  введите необходимые сведения о своем боте.
1. Нажмите кнопку **Создать** для создания службы и развертывания бота в облаке. Это может занять несколько минут.

### <a name="download-the-source-code"></a>Скачивание исходного кода
После создания целевого бота веб-приложения следует скачать код бота с портала Azure на локальный компьютер. Скачать код нужно, чтобы получить ссылки на службы (например, MicrosoftAppID, MicrosoftAppPassword, LUIS или QnA) из файла appsettings.json или .env. 

1. В разделе **Bot Management** (Управление ботами) щелкните **Build** (Выполнить сборку).
1. Щелкните ссылку **Download Bot source code** (Скачивание исходного кода бота) справа.
1. Следуйте инструкциям на экране, чтобы скачать код, а затем распакуйте папку.
    1. [!INCLUDE [download keys snippet](~/includes/snippet-abs-key-download.md)]

### <a name="update-your-local-appsettingsjson-or-env-file"></a>Обновление локальных файлов appsettings.json или .env

Откройте скачанный файл appsettings.json или .env. Скопируйте из файла **все** записи и добавьте их в _локальный_ файл appsettings.json или .env. Устраните все повторяющиеся записи или идентификаторы служб. Сохраните все дополнительные ссылки на службы, от которых зависит ваш бот.

Сохраните файл.

### <a name="update-local-bot-code"></a>Обновление кода локального бота
Обновите локальный файл Startup.cs или index.js, чтобы использовать файл appsettings.json или .env, а не файл .bot. Файл .bot теперь считается нерекомендуемым, и мы продолжаем обновлять шаблоны VSIX, генераторы Yeoman, примеры и другие документы с рекомендацией использовать файл appsettings.json или .env, а не файл .bot. Вам же пока что нужно внести изменения в код бота. 

Обновите код, чтобы считать параметры из файла appsettings.json или .env. 

# <a name="ctabcsharp"></a>[C#](#tab/csharp)
В методе `ConfigureServices` воспользуйтесь предоставляемым ASP.NET Core объектом конфигурации, например: 

**Startup.cs.**
```csharp
var appId = Configuration.GetSection("MicrosoftAppId").Value;
var appPassword = Configuration.GetSection("MicrosoftAppPassword").Value;
options.CredentialProvider = new SimpleCredentialProvider(appId, appPassword);
```

# <a name="jstabjs"></a>[JS](#tab/js)

В JavaScript укажите для файла .env ссылки на объект `process.env`, например:
   
**index.js**

```js
const adapter = new BotFrameworkAdapter({
    appId: process.env.MicrosoftAppId,
    appPassword: process.env.MicrosoftAppPassword
});
```
---

- Сохраните файл и протестируйте бота.

### <a name="setup-a-repository"></a>Настройка репозитория

Чтобы реализовать непрерывное развертывание, создайте репозиторий Git с помощью любого поставщика системы управления версиями Git. Зафиксируйте свой код в репозитории.

Убедитесь, что корень репозитория содержит нужные файлы, которые описаны в разделе [Подготовка репозитория](https://docs.microsoft.com/azure/app-service/deploy-continuous-deployment#prepare-your-repository).

### <a name="update-app-settings-in-azure"></a>Обновление параметров приложения в Azure
Локальный бот не использует зашифрованный файл .bot, но _если_ портал Azure настроен на использование зашифрованного файла .bot. Чтобы решить эту проблему, вы можете удалить строку **botFileSecret** в параметрах бота Azure.
1. Откройте ресурс **Бот веб-приложения** для своего бота на портале Azure.
1. Откройте **параметры приложения** для бота.
1. В окне **Параметры приложения** перейдите к разделу **Параметры приложения**.
1. Проверьте, присутствуют ли в боте записи **botFileSecret** и **botFilePath**. Если присутствуют, удалите их.
1. Сохраните изменения.

## <a name="2-deploy-using-azure-deployment-center"></a>2. Развертывание с помощью центра развертывания Azure

Теперь следует передать код бота в Azure. Следуйте инструкциям в статье [Непрерывное развертывание в Службе приложений Azure](https://docs.microsoft.com/azure/app-service/deploy-continuous-deployment).

Учтите, что сборку рекомендуется выполнять с помощью `App Service Kudu build server`.

После настройки непрерывного развертывания автоматически публикуются все изменения, которые вы фиксируете в репозитории. Но если вы добавите в бот новые службы, придется добавить для них записи в файл .bot.

## <a name="3-test-your-deployment"></a>3. Выполните тестирование развертывания

Подождите несколько секунд после успешного завершения развертывания. Можно также перезапустить веб-приложение, чтобы очистить все кэши. Вернитесь в колонку "Бот веб-приложения" и выполните тестирование с помощью веб-чата на портале Azure.

## <a name="additional-resources"></a>Дополнительные ресурсы
- [Изучение распространенных проблем с непрерывным развертыванием](https://github.com/projectkudu/kudu/wiki/Investigating-continuous-deployment)

