---
title: Общие сведения о диалогах | Документация Майкрософт
description: Сведения об использовании диалогов в пакете SDK Bot Builder для Node.js для моделирования бесед и управления потоком общения.
author: DucVo
ms.author: v-ducvo
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.subservice: sdk
ms.date: 12/13/2017
monikerRange: azure-bot-service-3.0
ms.openlocfilehash: 78f1660aaa91888655515d3402c8ad7702a5b6f6
ms.sourcegitcommit: b78fe3d8dd604c4f7233740658a229e85b8535dd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/24/2018
ms.locfileid: "49997131"
---
# <a name="dialogs-in-the-bot-builder-sdk-for-nodejs"></a>Диалоги в пакете SDK Bot Builder для Node.js

[!INCLUDE [pre-release-label](../includes/pre-release-label-v3.md)]

> [!div class="op_single_selector"]
> - [.NET](../dotnet/bot-builder-dotnet-dialogs.md)
> - [Node.js](../nodejs/bot-builder-nodejs-dialog-overview.md)

Диалоги в пакете SDK Bot Builder для Node.js позволяют моделировать беседы и управлять потоком общения. Бот взаимодействует с пользователем через беседу. Беседы организованы в диалоги. Диалоги могут содержать каскадные действия и запросы. Когда пользователь взаимодействует с ботом, бот будет запускать, останавливать различные диалоги и переключаться между ними в ответ на сообщения пользователя. Понимание того, как работают диалоги, является ключом к успешному проектированию и созданию полезных ботов. 

В этой статье рассматриваются основные понятия диалога. После прочтения этой статьи перейдите по ссылкам в разделе [Дополнительная информация](#next-steps), чтобы глубже изучить эти понятия.

## <a name="conversations-through-dialogs"></a>Беседа с помощью диалога

Пакет SDK Bot Builder для Node.js определяет беседу, как обмен данными между ботом и пользователем через один или несколько диалогов. Диалог на самом базовом уровне представляет собой многократно используемый модуль, который выполняет операцию или собирает информацию от пользователя. Вы можете инкапсулировать сложную логику бота в многократно используемый код диалога.

Беседа может быть структурирована и изменяться несколькими способами.

- Она может исходить из [диалога по умолчанию](#default-dialog).
- Она может быть перенаправлена из одного диалога в другой.
- Ее можно возобновить.
- Она может следовать [каскадному](bot-builder-nodejs-dialog-waterfall.md) шаблону, который проводит пользователя через последовательность шагов или [запросов](bot-builder-nodejs-dialog-prompt.md), предлагая пользователю ответить на ряд вопросов.
- Она может использовать [действия](bot-builder-nodejs-dialog-actions.md), которые прослушивают слова или фразы, активирующие другой диалог. 

Вы можете представить беседу в виде родительского объекта для диалога. Таким образом, беседа содержит *стек диалогов* и обслуживает собственный набор данных о состоянии, а именно `conversationData` и `privateConversationData`. С другой стороны, диалог поддерживает `dialogData`. Дополнительные сведения о данных состояния см. в статье [Управление данными состояния](bot-builder-nodejs-state.md).

## <a name="dialog-stack"></a>Стек диалоговых окон

Бот взаимодействует с пользователем через ряд диалогов, которые поддерживаются в стеке диалога. Диалоги отправляются и извлекаются из стека в ходе беседы. Стек работает, как обычный стек LIFO. Это означает, что последний добавленный диалог будет завершаться первым. По завершении диалога управление возвращается к предыдущему диалогу в стеке.

Стек диалогов пуст, когда начинается беседа с ботом или по завершении беседы. На этом этапе, когда пользователь отправляет сообщение боту, бот ответит *диалогом по умолчанию*.

## <a name="default-dialog"></a>Диалог по умолчанию

Перед Bot Framework версии 3.5 *корневой* диалог определялся добавлением диалога с именем `/`, что привело к тому, что соглашения об именовании бесед такие же, как и у URL-адресов. Это соглашение об именовании оказалось неподходящим для диалогов. 

> [!NOTE]
> Начиная с версии 3.5 Bot Framework, *диалог по умолчанию* зарегистрирован в качестве второго параметра в конструкторе [`UniversalBot`](https://docs.botframework.com/en-us/node/builder/chat-reference/classes/_botbuilder_d_.universalbot.html#constructor).  

В следующем фрагменте кода показано, как определять диалог по умолчанию при создании объекта `UniversalBot`.

```javascript
var bot = new builder.UniversalBot(connector, [
    //...Default dialog waterfall steps...
    ]);
```

Диалог по умолчанию запускается каждый раз, когда стек диалогов пуст и нет другого диалога, [запущенного](bot-builder-nodejs-dialog-actions.md) с помощью LUIS или другого [распознавателя](bot-builder-nodejs-recognize-intent-messages.md). Так как диалог по умолчанию является первым ответом бота пользователю, он должен предоставлять пользователю некоторые контекстные сведения, например список доступных команд или обзор возможностей бота.

## <a name="dialog-handlers"></a>Обработчики диалога

Обработчик диалога управляет потоком беседы. Чтобы продвигаться через беседу, обработчик диалога направляет поток, запуская и завершая диалоги. 

## <a name="starting-and-ending-dialogs"></a>Запуск и завершение диалога

Чтобы запустить новый диалог (и поместить его в стек), используйте [`session.beginDialog()`](http://docs.botframework.com/en-us/node/builder/chat-reference/classes/_botbuilder_d_.session#begindialog). Чтобы завершить диалог (и удалить его из стека, возвращая управление вызывающему диалогу), используйте либо [`session.endDialog()`](http://docs.botframework.com/en-us/node/builder/chat-reference/classes/_botbuilder_d_.session#enddialog), либо [`session.endDialogWithResult()`](http://docs.botframework.com/en-us/node/builder/chat-reference/classes/_botbuilder_d_.session#enddialogwithresult). 

## <a name="using-waterfalls-and-prompts"></a>Использование каскадов и запросов

[Каскад](bot-builder-nodejs-dialog-waterfall.md) — простой способ для моделирования потока беседы и управления им. Каскад содержит последовательность шагов. На каждом шаге можно либо завершить действие от имени пользователя, либо [запросить](bot-builder-nodejs-dialog-prompt.md) сведения у пользователя.

Каскад реализуется с помощью диалога, который состоит из набора функций. Каждая функция определяет шаг каскада. В следующем примере кода показана простая беседа, использующая двухэтапный каскад, который запрашивает у пользователя имя и приветствует его по имени.

```javascript
// Ask the user for their name and greet them by name.
bot.dialog('greetings', [
    function (session) {
        builder.Prompts.text(session, 'Hi! What is your name?');
    },
    function (session, results) {
        session.endDialog(`Hello ${results.response}!`);
    }
]);
```

Когда бот заканчивает каскад, не заканчивая диалог, следующее сообщение пользователя перезапустит диалог с первого этапа каскада. Это может привести к неудобствам, так как пользователь оказывается в замкнутом круге. Чтобы избежать такой ситуации, когда беседа или диалог подошел к концу, рекомендуется явный вызов `endDialog`, `endDialogWithResult` или `endConversation`.

## <a name="next-steps"></a>Дополнительная информация

Чтобы глубже изучить диалоги, важно понять, как работает каскадный шаблон и как его использовать, чтобы направлять пользователей через процесс.

> [!div class="nextstepaction"]
> [Определение шагов диалога с помощью каскадов](bot-builder-nodejs-dialog-waterfall.md)
