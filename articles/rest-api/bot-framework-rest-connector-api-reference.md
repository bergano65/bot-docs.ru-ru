---
title: Справочник по API | Документация Майкрософт
description: Дополнительные сведения о заголовках, операциях, объектах и ошибках в службах Bot Connector и Состояние бота.
author: ivorb
ms.author: kamrani
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.date: 08/02/2019
ms.openlocfilehash: 5a520c2fc5b9e94976e9a2618286aa184045bdeb
ms.sourcegitcommit: 6a83b2c8ab2902121e8ee9531a7aa2d85b827396
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/09/2019
ms.locfileid: "68866632"
---
# <a name="api-reference"></a>Справочник по API

> [!NOTE]
> REST API не является эквивалентом пакета SDK. REST API позволяет установить стандартную связь REST, однако предпочтительный способ взаимодействия с Bot Framework — это SDK. 

На платформе Bot Framework есть служба Bot Connector, которая позволяет боту обмениваться сообщениями с каналами, настроенными на портале Bot Framework. Эта служба использует стандартные отраслевые протоколы REST и JSON через HTTPS.

## <a name="base-uri"></a>Базовый универсальный код ресурса

Когда пользователь отправляет сообщение боту, входящий запрос содержит объект [Activity](#bot-framework-activity-schema) со свойством `serviceUrl`, которое указывает конечную точку, в которую бот должен отправить ответ. Для доступа к службе Bot Connector используйте значение `serviceUrl` как базовый URI для запросов API. 

Например, предположим, что бот получает следующее действие, когда пользователь отправляет сообщение боту.

```json
{
    "type": "message",
    "id": "bf3cc9a2f5de...",
    "timestamp": "2016-10-19T20:17:52.2891902Z",
    "serviceUrl": "https://smba.trafficmanager.net/apis",
    "channelId": "channel's name/id",
    "from": {
        "id": "1234abcd",
        "name": "user's name"
    },
    "conversation": {
        "id": "abcd1234",
        "name": "conversation's name"
    },
    "recipient": {
        "id": "12345678",
        "name": "bot's name"
    },
    "text": "Haircut on Saturday"
}
```

Свойство `serviceUrl` в сообщении пользователя указывает, что боту следует отправить ответ в конечную точку `https://smba.trafficmanager.net/apis`. Это будет базовым URI для последующих запросов, которые бот будет выдавать в рамках этого общения. Если боту будет необходимо отправить пользователю упреждающее сообщение, не забудьте сохранить значение `serviceUrl`.

В следующем примере показан запрос, который бот выдает в ответ на сообщение пользователя. 

```http
POST https://smba.trafficmanager.net/apis/v3/conversations/abcd1234/activities/bf3cc9a2f5de... 
Authorization: Bearer eyJhbGciOiJIUzI1Ni...
Content-Type: application/json
```

```json
{
    "type": "message",
    "from": {
        "id": "12345678",
        "name": "bot's name"
    },
    "conversation": {
        "id": "abcd1234",
        "name": "conversation's name"
    },
   "recipient": {
        "id": "1234abcd",
        "name": "user's name"
    },
    "text": "I have several times available on Saturday!",
    "replyToId": "bf3cc9a2f5de..."
}
```

## <a name="headers"></a>Заголовки

### <a name="request-headers"></a>Заголовки запросов

Помимо стандартных заголовков HTTP-запроса каждый выдаваемый запрос API должен включать заголовок `Authorization`, который указывает маркер доступа для проверки подлинности бота. Укажите заголовок `Authorization`, используя следующий формат.

```http
Authorization: Bearer ACCESS_TOKEN
```

Дополнительные сведения о том, как получить маркер доступа для бота, см. в разделе [Authenticate requests from your bot to the Bot Connector service](bot-framework-rest-connector-authentication.md#bot-to-connector) (Проверка подлинности запросов от бота в службу Bot Connector).

### <a name="response-headers"></a>Заголовки ответов

Помимо стандартных заголовков HTTP-ответа каждый ответ будет содержать заголовок `X-Correlating-OperationId`. Значение этого заголовка — это идентификатор, который соответствует записи журнала Bot Framework, содержащей сведения о запросе. Когда появляется сообщение об ошибке, следует фиксировать значение этого заголовка. Если вы не можете самостоятельно устранить проблему, при отправке сообщения об ошибке включите это значение в сведения, предоставляемые в службу поддержки.

## <a name="http-status-codes"></a>Коды состояния HTTP

<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">Код состояния HTTP</a>, который возвращается с каждым ответом, указывает результат соответствующего запроса. 

| HTTP status code (Код состояния HTTP) | Значение |
|----|----|
| 200 | Запрос выполнен успешно. |
| 201 | Запрос выполнен успешно. |
| 202 | Запрос принят для обработки. |
| 204 | Запрос успешно выполнен, но содержимое не было возвращено. |
| 400 | Запрос неправильный или имеет недопустимый формат. |
| 401 | Бот не авторизован для выполнения запроса. |
| 403 | Бот не допускается к выполнению запрошенной операции. |
| 404 | Запрошенный ресурс не найден. |
| 500 | Произошла внутренняя ошибка сервера. |
| 503 | Служба недоступна. |

### <a name="errors"></a>Errors

Любой ответ, указывающий код состояния HTTP в диапазоне 4xx или 5xx, будет содержать в тексте ответа объект [ErrorResponse](#bot-framework-activity-schema), который предоставляет сведения об ошибке. Если появится сообщение об ошибке в диапазоне 4xx, проверьте объект **ErrorResponse**, чтобы определить причину ошибки и решить проблему, прежде чем повторно отправлять запрос.

## <a name="conversation-operations"></a>Операции общения 
Используйте следующие операции для создания общения, отправки сообщений (действий) и управления содержимым общения.

| Операция | ОПИСАНИЕ |
|----|----|
| [Создать общение](#create-conversation) | Создает новое общение. |
| [Отправить в общение](#send-to-conversation) | Отправляет действие (сообщение) в конец указанного общения. |
| [Ответить на действие](#reply-to-activity) | Отправляет действие (сообщение) в указанное общение как ответ на указанное действие. |
| [Получить диалоги](#get-conversations) | Получает список диалогов, в которых бот принимал участие. |
| [Получить участников общения](#get-conversation-members) | Возвращает участников указанного общения. |
| [Получение участников беседы по страницам](#get-conversation-paged-members) | Возвращает участников указанной беседы по одной странице за раз. |
| [Получить участников действия](#get-activity-members) | Возвращает участников указанного действия в указанном общении. |
| [Обновить действие](#update-activity) | Обновляет существующее действие. |
| [Удалить действие](#delete-activity) | Удаляет существующее действие. |
| [Удалить участника диалога](#delete-conversation-member) | Удаляет участника из диалога. |
| [Отправить журнал бесед](#send-conversation-history) | Отправляет расшифровку последних действий в диалог. |
| [Отправить вложение на канал](#upload-attachment-to-channel) | Передает вложение непосредственно в хранилище BLOB-объектов канала. |

### <a name="create-conversation"></a>Создать общение
Создает новое общение.
```http 
POST /v3/conversations
```

| | |
|----|----|
| **Текст запроса** | Объект `ConversationParameters` |
| **Возвращает** | Объект `ConversationResourceResponse` |

### <a name="send-to-conversation"></a>Отправить в общение
Отправляет действие (сообщение) в указанное общение. Действие будет добавлено в конец общения в соответствии с меткой времени или семантикой канала. Чтобы ответить на конкретное сообщение внутри общения, вместо этого используйте [Ответить на действие](#reply-to-activity).
```http
POST /v3/conversations/{conversationId}/activities
```

| | |
|----|----|
| **Текст запроса** | Объект [Activity](#bot-framework-activity-schema) |
| **Возвращает** | Объект [Identification](#bot-framework-activity-schema) | 

### <a name="reply-to-activity"></a>Ответить на действие
Отправляет действие (сообщение) в указанное общение как ответ на указанное действие. Действие добавляется в качестве ответа на другое действие, если канал это поддерживает. Если канал не поддерживает вложенные ответы, то эта операция ведет себя как [Отправить в общение](#send-to-conversation).
```http
POST /v3/conversations/{conversationId}/activities/{activityId}
```

| | |
|----|----|
| **Текст запроса** | Объект [Activity](#bot-framework-activity-schema) |
| **Возвращает** | Объект [Identification](#bot-framework-activity-schema) | 

### <a name="get-conversations"></a>Получить диалоги
Получает список диалогов, в которых бот принимал участие.
```http
GET /v3/conversations?continuationToken={continuationToken}
```

| | |
|----|----|
| **Текст запроса** | Недоступно |
| **Возвращает** | Объект [ConversationsResult](#bot-framework-activity-schema) | 

### <a name="get-conversation-members"></a>Получить участников общения
Возвращает участников указанного общения.
```http
GET /v3/conversations/{conversationId}/members
```

| | |
|----|----|
| **Текст запроса** | Недоступно |
| **Возвращает** | Массив объектов [ChannelAccount](#bot-framework-activity-schema) | 

### <a name="get-conversation-paged-members"></a>Получение участников беседы по страницам
Возвращает участников указанной беседы по одной странице за раз.
```http
GET /v3/conversations/{conversationId}/pagedmembers?pageSize={pageSize}&continuationToken={continuationToken}
```

| | |
|----|----|
| **Текст запроса** | Недоступно |
| **Возвращает** | Массив объектов [ChannelAccount](#bot-framework-activity-schema) и маркер продолжения, с помощью которого можно получить другие значения. |

### <a name="get-activity-members"></a>Получить участников действия
Возвращает участников указанного действия в указанном общении.
```http
GET /v3/conversations/{conversationId}/activities/{activityId}/members
```

| | |
|----|----|
| **Текст запроса** | Недоступно |
| **Возвращает** | Массив объектов [ChannelAccount](#bot-framework-activity-schema) | 

### <a name="update-activity"></a>Обновить действие
Некоторые каналы позволяют изменить существующее действие, чтобы отразить новое состояние общения бота. Например, можно удалять кнопки из сообщения в общении после того, как пользователь нажмет одну из кнопок. При успешном выполнении эта операция обновляет указанное действие в рамках указанного общения. 
```http
PUT /v3/conversations/{conversationId}/activities/{activityId}
```

| | |
|----|----|
| **Текст запроса** | Объект [Activity](#bot-framework-activity-schema) |
| **Возвращает** | Объект [Identification](#bot-framework-activity-schema) | 

### <a name="delete-activity"></a>Удалить действие
Некоторые каналы позволяют удалить существующее действие. При успешном выполнении эта операция удаляет указанное действие из указанного общения.
```http
DELETE /v3/conversations/{conversationId}/activities/{activityId}
```

| | |
|----|----|
| **Текст запроса** | Недоступно |
| **Возвращает** | Код состояния HTTP, который указывает результат операции. В тексте ответа ничего не указано. | 

### <a name="delete-conversation-member"></a>Удалить участника диалога
Удаляет участника из диалога. Если этот участник был последним в диалоге, диалог также будет удален.
```http
DELETE /v3/conversations/{conversationId}/members/{memberId}
```

| | |
|----|----|
| **Текст запроса** | Недоступно |
| **Возвращает** | Код состояния HTTP, который указывает результат операции. В тексте ответа ничего не указано. | 

### <a name="send-conversation-history"></a>Отправить журнал бесед
Отправляет расшифровку последних действий в диалог, поэтому клиент может преобразовать их для просмотра.
```http
POST /v3/conversations/{conversationId}/activities/history
```

| | |
|----|----|
| **Текст запроса** | Объект [Transcript](#bot-framework-activity-schema). |
| **Возвращает** | Объект [ResourceResponse](#bot-framework-activity-schema). | 

### <a name="upload-attachment-to-channel"></a>Отправить вложение на канал
Передает вложение указанного общения непосредственно в хранилище BLOB-объектов канала. Это позволяет хранить данные в соответствующем хранилище.
```http 
POST /v3/conversations/{conversationId}/attachments
```

| | |
|----|----|
| **Текст запроса** | Объект [AttachmentUpload](#bot-framework-activity-schema). |
| **Возвращает** | Объект [ResourceResponse](#bot-framework-activity-schema). Свойство **id** указывает идентификатор вложения, который может использоваться с операциями [Получить сведения о вложениях](#get-attachment-info) и [Получить вложение](#get-attachment). | 

## <a name="attachment-operations"></a>Операции вложения 
Используйте следующие операции для получения сведений о вложениях и двоичных данных для самого файла.

| Операция | ОПИСАНИЕ |
|----|----|
| [Получить сведения о вложениях](#get-attachment-info) | Получает сведения об указанном вложении, включая имя файла, тип файла и список доступных представлений (например, исходные или эскиз). |
| [Получить вложение](#get-attachment) | Получает указанное представление указанного вложения как двоичное содержимое. | 

### <a name="get-attachment-info"></a>Получить сведения о вложениях 
Получает сведения об указанном вложении, включая имя файла, тип и список доступных представлений (например, исходные или эскиз).
```http
GET /v3/attachments/{attachmentId}
```

| | |
|----|----|
| **Текст запроса** | Недоступно |
| **Возвращает** | Объект [AttachmentInfo](#bot-framework-activity-schema) | 

### <a name="get-attachment"></a>Получить вложение
Получает указанное представление указанного вложения как двоичное содержимое.
```http
GET /v3/attachments/{attachmentId}/views/{viewId}
```

| | |
|----|----|
| **Текст запроса** | Недоступно |
| **Возвращает** | Двоичное содержимое, отображающее указанное представление указанного вложения | 

## <a name="state-operations"></a>Операции состояния
Служба состояний Microsoft Bot Framework устарела с 30 марта 2018 г. Ранее боты, созданные на основе службы Azure Bot или пакета SDK для Bot Builder, по умолчанию использовали подключение к этой службе, размещенной корпорацией Майкрософт, для хранения данных о состоянии бота. Теперь эти боты нужно обновить, чтобы они использовали собственное хранилище состояний.

| Операция | ОПИСАНИЕ |
|----|----|
| `Set User Data` | Сохраняет данные состояния для конкретного пользователя на канале. |
| `Set Conversation Data` | Сохраняет данные состояния для конкретного общения на канале. |
| `Set Private Conversation Data` | Сохраняет данные состояния для конкретного пользователя в контексте указанного общения на канале. |
| `Get User Data` | Извлекает данные состояния, сохраненные ранее для конкретного пользователя во всех сеансах общения на канале. |
| `Get Conversation Data` | Извлекает данные состояния, сохраненные ранее для конкретного общения на канале. |
| `Get Private Conversation Data` | Извлекает данные состояния, сохраненные ранее для конкретного пользователя в контексте указанного общения на канале. |
| `Delete State For User` | Удаляет данные состояния, сохраненные ранее для конкретного пользователя. |

## <a name="bot-framework-activity-schema"></a>Схема действия в Bot Framework

В описании [схемы действия Bot Framework](https://aka.ms/botSpecs-activitySchema) содержатся объекты и свойства, которые может использовать бот для взаимодействия с пользователем.
