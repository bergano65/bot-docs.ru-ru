---
title: Руководство по использованию идентификаторов в Bot Framework | Документы Майкрософт
description: В этом руководстве описываются характеристики полей идентификаторов в протоколе Bot Framework версии 3.
keywords: идентификатор, боты, протокол
author: RobStand
ms.author: kamrani
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.date: 04/30/2019
ms.openlocfilehash: 8a9fa38a579bbe083f960caf5f600a1c5842045e
ms.sourcegitcommit: a6d02ec4738e7fc90b7108934740e9077667f3c5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/04/2019
ms.locfileid: "70298629"
---
# <a name="id-fields-in-the-bot-framework"></a>Поля идентификаторов в Bot Framework

В этом руководстве описываются характеристики полей идентификаторов в Bot Framework.

## <a name="channel-id"></a>Идентификатор канала

У каждого канала Bot Framework есть уникальный идентификатор.

Пример: `"channelId": "skype"`

Идентификаторы канала используются в качестве пространств имен для других идентификаторов. Вызовы среды выполнения в протоколе Bot Framework должны осуществляться в контексте канала; канал предоставляет значение разговора и идентификаторы учетных записей, используемых во время обмена.

По соглашению для идентификаторов канала используются символы нижнего регистра. Каналы обеспечивают постоянный регистр символов в идентификаторах каналов. Поэтому боты могут использовать операции сравнения на равенство с целью выявления соответствия.

### <a name="rules-for-channel-ids"></a>Правила для идентификаторов канала

- В идентификаторах каналов учитывается регистр символов.

## <a name="bot-handle"></a>Дескриптор бота

У каждого бота, зарегистрированного в службе Azure Bot, есть дескриптор бота.

Пример: `FooBot`

Дескриптор бота представляет регистрацию бота в подключенной к Интернету службе Azure Bot. Эта регистрация связана с конечной точкой веб-перехватчика HTTP и с регистрацией в каналах.

Служба Azure Bot гарантирует уникальность дескрипторов ботов. Портал Azure выполняет проверку уникальности без учета регистра (это означает, что варианты дескриптора, отличающиеся только регистром символов, рассматриваются как один и тот же дескриптор). Это характеристика портала Azure, и она не обязательно применима к самому дескриптору бота.

### <a name="rules-for-bot-handles"></a>Правила использования дескрипторов ботов

* Дескрипторы ботов являются уникальными (без учета регистра) на платформе Bot Framework.

## <a name="app-id"></a>Идентификатор приложения API.

У каждого бота, зарегистрированного в службе Azure Bot, есть идентификатор приложения.

> [!NOTE]
> Ранее приложения часто назывались "Приложениями MSA" или "Приложениями MSA/AAD". Теперь приложения часто называются просто "приложениями", но в некоторых элементах протокола приложения могут называться "Приложениями MSA".

Пример: `"msaAppId": "353826a6-4557-45f8-8d88-6aa0526b8f77"`

Приложение представляет регистрацию в группе удостоверений портала приложения и используется в качестве механизма идентификации между службами в протоколе среды выполнения Bot Framework. У приложений могут быть другие ассоциации, не связанные с ботами, например веб-сайты или мобильные и классические приложения.

У каждого зарегистрированного бота есть ровно одно приложение. Несмотря на то, что владелец бота не может самостоятельно изменить приложение, связанное с ботом, специалисты службы поддержки Bot Framework могут сделать это в небольшом количестве исключительных случаев.

Боты и каналы могут использовать идентификаторы приложений для уникальной идентификации зарегистрированных ботов.

Идентификаторы приложений гарантированно являются глобально уникальными. Все идентификаторы приложений должны сравниваться без учета регистра.

### <a name="rules-for-app-ids"></a>Правила для идентификаторов приложений

* Идентификаторы приложений являются уникальными (и должны сравниваться как глобальные уникальные идентификаторы) в рамках платформы приложений Майкрософт.
* У каждого бота есть ровно одно соответствующее приложение.
* Для изменения приложения, с которым связан бот, требуется обращение в службу поддержки Bot Framework.

## <a name="channel-account"></a>Учетная запись канала

У каждого бота и пользователя есть учетная запись в каждом канале. Учетная запись содержит идентификатор (`id`) и другие информативные, но неструктурированные данные, например дополнительное имя.

Пример: `"from": { "id": "john.doe@contoso.com", "name": "John Doe" }`

Эта учетная запись описывает адрес в канале, используемый для отправки и получения сообщений. В некоторых случаях эти операции регистрации выполняются в одной службе (например, в Skype или Facebook). В других случаях они находятся в нескольких системах (адреса электронной почты, номера телефонов). В более анонимных каналах (например, веб-чатах) регистрация может быть временной.

Учетные записи каналов являются вложенными в каналы. Например, учетная запись Facebook представляет собой просто число. Это число может иметь другое значение в других каналах и может не иметь смысла вне каналов.

Связь между канала учетными записями канала и пользователями (людьми) зависит от соглашений, связанных с каждым каналом. Например, номер для SMS-сообщения обычно связан с одним человеком в течение какого-то времени. По истечении этого периода времени номер может быть передан другому пользователю. И наоборот, учетная запись Facebook обычно навсегда связывается с одним пользователем, хотя одна учетная запись часто может использоваться двумя пользователями.

Для большинства каналов рекомендуется считать учетную запись канала своего рода почтовым ящиком, в который доставляются сообщения. Обычно большинство каналов позволяют сопоставить несколько адресов с одним адресом электронной почты, например, "jdoe@contoso.com" и "john.doe@service.contoso.com" могут представлять один и тот же адрес электронной почты. Некоторые каналы идут немного дальше и изменяют адрес учетной записи в зависимости от того, какие боты обращаются к этому каналу, например, Skype и Facebook изменяют идентификаторы пользователей таким образом, что у каждого бота есть собственный адрес для приема и отправки сообщений, отличающийся от других адресов.

Хотя иногда можно установить соответствие адресов, для установки соответствия адресов электронной почты и пользователей необходимо знание соглашений, действующих внутри канала, и во многих случаях это невозможно.

Бот получает адрес учетной записи канала с помощью поля `recipient` в действиях, отправляемых боту.

### <a name="rules-for-channel-accounts"></a>Правила для учетных записей каналов

* Учетные записи канала имеют значение только в соответствующих каналах.
* Несколько идентификаторов могут представлять одну и ту же учетную запись.
* Для проверки идентификаторов на равенство можно использовать порядковое сравнение.
* Выполнить сравнение, с помощью которого можно определить, что два разных идентификатора представляют одну и ту же учетную запись, один и тот же бот или одного и того же человека, обычно невозможно.
* Устойчивость ассоциаций между идентификаторами, учетными записями, адресами электронной почты и пользователями зависит от канала.

## <a name="conversation-id"></a>Идентификатор разговора

Отправка и получение сообщений происходит в контексте разговора, который определяется по идентификатору.

Пример: `"conversation": { "id": "1234" }`

Разговор включает обмен сообщениями и другие действия. Каждый разговор может содержать одно или несколько действий, и каждое действие появляется только в одном разговоре. Разговоры могут быть бессрочными или иметь четкое начало и конец. Процесс создания, изменения и завершения диалога происходит в канале (т. е. разговор происходит только тогда, когда канал знает об этом), и характеристики этих процессов устанавливаются каналом.

Действия в беседе отправляются пользователями и ботами. Определение "участников" разговора различается в зависимости от канала. К участникам разговора могут относиться пользователи, присутствующие в канале, пользователи, которые когда-либо получали сообщение, и пользователи, которые отправили сообщение.

Некоторые каналы (например, SMS, Skype и некоторые другие) имеют особенность, которая состоит в том, что идентификатор канала, который назначается для разговора один на один, является идентификатором учетной записи удаленного канала. У этой особенности есть два побочных эффекта:
1. Идентификатор разговора является субъективным и зависит от того, кто просматривает его. В разговоре участников A и B участник A видит идентификатор разговора "B", а участник B — идентификатор разговора "A".
2. Если у бота есть несколько учетных записей канала в этом канале (например, у бота есть два номера для SMS-сообщений), то идентификатора разговора недостаточно для уникальной идентификации разговора с точки зрения бота.

Таким образом, идентификатор разговора необязательно идентифицирует конкретный разговор в канале даже для одного бота.

### <a name="rules-for-conversation-ids"></a>Правила для идентификаторов разговора

* Разговоры имеют значение только в соответствующих каналах.
* Несколько идентификаторов могут представлять один и тот же разговор.
* Порядковое сравнение на равенство не гарантирует, что два идентификатора разговора принадлежат одному и тому же разговору, хотя в большинстве случаев это так.

## <a name="activity-id"></a>Идентификатор действия

Отправка и получение действий осуществляется по протоколу Bot Framework, и часто действия можно определить.

Пример: `"id": "5678"`

Идентификаторы действий являются необязательными и используются в каналах для того, чтобы бот мог сослаться на идентификатор в последующих вызовах API, если они доступны:
* Ответ на определенное действие
* Запрос списка участников на уровне действия

Поскольку другие варианты использования не предусмотрены, дополнительные правила обращения с идентификаторами действий отсутствуют.
