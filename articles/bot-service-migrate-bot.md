---
title: Миграция ботов в Azure | Документы Майкрософт
description: Узнайте, как перенести бот с устаревшего портала Bot Framework в службу ботов на портале Azure.
author: v-ducvo
ms.author: kamrani
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.date: 3/22/2019
monikerRange: azure-bot-service-3.0
ms.openlocfilehash: c4b058ecc4f6a01d51d3aa7abe8f4f926df4e771
ms.sourcegitcommit: a547192effb705e4c7d82efc16f98068c5ba218b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75491354"
---
# <a name="migrate-your-bot-to-azure"></a>Миграция ботов в Azure

Все боты **службы Azure Bot (предварительная версия)** , созданные на [портале Bot Framework](http://dev.botframework.com), необходимо перенести в новую службу Azure Bot. Служба стала общедоступной (GA) в декабре 2017 г. 

Учтите, что перенос *не* требуется для ботов регистрации, подключенных только к следующим каналам: **Teams**, **Skype** или **Кортана**. Например, для бота регистрации, подключенного к **Facebook** и **Skype**, *требуется* миграция. Но для бота регистрации, подключенного к **Skype** и **Кортане**, миграция *не требуется*.

> [!IMPORTANT]
> Перед перемещением бота функций, созданного с помощью Node.js, необходимо использовать **пакет функций Azure**, чтобы упаковать модули **node_modules** вместе. Это позволит повысить производительность во время миграции и при работе бота функций после нее. Сведения об упаковке модулей см. в разделе [Упаковка бота функций с помощью Funcpack](#package-a-functions-bot-with-funcpack).

Чтобы переместить бот, выполните следующие действия.

1. Войдите на [портал Bot Framework](http://dev.botframework.com) и нажмите кнопку **Мои боты**.
2. Нажмите кнопку **Перенести** для бота, который требуется перенести.
3. Примите **условия** и нажмите кнопку **Перенести** для запуска процесса миграции или **Отменить** для отмены действия.

> [!IMPORTANT]
> В ходе миграции не обновляйте страницу и не уходите с нее. Это может привести к преждевременной остановке процесса миграции, и вам придется выполнять миграцию заново. Чтобы убедиться, что миграция была завершена успешно, дождитесь сообщения с подтверждением.

После успешного завершения миграции в поле **Состояние миграции** будет указано, что бот перенесен, и кнопка **Откат миграции** будет доступна в течение одной недели со дня миграции на случай возникновения проблем.

Щелкните имя перенесенного бота, и он откроется на [портале Azure](https://portal.azure.com).

## <a name="package-a-functions-bot-with-funcpack"></a>Упаковка бота функций с помощью Funcpack

Боты функций, созданные с помощью Node.js, перед миграцией должны быть упакованы с помощью [Funcpack](https://github.com/Azure/azure-functions-pack). Чтобы упаковать бот с помощью Funcpack, выполните следующие действия.

1.  [Скачайте](bot-service-build-download-source-code.md) код в локальную систему, если у вас его еще нет.
2.  Обновите все пакеты npm в **packages.json** до последних версий, а затем запустите `npm install`.
3.  Откройте **messages/index.js** и смените `module.exports = { default: connector.listen() }` на `module.exports = connector.listen();`.
4.  Установите Funcpack с помощью npm: `npm install -g azure-functions-pack`
5.  Чтобы упаковать каталог **node_modules**, выполните следующую команду: `funcpack pack ./`
6.  Протестируйте бот в локальной среде, запустив бот функций с помощью эмулятора Bot Framework. Дополнительные сведения о запуске бота *funcpack* см. [здесь](https://github.com/Azure/azure-functions-pack#how-to-run). 
7.  Отправьте код обратно в Azure. Убедитесь, что каталог `.funcpack` отправлен. Отправлять каталог **node_modules** не нужно.
8. Протестируйте удаленный бот и убедитесь, что он отвечает должным образом.
9. Выполните перенос бота, как описано выше.

## <a name="migration-under-the-hood"></a>Миграция: взгляд изнутри

В зависимости от типа бота, для которого выполняется миграция, список ниже поможет вам получить более полное представление об этом процессе.

* **Бот веб-приложения** или **Бот функций** — для этих типов ботов проект исходного кода копируется и передается из старого бота в новый. Другие ресурсы, такие как хранилище бота, Application Insights, LUIS и др., остаются без изменений. В этом случае бот содержит копию идентификаторов, ключей и паролей для существующих ресурсов. 
* **Регистрация каналов бота** — для таких ботов при переносе создается новая **регистрация каналов бота** и копируется конечная точка из старого бота. 
* Независимо от типа бота, который вы переносите, процесс миграции ни в коем случае не изменяет состояние существующего бота. Это позволяет выполнить безопасный откат в случае необходимости.
* Если у вас включена функция [непрерывного развертывания](bot-service-build-continuous-deployment.md), потребуется настроить ее снова таким образом, чтобы система управления версиями подключалась к новому боту.

## <a name="understanding-azure-resources-after-migration"></a>Основные сведения о ресурсах Azure после миграции
По окончании миграции **группа ресурсов** будет содержать некоторые ресурсы Azure, которые необходимы для работы бота. Тип и количество ресурсов зависят от типа перенесенного бота. Дополнительные сведения см. в следующих разделах.

### <a name="registration-bot"></a>Бот регистрации

Это самый простой тип ботов. Группа ресурсов в Azure будет содержать только один ресурс типа "Регистрация каналов бота". Это эквивалент предыдущей записи бота на портале разработчика Bot Framework.

![Описания ботов регистрации каналов бота в Azure](~/media/bot-service-migrate-bot/channel-registration-bot.png)

### <a name="web-app-bot"></a>Бот веб-приложения
При миграции бота веб-приложения система подготовит ресурс службы Azure Bot типа "Бот веб-приложения" и новое веб-приложение службы приложений (на снимке экрана ниже обозначено зеленым цветом). Предыдущий бот службы Azure Bot (предварительная версия) все еще будет существовать и может быть удален (на снимке экрана ниже обозначен красным цветом).

![Описания ботов веб-приложений в Azure](~/media/bot-service-migrate-bot/web-app-bot.png)

### <a name="functions-bot"></a>Бот функций
При миграции бота функций система подготовит ресурс службы Azure Bot типа "Бот функций" и новое приложение-функцию службы приложений (на снимке экрана ниже обозначено зеленым цветом). Предыдущий бот службы Azure Bot (предварительная версия) все еще будет существовать и может быть удален (на снимке экрана ниже обозначен красным цветом).

![Описания ботов функций в Azure](~/media/bot-service-migrate-bot/functions-bot.png)


## <a name="roll-back-migration"></a>Откат миграции

Если во время или после миграции возникла проблема с ботом, вы можете выполнить **откат миграции**. Процедура приведена ниже.

1. Войдите на [портал Bot Framework](http://dev.botframework.com) и нажмите кнопку **Мои боты**.
2. Выберите **Откат миграции** для нужного бота. Появится запрос.
3. Нажмите кнопку **Да, откатить** для продолжения или **Отменить** для отмены предыдущего.

> [!NOTE]
> Откат будет доступен в течение одной недели после миграции и должен выполняться, только если возникли проблемы с перенесенными ботами.

## <a name="migration-troubleshootingknown-issues"></a>Устранение неполадок и известные проблемы миграции
Мой бот node.js или бот функций успешно перенесен, но не отвечает.

* **Проверьте конечную точку**
  * Перейдите к колонке **Параметры** в ресурсе бота и убедитесь, что конечная точка бота имеет параметр строки запроса code, и ему назначено значение. В противном случае необходимо его добавить.
* **Проверьте папку секретов в Kudu для резервных копий**
  * Иногда существует сразу несколько файлов секретов резервных копий, которые создают конфликт. Перейдите к папке **home\data\Functions\secrets** в Kudu и удалите все файлы **host.snapshot** (или **host.backup**), которые вы там найдете. Должен быть только один файл **host.json** и **messages.json**. После этого перезапустите службу приложений и повторите попытку беседы с ботом.

Если вы столкнетесь с любой другой проблемой, сообщите об этом в службу поддержки Azure или в [GitHub](https://github.com/MicrosoftDocs/bot-framework-docs/issues).


## <a name="next-steps"></a>Дальнейшие действия

После миграции бота можно приступить к управлению ботом с помощью портала Azure.

> [!div class="nextstepaction"]
> [Управление ботом](bot-service-manage-overview.md)
