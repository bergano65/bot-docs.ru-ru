---
title: Справочные материалы по API для объекта контекста | Документация Майкрософт
description: Узнайте, как создать ссылку на объект контекста в боте конструктора диалогов.
author: vkannan
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 12/13/2017
ROBOTS: NoIndex, NoFollow
ms.openlocfilehash: 5ba70189c16815539524d3c9046da03ed0344b9b
ms.sourcegitcommit: f576981342fb3361216675815714e24281e20ddf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2018
ms.locfileid: "39300975"
---
# <a name="api-reference"></a>Справочник по API
> [!IMPORTANT]
> Конструктор диалогов пока доступен не для всех клиентов. Дополнительные сведения о доступности конструктора диалогов будут опубликованы позже в этом году.

Конструктор диалогов позволяет добавить в бот пользовательскую бизнес-логику. Эти функции скрипта реализуются в редакторе **скриптов**. Функции подключаются в различных частях кода, например в шаблонах логических ответов, *триггерах* или *действиях* задач либо в состояниях диалога. Все эти функции получают объект `context` с типом **[IConversationContext]** в параметрах.

В следующем примере кода показана сигнатура для функции логического ответа с переданным объектом **context**.

```javascript
/**
* @param {IConversationContext} context
*/
module.exports.NewConditionalResponse_onRun = function(context) {
    // Business logic here
    return true; // Returns a boolean
}
```

Используя объект `context`, можно получить доступ к информации о диалоге между пользователем и ботом.

## <a name="script-callback-functions"></a>Функции обратного вызова скрипта

Создаваемые функции обратного вызова пользовательского скрипта могут иметь разные формы. Вы можете присвоить функциям разные имена, но функционально они принимают одну из указанных ниже форм.

| Форма | Параметр | Тип возвращаемого значения | ОПИСАНИЕ |
| ---- | ---- | ---- | ---- |
| Функция, выполняемая до ответа | context | **void** или **promise** | Функция, которая выполняется до получения ответа. |
| Функция процесса | context | **void** или **promise** | Функция, которая реализует бизнес-логику. |
| Функция принятия решений | context | **string** или **promise** | Функция, которая принимает решения на основе бизнес-логики. Возвращаемая строка должна соответствовать условию из блока [decision](conversation-designer-dialogues.md#decision-state). |
| Функция распознавателя кода | context | **boolean** или **promise** | Пользовательская бизнес-логика, которая выполняется при **активации скрипта**. Возвращает значение `true`, чтобы указать на соответствие. В противном случае возвращается `false`, чтобы отменить сопоставление. |
| Функция onRecognize | context | **boolean** или **promise** | Функция, которая выполняется только при наличии совпадения в распознавателе LUIS. Эта функция обратного вызова используется для обработки сущностей LUIS и возврата соответствующего **логического** значения. Возвращает значение `true`, чтобы указать на соответствие. В противном случае возвращается `false`, чтобы отменить сопоставление. |

## <a name="iconversationcontext-interface"></a>Интерфейс IConversationContext

Интерфейс `IConversationContext` позволяет отслеживать сведения о диалоге между пользователем и ботом. Все пользовательские функции, подключаемые с помощью конструктора диалогов, получают объект `context` в качестве аргумента параметра.

## <a name="context-properties"></a>Свойства контекста
Объект `context` предоставляет указанные ниже свойства.

| ИМЯ |  Код | ОПИСАНИЕ |
| ---- | ---- | ---- |
| `request` | `context.request` | Получение объекта запроса, содержащего действие бота.  |
| | `context.request.attachment` | Действие с вложением, которое может содержать адаптивную карточку. |
| | `context.request.text` | Действие с текстом, которое содержит текст входящего сообщения от клиента. |
| | `context.request.speak` | Действие произнесения, которое содержит произносимый текст (при наличии) от клиента. |
| | `context.request.type` | Указывает тип действия (по умолчанию — message). |
| `responses` | `context.responses` | Хранит массив действий, который будет возвращен клиенту при изменении текущего состояния или завершении выполняемого кода. |
| | `context.responses.push` | Добавление действия в ответ. |
| `global` | `context.global` | Объект JavaScript, содержащий определенные вами данные диалога. Этот объект хранится в течение всего диалога. |
| `local` | `context.local` | Объект JavaScript, содержащий определенные вами данные задачи. Этот объект хранится, пока выполняется определенная задача. Намерения, распознанные LUIS, всегда возвращаются в локальный контекст. Чтобы сохранить результаты LUIS, скопируйте их в контекст `context.global`. |
| | `context.local['@description']` | Возвращает необработанные сущности, полученные с помощью LUIS. |
| `sticky` | `context.sticky` | Позволяет указать имя текущей задачи. |
| `currentTemplate` | `context.currentTemplate` | [Шаблон логического ответа](conversation-designer-response-templates.md#conditional-response-templates), который вызывается для оценки отображаемого и произносимого текста. Этот объект содержит три свойства: <br/>1. **name** — имя текущего шаблона. <br/>2. **modalityDisplay** — логическое значение, указывающее на то, что модальность связана с оценкой отображаемого текста. <br/>3. **modalitySpeak** — логическое значение, указывающее на то, что модальность связана с оценкой произносимого текста. |

## <a name="context-methods"></a>Методы объекта контекста
Объект `context` предоставляет следующие методы:

| ИМЯ | Тип возвращаемого значения | Код | ОПИСАНИЕ |
| ---- | ---- | ---- | ---- |
| `getCurrentTurn` | **number** | `context.getCurrentTurn();` | Получение места в очереди, начиная с кадра в верхней части стека, при выполнении повторного запроса. |

## <a name="next-step"></a>Дальнейшие действия
> [!div class="nextstepaction"]
> [Создание бота](conversation-designer-create-bot.md)
