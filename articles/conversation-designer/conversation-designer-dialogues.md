---
title: Определение диалога в качестве действия "Do" (Сделать) | Документация Майкрософт
description: Узнайте, как настроить диалог в качестве действия "Do" (Сделать).
author: vkannan
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 12/13/2017
ROBOTS: NoIndex, NoFollow
ms.openlocfilehash: d59df20821a7f63eb9ee5dea365597b1af839f75
ms.sourcegitcommit: f576981342fb3361216675815714e24281e20ddf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2018
ms.locfileid: "39304946"
---
# <a name="define-a-dialogue-as-a-do-action"></a>Определение диалога в качестве действия "Do" (Сделать)
> [!IMPORTANT]
> Конструктор диалогов пока доступен не для всех клиентов. Дополнительные сведения о доступности конструктора диалогов будут опубликованы позже в этом году.

Диалог охватывает разговорную модель для выполнения конкретной задачи. Например, бот кафе, который помогает пользователям забронировать столик, определяет задачу с именем "Бронирование столика". Действие **Do** (Сделать) будет привязано к диалогу, который моделирует последовательность разговора между ботом и пользователем. 

Диалоги особенно полезны в случаях, когда бот вступает в разговор, предусматривающий обмен репликами с пользователем для выполнения задачи.  Пользователи редко указывают в одной фразе все необходимые значения для выполнения задачи. 

Для бронирования столика требуется указать расположение, количество человек, дату и время. Бот, который бронирует столик, должен воспринимать и обрабатывать различные возможные варианты фраз, которые может сказать пользователь. 

- *забронировать столик*: в этом случае ни одна из необходимых сущностей не указана. Боту необходимо вступить в разговор с пользователем.
- *забронировать столик на 19:00 в эту субботу*: в этом случае указывается дата и время, но боту по-прежнему необходимо узнать предполагаемое расположение и количество человек.

Во время разговора некоторые сущности могут меняться в зависимости от входных данных пользователя. Например, если пользователь говорит "забронировать столик в Редмонде в это воскресенье в 19:00", но Редмонд закрывается в шесть по воскресеньям, диалог бота должен обрабатывать такие недопустимые запросы. 

Конструктор диалогов предусматривает создание диалога путем перетаскивания, что позволяет увидеть последовательность разговора. В конструкторе диалогов представлены семь *состояний диалога*, которые можно использовать для моделирования последовательности разговора.

## <a name="dialogue-states"></a>Состояния диалога

Диалог состоит из состояний диалога. Сам по себе диалог моделируется как структурированная, направленная последовательность, которая предоставляет среде выполнения разговора структуру последовательности разговора.

Диалоги поставляются со множеством встроенных состояний, которыми можно воспользоваться. Ниже приведены поддерживаемые встроенные состояния:

- [**Запуск**](#start-state): представляет начальное состояние для последовательности разговора. Во всех диалогах должно быть определено, по крайней мере, одно начальное состояние.
- [**Возврат**](#return-state): представляет выполнение определенной последовательности разговора. Учитывая, что последовательности разговора являются составными, возврат указывает среде выполнения разговора вернуть выполнение к любому из возможных вызывающих объектов этого диалога.
- [**Решение**](#decision-state): представляет точку ветвления в последовательности разговора.
- [**Процесс**](#process-state): представляет состояние, в котором бот выполняет бизнес-логику.
- [**Запрос**](#prompt-state): представляет состояние, в котором можно ввести запрос ввода данных пользователем. 
- [**Обратная связь**](#feedback-state): представляет состояние, в котором можно предоставить обратную связь или подтверждение пользователю. Например, диалог, подтверждающий бронирование.
- [**Модуль**](#module-state): представляет вызов к другому диалогу. Так как последовательности диалогов составляются по умолчанию, это состояние может вызывать общий диалог или некоторые другие диалоги, как определено в этой задаче.

Все состояния диалога подключены между собой с помощью соединителей диалогов в конструкторе диалогов.

Каждое состояние диалога предусматривает связанный редактор состояния, в котором задаются свойства для этого состояния, включая имена функций обратного вызова для пользовательских скриптов. **Редактор состояний** находится в области изменения размера в нижней части основного окна просмотра конструктора диалогов. Чтобы открыть редактор, дважды щелкните состояние в конструкторе диалогов, и в **редакторе состояния** отобразятся свойства для этого состояния.
<!-- TODO: insert screenshot of the wrench in horizontal menu -->

В следующих подразделах приведены дополнительные сведения о каждом из этих встроенных состояний диалога.

### <a name="start-state"></a>Состояние запуска

Состояние запуска обозначает начальную точку диалога. Требуемое значение — **имя** состояния. Для имени по умолчанию задается значение "Запуск". Его можно изменить, чтобы переименовать это состояние.

### <a name="return-state"></a>Состояние возврата

Состояние возврата представляет выполнение определенной ветви последовательности разговора. Так как диалоги являются составными, состояние также указывает среде выполнения диалога вернуть выполнение в диалог вызывающего объекта. Требуемое значение — **имя** состояния. Для имени по умолчанию задается значение "Возврат". Его можно изменить, чтобы переименовать это состояние.

### <a name="decision-state"></a>Состояние принятия решений

Состояние принятия решений представляет ветвление в последовательности разговора. Чтобы оценить, какую ветвь выбрать, можно написать пользовательский скрипт. На основе входных данных пользователя и бизнес-логики скрипт будет возвращать одно из возможных значений перехода. Каждое значение перехода инициирует в среде выполнения диалога запуск другой ветви диалога.

Обязательные свойства для состояния принятия решений:
- **Имя**: уникальное имя для состояния принятия решений.
- **Код, выполняемый при запуске**: имя функции обратного вызова, которая реализует вашу бизнес-логику, чтобы определить, какую ветвь диалога выбрать. 

#### <a name="example-code-for-decision-state"></a>Пример кода для состояния принятия решений

Приведенный ниже пример функции обратного вызова возвращает решение, которое указывает среде выполнения диалога, какую ветвь необходимо выполнить.

```javascript
module.exports.fnDecisionState = function(context) {
    var a = context.taskEntities['a'];
    if (a[0].value === '0') {
        return 'yes';
    }
    else if (a[0].value === '1') {
        return 'no';
    }
}
```

### <a name="process-state"></a>Состояние процесса

Состояние процесса представляет собой точку в диалоге, где бот продолжает разговор или пытается выполнить действие завершения последней задачи. 

Обязательные свойства для состояния процесса:
- **Имя**: уникальное имя для состояния процесса.
- **Код, выполняемый при запуске**: имя функции обратного вызова, которая реализует бизнес-логику.

#### <a name="example-code-for-process-state"></a>Пример кода для состояния процесса

Приведенный ниже пример функции обратного вызова получает сведения о погоде и возвращает их пользователю.

```javascript
module.exports.fnGetWeather = function(context) {
    var options =  {
        host: 'mock',
        path: '/get?a=b',
        method: 'get'
    };
    return http.request(options).then(function(response) {
        context.contextEntities['x'].value= response.statusCode;
        var jsonBody = JSON.parse(response.body);
          // understand response
        if (response.statusCode != "200") {
            // error
        }
    });
}
```

### <a name="prompt-state"></a>Состояние запроса

Состояние запроса запрашивает у пользователя определенные сведения. Состояния запроса включают в себя систему вложенных диалогов и поэтому по определению являются сложными состояниями. 

В состоянии запроса можно определить фактический ответ, который необходимо предоставить пользователю, и при необходимости включить адаптивную карточку. Затем можно указать триггер для анализа ответа пользователя. Этот триггер может быть LUIS или настраиваемым распознавателем кода с использованием регулярного выражения.  

Если пользователь указал недопустимые входные данные, бот может повторно запросить те же сведения. Это поведение также можно задать в редакторе состояния запроса. 

#### <a name="prompting-the-user"></a>Отправление запроса пользователю

Ответ на запрос позволяет указать сообщение, используемое при **запросе** входных данных пользователя. Например, для сбора сведений о дате и времени возможными ответами могут быть "Когда бы Вы хотели прийти?" или "Когда бы Вы хотели пообедать с нами?"

#### <a name="prompt-listening-for-user-input"></a>Ожидание ввода данных пользователем в ответ на запрос

После того как пользователю предлагается ответить, среда выполнения диалога автоматически прослушивает входные данные пользователя и пытается проанализировать произнесенную речь. Настройте триггер на основе LUIS или настраиваемого распознавателя кода для анализа входных данных и намерения пользователя. Это похоже на триггер задачи.

#### <a name="re-prompting-the-user"></a>Отправка повторного запроса пользователю

Используйте раздел повторного запроса, чтобы указать ответ для каждой попытки. Каждая строка в разделе повторного запроса соответствует строке повторного запроса, используемого для этой определенной очереди. Первый ответ будет использоваться для первого повторного запроса, второй — для второго и т. д. Например: 

*Прошу прощения, я не понял, когда Вы хотели бы прийти?*
*Мне не удалось Вас понять. Давайте попробуем снова. Когда Вы хотите прийти?*

#### <a name="prompt-callback-functions"></a>Функции обратного вызова запроса

В состоянии запроса можно указать две разные функции обратного вызова. 

1. **Перед каждым запросом и повторным запросом.** Выполняйте эту функцию перед каждым запросом или повторным запросом. Эта функция обратного вызова ожидает возвращаемое логическое значение, где значение true означает выполнение этого запроса или повторного запроса, а false означает, что выполнять этот запрос или повторный запрос не нужно. Получить индекс текущей очереди для выполнения этого запроса можно с использованием `getTurnIndex()`.
2. **При ответе на запрос.** Выполняйте эту функцию каждый раз при создании запроса, но перед его отправкой пользователю (это касается ответов и на повторные запросы). Это позволяет скрипту изменять сообщение, отправляемое пользователю.

#### <a name="sample-code"></a>Пример кода

В этом фрагменте кода приведен пример обратного вызова **перед выполнением**.

```javascript
module.exports.fnBeforeExecuting = function(context) {
    if(context.responses[0].text === "C") {
        return false;
    }
    return true;
}
```

В этом фрагменте кода приведен пример обратного вызова **при ответе на запрос**.

```javascript
module.exports.fnOnPrompting = function(context) {
    // include a hint card
    var activity = context.responses.slice(-1).pop();
    activity.attachments.push({
        "contentType": "application/vnd.microsoft.card.hero",
        "content": {
            "buttons": [
                {
                    "type": "imBack",
                    "title": "1",
                    "value": "1"
                },
                {
                    "type": "imBack",
                    "title": "2",
                    "value": "2"
                }
            ]
        }
    });
}
```

В этом фрагменте кода приведен пример обратного вызова **перед повторным запросом**.

```javascript
module.exports.fnBeforeReprompting = function(context) {
    if(context.responses[0].text === "C") {
        return false;
    }
    return true;
}
```

### <a name="feedback-state"></a>Состояние обратной связи

Используйте это состояние, чтобы предоставить ответ пользователю. К типичным вариантам использования этого состояния относится конечный результат после попытки выполнения задачи или предоставление ответа пользователю в условиях сбоев и т. д. 

Для каждого состояния требуется уникальное имя, некоторые возможные значения ответов. Они также могут дополнительно включать определения адаптивных карточек. Узнайте больше об [определении адаптивных карточек](conversation-designer-adaptive-cards.md).

Каждое состояние обратной связи также предусматривает выполнение функции обратного вызова **при ответе на запрос**, когда при необходимости можно написать пользовательский скрипт для изменения полезных данных действия перед отправкой их пользователю. 


```javascript
module.exports.fnOnResponding = function(context) {
    // include a hint card
    var activity = context.responses.slice(-1).pop();
    activity.attachments.push({
        "contentType": "application/vnd.microsoft.card.hero",
        "content": {
            "buttons": [
                {
                    "type": "imBack",
                    "title": "1",
                    "value": "1"
                },
                {
                    "type": "imBack",
                    "title": "2",
                    "value": "2"
                }
            ]
        }
    });

}
```

### <a name="module-state"></a>Состояние модуля

Состояние модуля используется для добавления ссылки на выполнение вложенного диалога. Используйте это состояние, чтобы связать диалоги. 

Для каждого состояния модуля требуется уникальное имя и указатель на конкретный диалог, который необходимо выполнить. Возможные варианты для диалогов, которые необходимо выполнить, должны находиться в разделе **Shared dialogues** (Общие диалоги) или в конкретных **задачах**.

## <a name="multiple-dialogues-under-a-task"></a>Несколько диалогов в задаче

В задаче может содержаться несколько диалогов. Чтобы добавить диалог в задачу, просто выберите задачу и нажмите кнопку **Добавить** на панели дерева слева, а затем щелкните **Add dialogue** (Добавить диалог). Новый диалог будет добавлен в выбранную задачу. 

Так как диалоги являются составными, корневую последовательность диалога можно привязать к задаче, которая вызывает другие диалоги в задаче. Это позволяет внедрить подзадачи и включить повторное использование. Это также позволяет связать эти диалоги в последовательности разговора с помощью состояний *модуля*.

## <a name="next-step"></a>Дальнейшие действия
> [!div class="nextstepaction"]
> [Шаблоны ответов](conversation-designer-response-templates.md)
