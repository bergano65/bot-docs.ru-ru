---
title: Обзор шаблона виртуального помощника | Документация Майкрософт
description: Дополнительные сведения о шаблоне виртуального помощника
author: darrenj
ms.author: darrenj
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.date: 05/23/2019
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 82385510894213a386c3f38836c85aad44306a23
ms.sourcegitcommit: eacf1522d648338eebefe2cc5686c1f7866ec6a2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/30/2019
ms.locfileid: "70167066"
---
# <a name="virtual-assistant---template-outline"></a>Виртуальный помощник — описание шаблона

> [!NOTE]
> Приведенные здесь сведения относятся к пакету SDK версии 4. 

Шаблон виртуального помощника объединяет лучшие методики, определенные нами при создании решений для ведения диалога, и автоматизирует интеграцию компонентов, которые мы считаем очень полезными для разработчиков, работающих с платформой Bot Framework. В этом разделе содержатся общие сведения о ключевых решениях, которые помогут понять, почему шаблон работает именно так, а не иначе.

Функция      | ОПИСАНИЕ |
------------ | -------------
Введение | Приветственное сообщение с [адаптивной карточкой]() в начале беседы.
Индикаторы ввода  | Автоматизированные визуальные индикаторы ввода при ведении беседы и повторная отправка сообщений для длительных операций.
Базовая модель LUIS  | Поддерживает распространенные намерения, например **Отмена**, **Справка**, **Эскалация** и т. д.
Базовые диалоги | Потоки диалогов для записи базовой информации о пользователе, а также логики прерывания для намерений отмены и справки.
Базовые ответы  | Текстовые и голосовые ответы для базовых намерений и диалогов.
Часто задаваемые вопросы | Интеграция с [QnA Maker](https://www.qnamaker.ai) для предоставления ответов на общие вопросы из базы знаний. 
Беседа | Модель беседы с профессионалом для предоставления стандартных ответов на распространенные вопросы ([подробнее](https://docs.microsoft.com/azure/cognitive-services/qnamaker/how-to/chit-chat-knowledge-base)).
Диспетчер | Интегрированная модель [Dispatch](https://docs.microsoft.com/azure/bot-service/bot-builder-tutorial-dispatch?view=azure-bot-service-4.0&tabs=csaddref%2Ccsbotconfig), которая позволяет определить, нужно ли обработать конкретный речевой фрагмент с помощью LUIS или QnA Maker.
Поддержка языков | Доступно на английском, французском, итальянском, немецком, испанском и китайском языках.
Расшифровка | Расшифровки всех бесед, хранящихся в службе хранилища Azure.
Телеметрия  | Интеграция с [Application Insights](https://azure.microsoft.com/services/application-insights/) для сбора телеметрии всех бесед.
Analytics | Пример панели мониторинга Power BI для начала работы с аналитическими сведениями о ведении бесед.
Автоматизированное развертывание | Простое развертывание всех упомянутых выше служб с помощью шаблонов Azure ARM.

## <a name="introduction-card"></a>Карточка с вводными сведениями

Использование многих решений для ведения диалога сопряжено с одной проблемой: пользователь не знает, с чего начать, и задает общие вопросы, с ответом на которые бот может справиться не лучшим образом. А ведь первое впечатление играет важную роль! Карточка с вводными сведениями содержит информацию о возможностях бота и предлагает пользователю на выбор несколько начальных вопросов, которые помогут ему приступить к работе с ботом. Это также отличная возможность подчеркнуть отличие вашего бота от других.

Предоставляется стандартная карточка простого знакомства, которую вы можете настроить под конкретные потребности. При операциях, которые выполняются после диалога подключения (он запускается кнопкой "Приступить к работе" на карточке знакомства), отображается ответная карточка пользователя.

![Пример карточки знакомства](./media/enterprise-template/vabotintrocard.png)

## <a name="basic-language-understanding-luis-intents"></a>Базовые намерения Интеллектуальной службы распознавания речи (LUIS)

Каждый бот должен понимать естественный язык на базовом уровне. Например, приветствие — это базовая задача, с которой любой бот должен легко справляться. В общем случае разработчики должны создавать подобные базовые намерения и предоставлять данные для начального обучения, которые позволят приступить к работе с ботом. Шаблон виртуального помощника изначально поддерживает базовые возможности. Также он содержит примеры файлов .lu, чтобы вам не нужно было создавать их для каждого проекта.

В файлах .lu представлены следующие намерения на английском, китайском, французском, итальянском, немецком и испанском языках.

Намерение       | Примеры речевых фрагментов |
-------------|-------------|
Отмена       |*Отмена*, *Неважно*|
Эскалация     |*Можно поговорить с человеком?*|
FinishTask   |*Готово*, *Все выполнено*|
GoBack       |*Назад*|
Справка         |*Поможешь мне?*|
Repeat       |*Можно повторить?*|
SelectAny    |*Любой вариант*|
SelectItem   |*Первый вариант*|
SelectNone   |*Ни один из вариантов*|
ShowNext     |*Показать больше*|
ShowPrevious |*Показать предыдущие варианты*|
StartOver    |*restart*|
Остановить         |*stop*|

Формат файлов [.lu](https://github.com/Microsoft/botbuilder-tools/blob/master/packages/Ludown/docs/lu-file-format.md) аналогичен формату Markdown. Такие файлы легко изменять и использовать в системе управления версиями. Средство [LuDown](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/Ludown) преобразовывает файлы .lu в модели LUIS, которые затем можно опубликовать в подписке LUIS с помощью портала или командной строки [LUIS](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/LUIS).

## <a name="telemetry"></a>Телеметрия

Сбор аналитических сведений о вовлеченности пользователя в работу с ботом оказалось очень важным делом. Такие сведения помогают понять уровень вовлеченности пользователей, какие функции ботов они используют (намерения), на какие вопросы бот не может ответить. Все это позволяет выявить пробелы в знаниях бота, которые можно устранить, например, с помощью новых статей QnA Maker.

Интеграция с Application Insights позволяет в стандартной конфигурации получать ценные аналитические сведения эксплуатационного и технического характера, а также собирать данные о событиях в работе бота (отправленные и полученные сообщения, операции с LUIS и QnA Maker).

Данные телеметрии на уровне бота по своей природе связаны с данными телеметрии о его технических и эксплуатационных параметрах, что позволяет проверять, как бот отвечает на вопрос определенного пользователя и наоборот.

Компонент ПО промежуточного слоя в сочетании с классом-оболочкой QnA Maker и классами пакета SDK LuisRecognizer предоставляют удобный способ для сбора согласованного набора событий. Эти согласованные события затем могут использоваться средствами Application Insights, а также такими инструментами, как Power BI.

Пример панели мониторинга Power BI включен в репозиторий решений Bot Framework на сайте GitHub. Его можно использовать с любым шаблоном виртуального помощника без дополнительной настройки. См. дополнительные сведения в разделе о [данных аналитики](https://aka.ms/bfs-analytics).

![Пример данных аналитики](./media/enterprise-template/powerbi-conversationanalytics-luisintents.png)

## <a name="dispatcher"></a>Диспетчер

Основной конструктивный шаблон, эффективно примененный при создании первой волны решений для ведения диалога, основан на возможностях службы "Распознавание речи" (LUIS) и QnA Maker. Служба LUIS обучалась по задачам, которые бот может выполнять для конечного пользователя, а QnA Maker — по более общим знаниям.

Все входящие фразы (вопросы) перенаправлялись в LUIS для анализа. Если намерение определенного речевого фрагмента не было распознано, оно помечалось как намерение *None*. В этом случае для поиска ответа на вопрос пользователя применялась служба QnA Maker.

Такая схема работала хорошо, но были два ключевых сценария, в которых могли возникать проблемы.

- Если фразы в модели LUIS и QnA Maker совпадали (иногда частично), это могло приводить к странному поведению службы LUIS: она пыталась обработать вопрос, передаваемый в QnA Maker.
- При использовании двух и более моделей LUIS боту нужно было вызывать каждую из них и выполнять своего рода сравнительную оценку намерений, чтобы определить, куда отправлять определенный речевой фрагмент. Так как общей базовой оценки не существует, сравнение моделей выполнялось плохо, из-за чего взаимодействие пользователя и бота было неэффективным.

Изящное решение этой проблемы обеспечивает средство [Dispatch](https://docs.microsoft.com/azure/bot-service/bot-builder-tutorial-dispatch?view=azure-bot-service-4.0&tabs=csaddref%2Ccsbotconfig). Оно извлекает речевые фрагменты из каждой настроенной модели LUIS и вопросы из QnA Maker, а затем создает централизованную модель отправки для LUIS.

Это позволяет боту быстро определять, какой компонент или модель LUIS должны обрабатывать определенный речевой фрагмент. Более того, данные QnA Maker учитываются на основном этапе обработки намерений, а не только для намерения *None*, как раньше.

Кроме того, средство Dispatch позволяет выявлять разногласия и совпадения между моделями LUIS и базами знаний QnA Maker еще до развертывания.

Средство Dispatch лежит в основе каждого проекта, созданного с помощью шаблона. Модель Dispatch используется в классе `MainDialog` и позволяет определить, что является целевым объектом: модель LUIS или QnA. Если целевым объектом является модель LUIS, вызывается дополнительная модель LUIS, возвращающая намерение и сущности. Средство Dispatch также используется для обнаружения прерываний.

![Пример работы со средством Dispatch](./media/enterprise-template/dispatchexample.png)

## <a name="qna-maker"></a>QnA Maker

[QnA Maker](https://www.qnamaker.ai/) позволяет пользователям, которые не являются разработчиками, курировать общие знания в формате пар "вопрос — ответ". Эти знания можно импортировать из таких источников данных, как списки часто задаваемых вопросов и руководства по продуктам. Их также можно импортировать в интерактивном режиме на портале QnA Maker.

Два примера моделей QnA Maker доступны в формате файла [.lu](https://github.com/Microsoft/botbuilder-tools/blob/master/packages/Ludown/docs/lu-file-format.md) в папке QnA для CognitiveModels. Одна из этих моделей отвечает за вопросы и ответы, а другая — за беседы в чате. С помощью [LuDown](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/Ludown) скрипт развертывания создает JSON-файл QnA Maker, который затем используется в командной строке [QnA Maker](https://github.com/Microsoft/botbuilder-tools/tree/master/packages/QnAMaker) для публикации элементов в базе знаний QnA Maker.

![Пример QnA ChitChat](./media/enterprise-template/qnachitchatexample.png)

## <a name="content-moderator"></a>Content Moderator

Дополнительный компонент Content Moderator позволяет обнаруживать ненормативную лексику и помогает обнаруживать персональные данных в содержимом. В этом случае бот, например, может принести извинения и переключить пользователя на оператора-человека или не сохранять данные телеметрии, если обнаружены персональные данные.

Также используется компонент ПО промежуточного слоя, который проверяет тексты и изображения с помощью ```TextModeratorResult``` в объекте TurnState.

## <a name="next-steps"></a>Дальнейшие действия
См. о [создании и развертывании виртуального помощника](https://aka.ms/bfs-tutorials). 

## <a name="additional-resources"></a>Дополнительные ресурсы
Полный исходный код виртуального помощника можно найти на портале [GitHub](https://aka.ms/bf-solutions).

